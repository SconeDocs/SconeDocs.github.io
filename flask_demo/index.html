



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Scone Documentation - Secure Containers">
      
      
        <link rel="canonical" href="https://sconedocs.github.io/flask_demo/">
      
      
        <meta name="author" content="Christof Fetzer">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching pages">
      
        <meta name="lang:search.result.one" content="1 matching page">
      
        <meta name="lang:search.result.other" content="# matching page">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/scone-favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.3">
    
    
      
        <title>Flask Demo - SCONE Confidential Computing</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:300,400,400i,700|">
        <style>body,input{font-family:"PT Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
      <link rel="stylesheet" href="../css/tooltips.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="purple">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#a-confidential-flask-based-application" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://sconedocs.github.io" title="SCONE Confidential Computing" class="md-header-nav__button md-logo">
          
            <img src="../img/logo-yellow-square.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                SCONE Confidential Computing
              </span>
              <span class="md-header-nav__topic">
                Flask Demo
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search this site" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching this site
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://sconedocs.github.io" title="SCONE Confidential Computing" class="md-nav__button md-logo">
      
        <img src="../img/logo-yellow-square.png" width="48" height="48">
      
    </a>
    SCONE Confidential Computing
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Executive summary" class="md-nav__link">
      Executive summary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cc-telenovela/" title="CC Soap Opera" class="md-nav__link">
      CC Soap Opera
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cc-university/" title="CC University" class="md-nav__link">
      CC University
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vm_vs_enclave/" title="Confidential Computing" class="md-nav__link">
      Confidential Computing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advantages/" title="Advantages of SCONE" class="md-nav__link">
      Advantages of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../whyscone/" title="SCONE vs Intel SGX SDK" class="md-nav__link">
      SCONE vs Intel SGX SDK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../technical_summary/" title="Technical summary of SCONE" class="md-nav__link">
      Technical summary of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../buildingApps/" title="(No) Cross-Compilation" class="md-nav__link">
      (No) Cross-Compilation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../registry/" title="Scontain Registy" class="md-nav__link">
      Scontain Registy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../curated_images/" title="Curated Images" class="md-nav__link">
      Curated Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../community_version/" title="Community Version" class="md-nav__link">
      Community Version
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      DevOps Aspects
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        DevOps Aspects
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../operations/" title="Workflows" class="md-nav__link">
      Workflows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconify/" title="Sconify" class="md-nav__link">
      Sconify
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mitigation/" title="Attack mitigation" class="md-nav__link">
      Attack mitigation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sadvisories/" title="Security advisories" class="md-nav__link">
      Security advisories
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software_updates/" title="Software updates" class="md-nav__link">
      Software updates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scone-signer/" title="Signing of enclaves" class="md-nav__link">
      Signing of enclaves
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scone_semantic_versioning/" title="SCONE versioning" class="md-nav__link">
      SCONE versioning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      SconeApps and Kubernetes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        SconeApps and Kubernetes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../k8s_concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm/" title="SconeApps" class="md-nav__link">
      SconeApps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_sgxdevplugin/" title="Kubernetes SGX Plugin" class="md-nav__link">
      Kubernetes SGX Plugin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kubeapps/" title="Kubeapps" class="md-nav__link">
      Kubeapps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../k8s_dashboard/" title="Kubernetes Dashboard" class="md-nav__link">
      Kubernetes Dashboard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_cas/" title="CAS Deploy & Attest" class="md-nav__link">
      CAS Deploy & Attest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_las/" title="LAS Deploy & Platforms" class="md-nav__link">
      LAS Deploy & Platforms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_mariadb/" title="MariaDB Deploy & Attest" class="md-nav__link">
      MariaDB Deploy & Attest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_teemon/" title="TEEMon Deployment" class="md-nav__link">
      TEEMon Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_vscode/" title="Visual Studio Code" class="md-nav__link">
      Visual Studio Code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hello_world_kubernetes/" title="Hello World Kubernetes" class="md-nav__link">
      Hello World Kubernetes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Azure Kubernetes Services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Azure Kubernetes Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../aks/" title="Confidential AKS" class="md-nav__link">
      Confidential AKS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aks/flask_demo/" title="Flask Demo" class="md-nav__link">
      Flask Demo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secure_document_management/" title="Confidential Document Management" class="md-nav__link">
      Confidential Document Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python_images/" title="Python Images" class="md-nav__link">
      Python Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconify_image/" title="Sconify Image" class="md-nav__link">
      Sconify Image
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ee_sconify_image/" title="Sconify Image SE" class="md-nav__link">
      Sconify Image SE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aks_integration/" title="AKS Integration" class="md-nav__link">
      AKS Integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aks_charts/" title="AKS Applications" class="md-nav__link">
      AKS Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aks_setup/" title="AKS Setup" class="md-nav__link">
      AKS Setup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../scone-use-case-overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secure_remote_execution/" title="Secure Remote Execution" class="md-nav__link">
      Secure Remote Execution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerfileexample/" title="Dockerfile Example" class="md-nav__link">
      Dockerfile Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multistagebuild/" title="Multi-stage build" class="md-nav__link">
      Multi-stage build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../groupcacheUseCase/" title="GO example" class="md-nav__link">
      GO example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../memory_dump/" title="Finding Secrets" class="md-nav__link">
      Finding Secrets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dapps/" title="Trusted DApps" class="md-nav__link">
      Trusted DApps
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Flask Demo
      </label>
    
    <a href="./" title="Flask Demo" class="md-nav__link md-nav__link--active">
      Flask Demo
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#flask-based-confidential-service" title="Flask-Based Confidential Service" class="md-nav__link">
    Flask-Based Confidential Service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-certificates" title="TLS Certificates" class="md-nav__link">
    TLS Certificates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-based-mutual-attestation" title="TLS-based Mutual Attestation" class="md-nav__link">
    TLS-based Mutual Attestation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code" title="Code" class="md-nav__link">
    Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-service-on-local-computer" title="Run Service On Local Computer" class="md-nav__link">
    Run Service On Local Computer
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-the-service" title="Testing the service" class="md-nav__link">
    Testing the service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-on-a-kubernetes-cluster-and-aks" title="Execution on a Kubernetes Cluster and AKS" class="md-nav__link">
    Execution on a Kubernetes Cluster and AKS
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-scone-services" title="Install SCONE services" class="md-nav__link">
    Install SCONE services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-application" title="Run the application" class="md-nav__link">
    Run the application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-the-application" title="Test the application" class="md-nav__link">
    Test the application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-the-application" title="Access the application" class="md-nav__link">
    Access the application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" title="Clean up" class="md-nav__link">
    Clean up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secure_document_management/" title="Secure Document Management" class="md-nav__link">
      Secure Document Management
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Configuration & Attestation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Configuration & Attestation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CASOverview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_intro/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_for_development/" title="Starting CAS" class="md-nav__link">
      Starting CAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_config/" title="CAS Configuration" class="md-nav__link">
      CAS Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../public-CAS/" title="Public CAS" class="md-nav__link">
      Public CAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../LASIntro/" title="Starting LAS" class="md-nav__link">
      Starting LAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_blender_example/" title="Posting Sessions" class="md-nav__link">
      Posting Sessions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_cli-intro/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_cli/" title="CLI Reference" class="md-nav__link">
      CLI Reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_session_lang_0_2/" title="Policy Language 0.2" class="md-nav__link">
      Policy Language 0.2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_session_lang_0_3/" title="Policy Language 0.3" class="md-nav__link">
      Policy Language 0.3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../print-arg-env/" title="Secure Arguments" class="md-nav__link">
      Secure Arguments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EncryptedWordCount/" title="Encrypted Code and Input" class="md-nav__link">
      Encrypted Code and Input
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../node-example/" title="Node" class="md-nav__link">
      Node
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../namespace/" title="Namespaces" class="md-nav__link">
      Namespaces
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Use Cases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Use Cases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../usecases/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../blender/" title="Blender" class="md-nav__link">
      Blender
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pyspark/" title="PySpark" class="md-nav__link">
      PySpark
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflow/" title="TensorFlow" class="md-nav__link">
      TensorFlow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflowlite/" title="TensorFlow Lite" class="md-nav__link">
      TensorFlow Lite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../openvino/" title="OpenVino" class="md-nav__link">
      OpenVino
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vault/" title="Vault" class="md-nav__link">
      Vault
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Execution Modes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Execution Modes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../outline/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../firstcontainer/" title="Simulation Mode" class="md-nav__link">
      Simulation Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hardwaremode/" title="Hardware Mode" class="md-nav__link">
      Hardware Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hostexample/" title="Host Execution" class="md-nav__link">
      Host Execution
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" title="Installation overview" class="md-nav__link">
      Installation overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerinstall/" title="Installing docker" class="md-nav__link">
      Installing docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sgxinstall/" title="Installing Intel SGX driver" class="md-nav__link">
      Installing Intel SGX driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeinstall/" title="Installing SCONE" class="md-nav__link">
      Installing SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../microcode/" title="Updating CPU microcode" class="md-nav__link">
      Updating CPU microcode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows10/" title="Windows 10" class="md-nav__link">
      Windows 10
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Language Support
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Language Support
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../C/" title="C" class="md-nav__link">
      C
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mono/" title="C#" class="md-nav__link">
      C#
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../C++/" title="C++" class="md-nav__link">
      C++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Fortran/" title="Fortran" class="md-nav__link">
      Fortran
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GO/" title="GO" class="md-nav__link">
      GO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Java/" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Running_Java_Applications_in_Scone_with_remote_attestation/" title="Java with remote attestation" class="md-nav__link">
      Java with remote attestation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pypyscone/" title="PyPy" class="md-nav__link">
      PyPy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mono/" title="Mono" class="md-nav__link">
      Mono
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nodejs/" title="Node" class="md-nav__link">
      Node
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../R/" title="R" class="md-nav__link">
      R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Rust/" title="Rust" class="md-nav__link">
      Rust
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      IDE Integration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        IDE Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../eclipse/" title="Eclipse" class="md-nav__link">
      Eclipse
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_vscode/" title="Visual Studio Code" class="md-nav__link">
      Visual Studio Code
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      Command Line Interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        Command Line Interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_CLI/" title="SCONE CLI" class="md-nav__link">
      SCONE CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_toolchain/" title="SCONE SGX toolchain" class="md-nav__link">
      SCONE SGX toolchain
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Curated_Images/" title="SCONE Curated Images" class="md-nav__link">
      SCONE Curated Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_TUTORIAL/" title="SCONE Static vs Dynamic" class="md-nav__link">
      SCONE Static vs Dynamic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_GENERATE_IMAGE/" title="SCONE Create Image" class="md-nav__link">
      SCONE Create Image
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Dockerfile/" title="SCONE Dockerfile" class="md-nav__link">
      SCONE Dockerfile
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      Manuals
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        Manuals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Fileshield/" title="scone fspf" class="md-nav__link">
      scone fspf
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../binary_fs/" title="scone binary fs" class="md-nav__link">
      scone binary fs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_ENV/" title="environment variables" class="md-nav__link">
      environment variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MrEnclave/" title="MrEnclave" class="md-nav__link">
      MrEnclave
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scone_affinity/" title="affinity" class="md-nav__link">
      affinity
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15">
    
    <label class="md-nav__link" for="nav-15">
      Performance
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-15">
        Performance
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../performance/" title="Applications" class="md-nav__link">
      Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../teemon/" title="Monitoring tool" class="md-nav__link">
      Monitoring tool
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16">
    
    <label class="md-nav__link" for="nav-16">
      Background
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-16">
        Background
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../appsecurity/" title="Application-Oriented Security" class="md-nav__link">
      Application-Oriented Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../background/" title="SCONE Background" class="md-nav__link">
      SCONE Background
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SCONE_Publications/" title="Publications" class="md-nav__link">
      Publications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../aboutScone/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#flask-based-confidential-service" title="Flask-Based Confidential Service" class="md-nav__link">
    Flask-Based Confidential Service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-certificates" title="TLS Certificates" class="md-nav__link">
    TLS Certificates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-based-mutual-attestation" title="TLS-based Mutual Attestation" class="md-nav__link">
    TLS-based Mutual Attestation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code" title="Code" class="md-nav__link">
    Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-service-on-local-computer" title="Run Service On Local Computer" class="md-nav__link">
    Run Service On Local Computer
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-the-service" title="Testing the service" class="md-nav__link">
    Testing the service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-on-a-kubernetes-cluster-and-aks" title="Execution on a Kubernetes Cluster and AKS" class="md-nav__link">
    Execution on a Kubernetes Cluster and AKS
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-scone-services" title="Install SCONE services" class="md-nav__link">
    Install SCONE services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-application" title="Run the application" class="md-nav__link">
    Run the application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-the-application" title="Test the application" class="md-nav__link">
    Test the application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-the-application" title="Access the application" class="md-nav__link">
    Access the application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" title="Clean up" class="md-nav__link">
    Clean up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="a-confidential-flask-based-application">A Confidential Flask-Based Application</h1>
<p>We <strong>demonstrate</strong> with the help of a simple Flask-based Service multiple features of the SCONE platform:</p>
<ul>
<li>we show that we can execute <strong>unmodified Python</strong> programs inside of SGX enclaves</li>
<li>we show how to <strong>encrypt the Python program</strong> to protect the <strong>confidentiality</strong> and <strong>integrity</strong> of the Python code</li>
<li>how to <strong>implicitly attest other services</strong> with the help of TLS, i.e., to ensure that one communicates with a service that satisfy its security policy.<ul>
<li>we demonstrate how Redis, an in-memory data structure store, and the Python flask <strong>attest each other</strong> via <strong>TLS</strong> without needing to change the code of neither Redis nor the Flask-based service.</li>
</ul>
</li>
<li>we show how to <strong>generate TLS certificates</strong> with the help of a policy:<ul>
<li>a SCONE security policy describes how to attest applications and services (i.e., describe the code, the filesystem state, the environment, the node on which to execute, and secrets).</li>
<li>a SCONE policy can generate secrets and in particular, key-pairs and TLS certificates.</li>
</ul>
</li>
<li>we show how to execute this example<ul>
<li>on a local computer with the help of <code>docker-compose</code></li>
<li>on a generic Kubernetes cluster, and</li>
<li>on <strong>Azure Kubernetes Service</strong> (AKS).</li>
</ul>
</li>
</ul>
<p><img alt="Mutual Protection" src="../img/attestation.svg#fullwidth" /></p>
<div class="admonition note">
<p class="admonition-title">Next Step</p>
<p>In the second version of this example, we <strong>simplify the
workflow</strong> in the sense that we use a generic script to transform an existing native container image into an encrypted, confidential container image.</p>
</div>
<h2 id="flask-based-confidential-service">Flask-Based Confidential Service</h2>
<p>We implement a simple Flask-based service. The Python <a href="https://github.com/scontain/flask_example/blob/master/rest_api.py">code</a> implements a REST API:</p>
<ul>
<li>to store patient records (i.e., POST to resource <code>/patient/&lt;string:patient_id&gt;</code>)</li>
<li>to retrieve patient records (i.e., GET of resource <code>/patient/&lt;string:patient_id&gt;</code>)</li>
<li>to retrieve some <em>score</em> for a patient (i.e., GET of ressource <code>'/score/&lt;string:patient_id&gt;</code>)</li>
</ul>
<p>The Python code is executed inside of an enclave to ensure that even users with root access cannot read the patient data.</p>
<h2 id="tls-certificates">TLS Certificates</h2>
<p>The service uses a Redis instance to store the resources. The communication between 1) the Flask-based service and its clients and  2) Redis and the application is encrypted with the help of TLS. To do so, we need to provision the application and Redis with multiple keys and certificates:</p>
<ul>
<li>Redis client certificate</li>
<li>Redis server certificate</li>
<li>Flask server certificate</li>
</ul>
<p>Redis and the Flask-based service, require that the private keys and certificates are stored in the filesystem. We generate and provision these TLS-related files with the help of a <a href="https://sconedocs.github.io/CAS_session_lang_0_3/">SCONE policy</a>. </p>
<p>To do so, we generate <strong>secrets</strong> related to the Flask-based service. We specify in the <a href="https://github.com/scontain/flask_example/blob/master/flask-template.yml">flask policy</a> that</p>
<ul>
<li>a private key (<code>api_ca_key</code>) for a new certificate authority (CA) is generated</li>
<li>a certificate (<code>api_ca_cert</code>) for a certification authority is generated</li>
<li>using the private key (i.e., <code>api_ca_key</code>), and</li>
<li>making this certificate available to everybody (see <code>export_public: true</code>)</li>
<li>we generate a private key for the certificate used by the REST API (i.e., <code>flask_key</code>)</li>
<li>we generate a certificate (<code>flask</code>) with the help of CA <code>api_ca_cert</code> and assign it a dns name <code>api</code>.</li>
</ul>
<p>The SCONE policy is based on Yaml and the <a href="https://github.com/scontain/flask_example/blob/master/flask-template.yml">flask policy</a> contains the following section to define these secrets:</p>
<div class="highlight"><pre><span></span>secrets:
    - name: api_ca_key
      kind: private-key
    - name: api_ca_cert
      kind: x509-ca
      export_public: true
      private_key: api_ca_key
    - name: flask_key
      kind: private-key
    - name: flask
      kind: x509
      private_key: flask_key
      issuer: api_ca_cert
      dns:
        - api
</pre></div>

<p>The private keys and certificates are expected at certain locations in the file system. SCONE permits to map these secrets into the filesystem of the Flask-based service: these files are only  visible to the service inside of an SGX enclave after a successful attestation (see below) and in particular, not visible on the outside i.e., in the filesystem of the container.</p>
<p>To map the private keys and certificates into the filesystem of a service, we specify in the policy which secrets are visible to a service at which path. In the <a href="https://github.com/scontain/flask_example/blob/master/flask-template.yml">flask policy</a> this is done as follows:</p>
<div class="highlight"><pre><span></span>images:
   - name: flask_restapi_image
     injection_files:
        - path: /tls/flask.crt
          content: $$SCONE::flask.crt$$
        - path: /tls/flask.key
          content: $$SCONE::flask.key$$
</pre></div>

<p>And in the Python program, one can just access these files as normal files. One can create a SSL context (see <a href="https://github.com/scontain/flask_example/blob/master/rest_api.py">code</a>):</p>
<div class="highlight"><pre><span></span>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">4996</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ssl_context</span><span class="o">=</span><span class="p">((</span><span class="s2">&quot;/tls/flask.crt&quot;</span><span class="p">,</span> <span class="s2">&quot;/tls/flask.key&quot;</span><span class="p">)))</span>
</pre></div>

<p>While we do not show how to enforce client authentication of the REST API, we show how to do this for Redis in the next section.</p>
<h2 id="tls-based-mutual-attestation">TLS-based Mutual Attestation</h2>
<p>The communication between the Flask-based service, say, <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span> and Redis instance, say, <span><span class="MathJax_Preview">R</span><script type="math/tex">R</script></span> is encrypted via TLS. Actually, we make sure that the service <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span> and instance <span><span class="MathJax_Preview">R</span><script type="math/tex">R</script></span> <strong>attest</strong> each other. Attestation means that <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span> ensures that <span><span class="MathJax_Preview">R</span><script type="math/tex">R</script></span> satisfies all requirements specified in <span><span class="MathJax_Preview">R</span><script type="math/tex">R</script></span>'s security policy and <span><span class="MathJax_Preview">R</span><script type="math/tex">R</script></span> ensures that <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span> satisfies all the requirements of <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span>'s policy. Of course, this should be done without changing the code of neither <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span> nor <span><span class="MathJax_Preview">R</span><script type="math/tex">R</script></span>. In case that <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span> and <span><span class="MathJax_Preview">R</span><script type="math/tex">R</script></span> are using TLS with client authentication, this is straightforward to enforce. (If this is not the case, please contact us for an alternative.)</p>
<p>To ensure mutual attestation, the operator of Redis defines a <a href="https://github.com/scontain/flask_example/blob/master/redis-template.yml">policy</a> in which it defines a certification authority (<code>redis_ca_cert</code>) and defines both a Redis certificate (<code>redis_ca_cert</code>) as well as a Redis client certificate (<code>redis_client_cert</code>). The client certificate and the private key (<code>redis_client_key</code>) are exported to the policy of the Flask service <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span>. The policy for this looks like this:</p>
<div class="highlight"><pre><span></span>secrets:
  - name: redis_key
    kind: private-key
  - name: redis # automatically generate Redis server certificate
    kind: x509
    private_key: redis_key
    issuer: redis_ca_cert
    dns:
     - redis
  - name: redis_client_key
    kind: private-key
    export:
    - session: $FLASK_SESSION
  - name: redis_client_cert # automatically generate client certificate
    kind: x509
    issuer: redis_ca_cert
    private_key: redis_client_key
    export:
    - session: $FLASK_SESSION # export client cert/key to client session
  - name: redis_ca_key
    kind: private-key
  - name: redis_ca_cert # export session CA certificate as Redis CA certificate
    kind: x509-ca
    private_key: redis_ca_key
    export:
    - session: $FLASK_SESSION # export the session CA certificate to client session
</pre></div>

<p>Note that <code>$FLASK_SESSION</code> is replaced by the unique name of the policy of <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span>. The security
policies are in this example on the same <a href="../helm_cas/">SCONE CAS (Configuration and Attestation Service)</a>. In more complex scenarios, the policies could also be stored on separate SCONE CAS instances operated by different entities.</p>
<p>The flask service can import the Redis CA certificate, client certificate and private key as follows:</p>
<div class="highlight"><pre><span></span>secrets:
    - name: redis_client_key
      import:
        session: $REDIS_SESSION
        secret: redis_client_key
    - name: redis_client_cert
      import:
        session: $REDIS_SESSION
        secret: redis_client_cert
    - name: redis_ca_cert
      import:
        session: $REDIS_SESSION
        secret: redis_ca_cert
</pre></div>

<p>These secrets are made available to the Flask-based service in the filesystem (i.e., files <code>/tls/redis-ca.crt</code>, <code>/tls/client.crt</code> and <code>/tls/client.key</code>) via the following entries in its security policy:</p>
<div class="highlight"><pre><span></span>images:
   - name: flask_restapi_image
     injection_files:
        - path: /tls/redis-ca.crt
          content: $$SCONE::redis_ca_cert.chain$$
        - path: /tls/client.crt
          content: $$SCONE::redis_client_cert.crt$$
        - path: /tls/client.key
          content: $$SCONE::redis_client_cert.key$$
</pre></div>

<p>Note that before uploading a policy to SCONE CAS, one first attests that one indeed communicates with a genuine SCONE CAS running inside of a production enclave. This is done with the help of a <a href="helm_cas/#attesting-scone-cas">SCONE CAS CLI</a>.</p>
<h2 id="code">Code</h2>
<p>The source code of this example is open source and available on github:</p>
<div class="highlight"><pre><span></span>git clone https://github.com/scontain/flask_example.git
<span class="nb">cd</span> flask_example
</pre></div>

<h2 id="run-service-on-local-computer">Run Service On Local Computer</h2>
<p>You can use <code>docker-compose</code> to run this example on your local SGX-enabled computer as follows.
You first generate an encrypted image using script <code>create_image.sh</code>. This generates some environment variables that stored in file <code>myenv</code> and are loaded via <code>source myenv</code>. The service and Redis are started with <code>docker-compose up</code>.</p>
<div class="highlight"><pre><span></span>./create_image.sh
<span class="nb">source</span> myenv
docker-compose up
</pre></div>

<p>We use a public instance of SCONE CAS in this example.</p>
<h3 id="testing-the-service">Testing the service</h3>
<p>Retrieve the API certificate from CAS:</p>
<div class="highlight"><pre><span></span><span class="nb">source</span> myenv
curl -k -X GET <span class="s2">&quot;https://</span><span class="si">${</span><span class="nv">SCONE_CAS_ADDR</span><span class="p">-cas</span><span class="si">}</span><span class="s2">:8081/v1/values/session=</span><span class="nv">$FLASK_SESSION</span><span class="s2">&quot;</span> <span class="p">|</span> jq -r .values.api_ca_cert.value &gt; cacert.pem
</pre></div>

<p>Since the API certificates are issued to the host name "api", we have to use it. You can rely on cURL's --resolve option to point to the actual address (you can also edit your /etc/hosts file).</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">URL</span><span class="o">=</span>https://api:4996
</pre></div>

<div class="highlight"><pre><span></span>curl --cacert cacert.pem -X POST <span class="si">${</span><span class="nv">URL</span><span class="si">}</span>/patient/patient_3 -d <span class="s2">&quot;fname=Jane&amp;lname=Doe&amp;address=&#39;123 Main Street&#39;&amp;city=Richmond&amp;state=Washington&amp;ssn=123-223-2345&amp;email=nr@aaa.com&amp;dob=01/01/2010&amp;contactphone=123-234-3456&amp;drugallergies=&#39;Sulpha, Penicillin, Tree Nut&#39;&amp;preexistingconditions=&#39;diabetes, hypertension, asthma&#39;&amp;dateadmitted=01/05/2010&amp;insurancedetails=&#39;Primera Blue Cross&#39;&quot;</span> --resolve api:4996:127.0.0.1
curl --cacert cacert.pem -X GET <span class="si">${</span><span class="nv">URL</span><span class="si">}</span>/patient/patient_3 --resolve api:4996:127.0.0.1
curl --cacert cacert.pem -X GET <span class="si">${</span><span class="nv">URL</span><span class="si">}</span>/score/patient_3 --resolve api:4996:127.0.0.1
</pre></div>

<p>The output might look as follows:</p>
<div class="highlight"><pre><span></span>$ curl --cacert cacert.pem -X POST https://localhost:4996/patient/patient_3 -d &quot;fname=Jane&amp;lname=Doe&amp;address=&#39;123 Main Street&#39;&amp;city=Richmond&amp;state=Washington&amp;ssn=123-223-2345&amp;email=nr@aaa.com&amp;dob=01/01/2010&amp;contactphone=123-234-3456&amp;drugallergies=&#39;Sulpha, Penicillin, Tree Nut&#39;&amp;preexistingconditions=&#39;diabetes, hypertension, asthma&#39;&amp;dateadmitted=01/05/2010&amp;insurancedetails=&#39;Primera Blue Cross&#39;&quot; --resolve api:4996:127.0.0.1
{&quot;address&quot;:&quot;&#39;123 Main Street&#39;&quot;,&quot;city&quot;:&quot;Richmond&quot;,&quot;contactphone&quot;:&quot;123-234-3456&quot;,&quot;dateadmitted&quot;:&quot;01/05/2010&quot;,&quot;dob&quot;:&quot;01/01/2010&quot;,&quot;drugallergies&quot;:&quot;&#39;Sulpha, Penicillin, Tree Nut&#39;&quot;,&quot;email&quot;:&quot;nr@aaa.com&quot;,&quot;fname&quot;:&quot;Jane&quot;,&quot;id&quot;:&quot;patient_3&quot;,&quot;insurancedetails&quot;:&quot;&#39;Primera Blue Cross&#39;&quot;,&quot;lname&quot;:&quot;Doe&quot;,&quot;preexistingconditions&quot;:&quot;&#39;diabetes, hypertension, asthma&#39;&quot;,&quot;score&quot;:0.1168424489618366,&quot;ssn&quot;:&quot;123-223-2345&quot;,&quot;state&quot;:&quot;Washington&quot;}
$ curl --cacert cacert.pem -X GET localhost:4996/patient/patient_3 --resolve api:4996:127.0.0.1
{&quot;address&quot;:&quot;&#39;123 Main Street&#39;&quot;,&quot;city&quot;:&quot;Richmond&quot;,&quot;contactphone&quot;:&quot;123-234-3456&quot;,&quot;dateadmitted&quot;:&quot;01/05/2010&quot;,&quot;dob&quot;:&quot;01/01/2010&quot;,&quot;drugallergies&quot;:&quot;&#39;Sulpha, Penicillin, Tree Nut&#39;&quot;,&quot;email&quot;:&quot;nr@aaa.com&quot;,&quot;fname&quot;:&quot;Jane&quot;,&quot;id&quot;:&quot;patient_3&quot;,&quot;insurancedetails&quot;:&quot;&#39;Primera Blue Cross&#39;&quot;,&quot;lname&quot;:&quot;Doe&quot;,&quot;preexistingconditions&quot;:&quot;&#39;diabetes, hypertension, asthma&#39;&quot;,&quot;score&quot;:0.1168424489618366,&quot;ssn&quot;:&quot;123-223-2345&quot;,&quot;state&quot;:&quot;Washington&quot;}
$ curl --cacert cacert.pem -X GET localhost:4996/score/patient_3 --resolve api:4996:127.0.0.1
{&quot;id&quot;:&quot;patient_3&quot;,&quot;score&quot;:0.2781606437899131}
</pre></div>

<h2 id="execution-on-a-kubernetes-cluster-and-aks">Execution on a Kubernetes Cluster and AKS</h2>
<p>You can run this example on a Kubernetes cluster or Azure Kubernetes Service (AKS).</p>
<h3 id="install-scone-services">Install SCONE services</h3>
<p>Get access to <code>SconeApps</code> (see <a href="https://sconedocs.github.io/helm/">https://sconedocs.github.io/helm/</a>):</p>
<div class="highlight"><pre><span></span>helm repo add sconeapps https://<span class="si">${</span><span class="nv">GH_TOKEN</span><span class="si">}</span>@raw.githubusercontent.com/scontain/sconeapps/master/
helm repo update
</pre></div>

<p>Give SconeApps access to the private docker images by generating an access token on  <a href="https://gitlab.scontain.com/-/profile/personal_access_tokens">https://gitlab.scontain.com/-/profile/personal_access_tokens</a> to <code>read_registry</code> and set:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">SCONE_HUB_USERNAME</span><span class="o">=</span>...
<span class="nb">export</span> <span class="nv">SCONE_HUB_ACCESS_TOKEN</span><span class="o">=</span>...
<span class="nb">export</span> <span class="nv">SCONE_HUB_EMAIL</span><span class="o">=</span>...

kubectl create secret docker-registry sconeapps --docker-server<span class="o">=</span>registry.scontain.com:5050 --docker-username<span class="o">=</span><span class="nv">$SCONE_HUB_USERNAME</span> --docker-password<span class="o">=</span><span class="nv">$SCONE_HUB_ACCESS_TOKEN</span> --docker-email<span class="o">=</span><span class="nv">$SCONE_HUB_EMAIL</span>
</pre></div>

<p>Start LAS:</p>
<div class="highlight"><pre><span></span>helm install las sconeapps/las  --set <span class="nv">image</span><span class="o">=</span>registry.scontain.com:5050/sconecuratedimages/kubernetes:las-scone4.2.1 --set service.hostPort<span class="o">=</span><span class="nb">true</span>
</pre></div>

<p>If you use a local cas, you can start this cas service as follows:</p>
<div class="highlight"><pre><span></span>helm install cas sconeapps/cas --set <span class="nv">image</span><span class="o">=</span>registry.scontain.com:5050/sconecuratedimages/services:cas-scone4.2.1
</pre></div>

<p>Install the SGX device plugin for Kubernetes:</p>
<div class="highlight"><pre><span></span>helm install sgxdevplugin sconeapps/sgxdevplugin
</pre></div>

<h3 id="run-the-application">Run the application</h3>
<p>Start by creating a Docker image and setting its name. Remember to specify a repository to which you are allowed to push:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">IMAGE</span><span class="o">=</span>registry.scontain.com:5050/sconecuratedimages/application:v0.4 <span class="c1"># please change to an image that you can push</span>
./create_image.sh
<span class="nb">source</span> myenv
docker push <span class="nv">$IMAGE</span>
</pre></div>

<p>Use the Helm chart in <a href="https://github.com/scontain/flask_example/tree/master/deploy/helm"><code>deploy/helm</code></a> to deploy the application to a Kubernetes cluster.</p>
<div class="highlight"><pre><span></span>helm install api-v1 deploy/helm <span class="se">\</span>
   --set <span class="nv">image</span><span class="o">=</span><span class="nv">$IMAGE</span> <span class="se">\</span>
   --set scone.cas<span class="o">=</span><span class="nv">$SCONE_CAS_ADDR</span> <span class="se">\</span>
   --set scone.flask_session<span class="o">=</span><span class="nv">$FLASK_SESSION</span>/flask_restapi <span class="se">\</span>
   --set scone.redis_session<span class="o">=</span><span class="nv">$REDIS_SESSION</span>/redis <span class="se">\</span>
   --set service.type<span class="o">=</span>NodePort <span class="se">\</span>
   --set redis.image<span class="o">=</span>registry.scontain.com:5050/sconecuratedimages/apps:redis-6-alpine-scone4.2.1
</pre></div>

<p><strong>NOTE</strong>: Setting <code>service.type=LoadBalancer</code> will allow the application to get traffic from the internet (through a managed LoadBalancer).</p>
<h3 id="test-the-application">Test the application</h3>
<p>After all resources are <code>Running</code>, you can test the API via Helm:</p>
<div class="highlight"><pre><span></span>helm <span class="nb">test</span> api-v1
</pre></div>

<p>Helm will run a pod with a couple of pre-set queries to check if the API is working properly.</p>
<h3 id="access-the-application">Access the application</h3>
<p>If the application is exposed to the world through a service of type LoadBalancer, you can retrieve its CA certificate from CAS:</p>
<div class="highlight"><pre><span></span><span class="nb">source</span> myenv
curl -k -X GET <span class="s2">&quot;https://</span><span class="si">${</span><span class="nv">SCONE_CAS_ADDR</span><span class="p">-cas</span><span class="si">}</span><span class="s2">:8081/v1/values/session=</span><span class="nv">$FLASK_SESSION</span><span class="s2">&quot;</span> <span class="p">|</span> jq -r .values.api_ca_cert.value &gt; cacert.pem
</pre></div>

<p>Retrieve the service public IP address:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">SERVICE_IP</span><span class="o">=</span><span class="k">$(</span>kubectl get svc --namespace default api-v1-example --template <span class="s2">&quot;{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}&quot;</span><span class="k">)</span>
</pre></div>

<p>Since the API certificates are issued to the host name "api", we have to use it. You can rely on cURL's --resolve option to point to the actual address (you can also edit your /etc/hosts file).</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">URL</span><span class="o">=</span>https://api
</pre></div>

<p>Now you can perform queries such as:</p>
<div class="highlight"><pre><span></span>curl --cacert cacert.pem -X POST <span class="si">${</span><span class="nv">URL</span><span class="si">}</span>/patient/patient_3 -d <span class="s2">&quot;fname=Jane&amp;lname=Doe&amp;address=&#39;123 Main Street&#39;&amp;city=Richmond&amp;state=Washington&amp;ssn=123-223-2345&amp;email=nr@aaa.com&amp;dob=01/01/2010&amp;contactphone=123-234-3456&amp;drugallergies=&#39;Sulpha, Penicillin, Tree Nut&#39;&amp;preexistingconditions=&#39;diabetes, hypertension, asthma&#39;&amp;dateadmitted=01/05/2010&amp;insurancedetails=&#39;Primera Blue Cross&#39;&quot;</span> --resolve api:443:<span class="si">${</span><span class="nv">SERVICE_IP</span><span class="si">}</span>
</pre></div>

<h3 id="clean-up">Clean up</h3>
<div class="highlight"><pre><span></span>helm delete cas
helm delete las
helm delete sgxdevplugin
helm delete api-v1
kubectl delete pod api-v1-example-test-api
</pre></div>

<p>Next, we introduce the different sconified Python versions that we support.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../dapps/" title="Trusted DApps" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Trusted DApps
              </span>
            </div>
          </a>
        
        
          <a href="../secure_document_management/" title="Secure Document Management" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Secure Document Management
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright Scontain © 2021
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.e72fd936.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../search/main.js"></script>
      
    
    
      
    
  </body>
</html>