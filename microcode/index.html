



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Scone Documentation - Secure Containers">
      
      
        <link rel="canonical" href="https://sconedocs.github.io/microcode/">
      
      
        <meta name="author" content="Christof Fetzer">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/scone-favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Updating CPU microcode - SCONE</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#l1tf-aka-foreshadow-mitigation" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://sconedocs.github.io" title="SCONE" class="md-header-nav__button md-logo">
          
            <img src="../img/logo-yellow-square.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              SCONE
            </span>
            <span class="md-header-nav__topic">
              
                Updating CPU microcode
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://sconedocs.github.io" title="SCONE" class="md-nav__button md-logo">
      
        <img src="../img/logo-yellow-square.png" width="48" height="48">
      
    </a>
    SCONE
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href=".." title="Executive summary" class="md-nav__link">
      Executive summary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advantages/" title="Advantages of SCONE" class="md-nav__link">
      Advantages of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../technical_summary/" title="Technical summary of SCONE" class="md-nav__link">
      Technical summary of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../buildingApps/" title="(No) Cross-Compilation" class="md-nav__link">
      (No) Cross-Compilation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../curated_images/" title="Curated Images" class="md-nav__link">
      Curated Images
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../scone-use-case-overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secure_remote_execution/" title="Secure Remote Execution" class="md-nav__link">
      Secure Remote Execution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerfileexample/" title="Dockerfile Example" class="md-nav__link">
      Dockerfile Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multistagebuild/" title="Multi-stage build" class="md-nav__link">
      Multi-stage build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../groupcacheUseCase/" title="GO example" class="md-nav__link">
      GO example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../memory_dump/" title="Finding Secrets" class="md-nav__link">
      Finding Secrets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dapps/" title="Trusted DApps" class="md-nav__link">
      Trusted DApps
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Configuration & Attestation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Configuration & Attestation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CASOverview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_intro/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CASIntro/" title="Starting CAS" class="md-nav__link">
      Starting CAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../LASIntro/" title="Starting LAS" class="md-nav__link">
      Starting LAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_blender_example/" title="Posting Sessions" class="md-nav__link">
      Posting Sessions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../print-arg-env/" title="Secure Arguments" class="md-nav__link">
      Secure Arguments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EncryptedWordCount/" title="Encrypted Code and Input" class="md-nav__link">
      Encrypted Code and Input
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Use Cases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Use Cases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../usecases/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../blender/" title="Blender" class="md-nav__link">
      Blender
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pyspark/" title="PySpark" class="md-nav__link">
      PySpark
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflow/" title="TensorFlow" class="md-nav__link">
      TensorFlow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflowlite/" title="TensorFlow Lite" class="md-nav__link">
      TensorFlow Lite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vault/" title="Vault" class="md-nav__link">
      Vault
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Execution Modes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Execution Modes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../outline/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../firstcontainer/" title="Simulation Mode" class="md-nav__link">
      Simulation Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hardwaremode/" title="Hardware Mode" class="md-nav__link">
      Hardware Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hostexample/" title="Host Execution" class="md-nav__link">
      Host Execution
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" title="Installation overview" class="md-nav__link">
      Installation overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerinstall/" title="Installing docker" class="md-nav__link">
      Installing docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sgxinstall/" title="Installing Intel SGX driver" class="md-nav__link">
      Installing Intel SGX driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeinstall/" title="Installing SCONE" class="md-nav__link">
      Installing SCONE
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Updating CPU microcode
      </label>
    
    <a href="./" title="Updating CPU microcode" class="md-nav__link md-nav__link--active">
      Updating CPU microcode
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#microcode-update-on-ubuntu" title="Microcode Update on Ubuntu" class="md-nav__link">
    Microcode Update on Ubuntu
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#checking-cpu-features" title="Checking CPU Features" class="md-nav__link">
    Checking CPU Features
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../iexec_install/" title="Patched driver & engine" class="md-nav__link">
      Patched driver & engine
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Language Support
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Language Support
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../C/" title="C" class="md-nav__link">
      C
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../C++/" title="C++" class="md-nav__link">
      C++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Fortran/" title="Fortran" class="md-nav__link">
      Fortran
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GO/" title="GO" class="md-nav__link">
      GO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Java/" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pypyscone/" title="PyPy" class="md-nav__link">
      PyPy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nodejs/" title="Node" class="md-nav__link">
      Node
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../R/" title="R" class="md-nav__link">
      R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Rust/" title="Rust" class="md-nav__link">
      Rust
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      IDE Integration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        IDE Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../eclipse/" title="Eclipse" class="md-nav__link">
      Eclipse
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Command Line Interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Command Line Interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_CLI/" title="SCONE CLI" class="md-nav__link">
      SCONE CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_toolchain/" title="SCONE SGX toolchain" class="md-nav__link">
      SCONE SGX toolchain
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Curated_Images/" title="SCONE Curated Images" class="md-nav__link">
      SCONE Curated Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_TUTORIAL/" title="SCONE Static vs Dynamic" class="md-nav__link">
      SCONE Static vs Dynamic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_GENERATE_IMAGE/" title="SCONE Create Image" class="md-nav__link">
      SCONE Create Image
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Dockerfile/" title="SCONE Dockerfile" class="md-nav__link">
      SCONE Dockerfile
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Manuals
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Manuals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Fileshield/" title="scone fspf" class="md-nav__link">
      scone fspf
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_ENV/" title="environment variables" class="md-nav__link">
      environment variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MrEnclave/" title="MrEnclave" class="md-nav__link">
      MrEnclave
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fork/" title="fork" class="md-nav__link">
      fork
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../performance/" title="Performance" class="md-nav__link">
      Performance
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Background
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Background
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../appsecurity/" title="Application-Oriented Security" class="md-nav__link">
      Application-Oriented Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../background/" title="SCONE Background" class="md-nav__link">
      SCONE Background
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SCONE_Publications/" title="Publications" class="md-nav__link">
      Publications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../aboutScone/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#microcode-update-on-ubuntu" title="Microcode Update on Ubuntu" class="md-nav__link">
    Microcode Update on Ubuntu
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#checking-cpu-features" title="Checking CPU Features" class="md-nav__link">
    Checking CPU Features
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="l1tf-aka-foreshadow-mitigation">L1TF (a.k.a. Foreshadow) Mitigation<a class="headerlink" href="#l1tf-aka-foreshadow-mitigation" title="Permanent link">&para;</a></h1>
<p>Intel SGX is susceptible to a side channel attack in which an attacker can read the
secrets of an enclave <strong>E</strong> by starting an enclave <strong>A</strong> on the same core as <strong>E</strong>. This attack only works for secrets of <strong>E</strong> stored in a L1 cache  and if <strong>A</strong> and <strong>E</strong> run 
on the same core. This attack is referred to as <strong>enclave-to-enclave (E2E)</strong> attack.
E2E <strong>does not work</strong> if <strong>E</strong> and <strong>A</strong> run on different cores since each core has its own dedicated L1 cache.</p>
<p>The current Intel microcode ensures that the L1 cache of a core is flushed when a
thread leaves the enclave. In this way, if <strong>A</strong> runs after <strong>E</strong>, it will not be able
to read any secrets from <strong>L1</strong>. Note that flushing L1 is an expensive operation. SCONE keeps the threads running inside of an enclave and in this way avoids the cost of flushing
L1 on each system call.</p>
<p>The microcode update by Intel protects against L1TF only if <strong>hyperthreading</strong> is
disabled! If enclave <strong>A</strong> would run on one hyperthread and <strong>E</strong> on the second hyperthread of the same core, <strong>A</strong> could still read the values of <strong>E</strong> stored in <strong>L1</strong> using the L1TF side channel. Hence, you must also disable the <strong>hyperthreading</strong> inside of your BIOS<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>. If hyperthreading is switched on/off, is checked during attestation. In other words, one can ensure during attestation that the enclave is protected against L1TF.</p>
<p>According to <a href="https://software.intel.com/security-software-guidance/software-guidance/l1-terminal-fault">the Intel documentation</a>, an update microcode combined with switched off hyperthreading will <strong>fully mitigate L1TF and E2E for Intel SGX</strong>.</p>
<h2 id="microcode-update-on-ubuntu">Microcode Update on Ubuntu<a class="headerlink" href="#microcode-update-on-ubuntu" title="Permanent link">&para;</a></h2>
<p>Note that the BIOS loads the microcode during boot. The operating
system can load a newer version of the microcode, for example, in case there is no
new microcode update available yet for your BIOS. <strong>In this case, the OS has to load the new microcode on each new boot.</strong></p>
<p>On Ubuntu, you can upgrade your CPU  to the newest microcode as follows:</p>
<div class="codehilite"><pre><span></span><span class="nv">TMPDIR</span><span class="o">=</span><span class="k">$(</span>mktemp -d<span class="k">)</span>
<span class="nb">cd</span> <span class="nv">$TMPDIR</span>
git clone https://github.com/intel/Intel-Linux-Processor-Microcode-Data-Files.git
<span class="nb">cd</span> Intel-Linux-Processor-Microcode-Data-Files
sudo apt-get update
sudo apt-get install -y intel-microcode
<span class="k">if</span> <span class="o">[</span> -f /sys/devices/system/cpu/microcode/reload <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
    <span class="k">if</span> <span class="o">[</span> -d /lib/firmware <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        mkdir -p OLD
        cp -rf /lib/firmware/intel-ucode OLD
            sudo cp -rf intel-ucode /lib/firmware
        <span class="nb">echo</span> <span class="s2">&quot;1&quot;</span> <span class="p">|</span> sudo tee /sys/devices/system/cpu/microcode/reload
    <span class="k">else</span>
        <span class="nb">echo</span> <span class="s2">&quot;Error: microcode directory does not exist&quot;</span>
    <span class="k">fi</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;Error: is intel-micrcode really installed?&quot;</span>
<span class="k">fi</span>
</pre></div>

<p>You can check that a new microcode was updated by executing:</p>
<div class="codehilite"><pre><span></span>dmesg <span class="p">|</span> grep microcode
</pre></div>

<p>This will result in an output like</p>
<div class="codehilite"><pre><span></span><span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">121907</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU0</span> <span class="n">sig</span><span class="o">=</span><span class="mi">0</span><span class="n">x506e3</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="mi">0</span><span class="n">x2</span><span class="p">,</span> <span class="n">revision</span><span class="o">=</span><span class="mi">0</span><span class="n">xc2</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">129335</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU0</span> <span class="n">updated</span> <span class="k">to</span> <span class="n">revision</span> <span class="mi">0</span><span class="n">xc6</span><span class="p">,</span> <span class="nb">date</span> <span class="o">=</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">17</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">129406</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU1</span> <span class="n">sig</span><span class="o">=</span><span class="mi">0</span><span class="n">x506e3</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="mi">0</span><span class="n">x2</span><span class="p">,</span> <span class="n">revision</span><span class="o">=</span><span class="mi">0</span><span class="n">xc2</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">129484</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU1</span> <span class="n">updated</span> <span class="k">to</span> <span class="n">revision</span> <span class="mi">0</span><span class="n">xc6</span><span class="p">,</span> <span class="nb">date</span> <span class="o">=</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">17</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">129539</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU2</span> <span class="n">sig</span><span class="o">=</span><span class="mi">0</span><span class="n">x506e3</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="mi">0</span><span class="n">x2</span><span class="p">,</span> <span class="n">revision</span><span class="o">=</span><span class="mi">0</span><span class="n">xc2</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">129611</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU2</span> <span class="n">updated</span> <span class="k">to</span> <span class="n">revision</span> <span class="mi">0</span><span class="n">xc6</span><span class="p">,</span> <span class="nb">date</span> <span class="o">=</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">17</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">129696</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU3</span> <span class="n">sig</span><span class="o">=</span><span class="mi">0</span><span class="n">x506e3</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="mi">0</span><span class="n">x2</span><span class="p">,</span> <span class="n">revision</span><span class="o">=</span><span class="mi">0</span><span class="n">xc2</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">129768</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU3</span> <span class="n">updated</span> <span class="k">to</span> <span class="n">revision</span> <span class="mi">0</span><span class="n">xc6</span><span class="p">,</span> <span class="nb">date</span> <span class="o">=</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">17</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">129816</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU4</span> <span class="n">sig</span><span class="o">=</span><span class="mi">0</span><span class="n">x506e3</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="mi">0</span><span class="n">x2</span><span class="p">,</span> <span class="n">revision</span><span class="o">=</span><span class="mi">0</span><span class="n">xc2</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">129905</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU4</span> <span class="n">updated</span> <span class="k">to</span> <span class="n">revision</span> <span class="mi">0</span><span class="n">xc6</span><span class="p">,</span> <span class="nb">date</span> <span class="o">=</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">17</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">129953</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU5</span> <span class="n">sig</span><span class="o">=</span><span class="mi">0</span><span class="n">x506e3</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="mi">0</span><span class="n">x2</span><span class="p">,</span> <span class="n">revision</span><span class="o">=</span><span class="mi">0</span><span class="n">xc2</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">130025</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU5</span> <span class="n">updated</span> <span class="k">to</span> <span class="n">revision</span> <span class="mi">0</span><span class="n">xc6</span><span class="p">,</span> <span class="nb">date</span> <span class="o">=</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">17</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">130070</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU6</span> <span class="n">sig</span><span class="o">=</span><span class="mi">0</span><span class="n">x506e3</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="mi">0</span><span class="n">x2</span><span class="p">,</span> <span class="n">revision</span><span class="o">=</span><span class="mi">0</span><span class="n">xc2</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">130142</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU6</span> <span class="n">updated</span> <span class="k">to</span> <span class="n">revision</span> <span class="mi">0</span><span class="n">xc6</span><span class="p">,</span> <span class="nb">date</span> <span class="o">=</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">17</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">130224</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU7</span> <span class="n">sig</span><span class="o">=</span><span class="mi">0</span><span class="n">x506e3</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="mi">0</span><span class="n">x2</span><span class="p">,</span> <span class="n">revision</span><span class="o">=</span><span class="mi">0</span><span class="n">xc2</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">130296</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">CPU7</span> <span class="n">updated</span> <span class="k">to</span> <span class="n">revision</span> <span class="mi">0</span><span class="n">xc6</span><span class="p">,</span> <span class="nb">date</span> <span class="o">=</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">17</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">130298</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">Enabling</span> <span class="n">Indirect</span> <span class="n">Branch</span> <span class="n">Prediction</span> <span class="n">Barrier</span>
<span class="p">[</span>  <span class="mi">108</span><span class="p">.</span><span class="mi">130300</span><span class="p">]</span> <span class="n">microcode</span><span class="p">:</span> <span class="n">Enabling</span> <span class="n">Indirect</span> <span class="n">Branch</span> <span class="n">Restricted</span> <span class="n">Speculation</span>
</pre></div>

<p>When you are sure that this works out, you can load this microcode during reboot as follows:</p>
<div class="codehilite"><pre><span></span>cat &gt; /tmp/load-intel-ucode.sh <span class="s">&lt;&lt; EOF</span>
<span class="s">#!/bin/bash</span>
<span class="s">echo &quot;1&quot; | sudo tee /sys/devices/system/cpu/microcode/reload</span>
<span class="s">EOF</span>
sudo mv /tmp/load-intel-ucode.sh /lib/firmware/load-intel-ucode.sh
chmod a+x /lib/firmware/load-intel-ucode.sh
<span class="c1"># the following cmd pops up the editor: add the @reboot... via the editor</span>
crontab -e
@reboot /lib/firmware/load-intel-ucode.sh
</pre></div>

<h2 id="checking-cpu-features">Checking CPU Features<a class="headerlink" href="#checking-cpu-features" title="Permanent link">&para;</a></h2>
<div class="admonition note">
<p class="admonition-title">CPU microcode updates that protects against side channels like L1TF are not available for all CPUs.</p>
</div>
<p>You can check that your microcode has up to date protection
features enabled by executing the following:</p>
<div class="codehilite"><pre><span></span>docker run --rm sconecuratedimages/apps:check_cpuid
</pre></div>

<p>&copy; <a href="http://www.scontain.com">scontain.com</a>, August 2018. <a href="mailto:info@scontain.com">Questions or Suggestions?</a></p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>We have published an alternative to switching off hyperthreading in <a href="https://www.usenix.org/conference/atc18/presentation/oleksenko">Usenix ATC 2018</a>: we ensure that both hyperthreads of a core run inside of the same enclave.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../sconeinstall/" title="Installing SCONE" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Installing SCONE
              </span>
            </div>
          </a>
        
        
          <a href="../iexec_install/" title="Patched driver & engine" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Patched driver & engine
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright Scontain Â© 2019
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>