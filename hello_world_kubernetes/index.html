



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Scone Documentation - Secure Containers">
      
      
        <link rel="canonical" href="https://sconedocs.github.io/hello_world_kubernetes/">
      
      
        <meta name="author" content="Christof Fetzer">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching pages">
      
        <meta name="lang:search.result.one" content="1 matching page">
      
        <meta name="lang:search.result.other" content="# matching page">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/scone-favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.3">
    
    
      
        <title>Hello World Kubernetes - SCONE Confidential Computing</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:300,400,400i,700|">
        <style>body,input{font-family:"PT Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
      <link rel="stylesheet" href="../css/tooltips.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="purple">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#scone-on-kubernetes" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://sconedocs.github.io" title="SCONE Confidential Computing" class="md-header-nav__button md-logo">
          
            <img src="../img/logo-yellow-square.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                SCONE Confidential Computing
              </span>
              <span class="md-header-nav__topic">
                Hello World Kubernetes
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search this site" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching this site
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://sconedocs.github.io" title="SCONE Confidential Computing" class="md-nav__button md-logo">
      
        <img src="../img/logo-yellow-square.png" width="48" height="48">
      
    </a>
    SCONE Confidential Computing
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="News and Overview" class="md-nav__link">
      News and Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Quick Start
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Quick Start
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../sconify/" title="Sconify" class="md-nav__link">
      Sconify
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconify_hw_k8s/" title="Example" class="md-nav__link">
      Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconify_filetypes/" title="File Types" class="md-nav__link">
      File Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ee_sconify_image/" title="Sconify Image SE" class="md-nav__link">
      Sconify Image SE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multi-stakeholder-workflow/" title="Multi-Stakeholder Example" class="md-nav__link">
      Multi-Stakeholder Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../example_policy/" title="Policy Update" class="md-nav__link">
      Policy Update
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../faq_sconify/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cc-telenovela/" title="CC Soap Opera" class="md-nav__link">
      CC Soap Opera
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cc-university/" title="CC University" class="md-nav__link">
      CC University
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vm_vs_enclave/" title="Confidential Computing" class="md-nav__link">
      Confidential Computing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advantages/" title="Advantages of SCONE" class="md-nav__link">
      Advantages of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../whyscone/" title="SCONE vs Intel SGX SDK" class="md-nav__link">
      SCONE vs Intel SGX SDK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../technical_summary/" title="Technical summary of SCONE" class="md-nav__link">
      Technical summary of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../buildingApps/" title="(No) Cross-Compilation" class="md-nav__link">
      (No) Cross-Compilation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../registry/" title="Scontain Registy" class="md-nav__link">
      Scontain Registy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../curated_images/" title="Curated Images" class="md-nav__link">
      Curated Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../community_version/" title="Community Version" class="md-nav__link">
      Community Version
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      DevOps Workflows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        DevOps Workflows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../operations/" title="Workflows" class="md-nav__link">
      Workflows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mitigation/" title="Attack mitigation" class="md-nav__link">
      Attack mitigation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sadvisories/" title="Security advisories" class="md-nav__link">
      Security advisories
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software_updates/" title="Software updates" class="md-nav__link">
      Software updates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scone-signer/" title="Signing of enclaves" class="md-nav__link">
      Signing of enclaves
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scone_semantic_versioning/" title="SCONE versioning" class="md-nav__link">
      SCONE versioning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../attestation_by_client/" title="Attestation by client" class="md-nav__link">
      Attestation by client
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Kubernetes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Kubernetes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../k8s_concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm/" title="SconeApps" class="md-nav__link">
      SconeApps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_sgxdevplugin/" title="Kubernetes SGX Plugin" class="md-nav__link">
      Kubernetes SGX Plugin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kubeapps/" title="Kubeapps" class="md-nav__link">
      Kubeapps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../k8s_dashboard/" title="Kubernetes Dashboard" class="md-nav__link">
      Kubernetes Dashboard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_cas/" title="CAS Deploy & Attest" class="md-nav__link">
      CAS Deploy & Attest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_las/" title="LAS Deploy & Platforms" class="md-nav__link">
      LAS Deploy & Platforms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_mariadb/" title="MariaDB Deploy & Attest" class="md-nav__link">
      MariaDB Deploy & Attest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_teemon/" title="TEEMon Deployment" class="md-nav__link">
      TEEMon Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_vscode/" title="Visual Studio Code" class="md-nav__link">
      Visual Studio Code
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Hello World Kubernetes
      </label>
    
    <a href="./" title="Hello World Kubernetes" class="md-nav__link md-nav__link--active">
      Hello World Kubernetes
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#before-you-begin" title="Before you begin" class="md-nav__link">
    Before you begin
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-kubernetes-cluster-and-a-separate-namespace" title="A Kubernetes cluster and a separate namespace" class="md-nav__link">
    A Kubernetes cluster and a separate namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-sgx-device-plugin" title="Install SGX device plugin" class="md-nav__link">
    Install SGX device plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-yourself-a-workspace" title="Set yourself a workspace" class="md-nav__link">
    Set yourself a workspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-a-configuration-and-attestation-service-cas" title="Set a Configuration and Attestation Service (CAS)" class="md-nav__link">
    Set a Configuration and Attestation Service (CAS)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hello-world" title="Hello World!" class="md-nav__link">
    Hello World!
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-with-remote-attestation" title="Run with remote attestation" class="md-nav__link">
    Run with remote attestation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-with-certificates-auto-generated-by-cas" title="TLS with certificates auto-generated by CAS" class="md-nav__link">
    TLS with certificates auto-generated by CAS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encrypt-your-source-code" title="Encrypt your source code" class="md-nav__link">
    Encrypt your source code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encrypt-the-source-code-and-filesystem" title="Encrypt the source code and filesystem" class="md-nav__link">
    Encrypt the source code and filesystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-new-image" title="Build the new image" class="md-nav__link">
    Build the new image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-in-kubernetes" title="Run in Kubernetes" class="md-nav__link">
    Run in Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" title="Clean up" class="md-nav__link">
    Clean up
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      SconeApps
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        SconeApps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeapps_database/" title="database" class="md-nav__link">
      database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeapps_maxscale/" title="maxscale" class="md-nav__link">
      maxscale
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeapps_memcached/" title="memcached" class="md-nav__link">
      memcached
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeapps_nginx/" title="nginx" class="md-nav__link">
      nginx
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeapps_openvino/" title="openvino" class="md-nav__link">
      openvino
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeapps_pytorch/" title="pytorch" class="md-nav__link">
      pytorch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeapps_spark/" title="spark" class="md-nav__link">
      spark
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeapps_tensorflow/" title="tensorflow" class="md-nav__link">
      tensorflow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeapps_tensorflowlite/" title="tensorflowlite" class="md-nav__link">
      tensorflowlite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeapps_zookeeper/" title="zookeeper" class="md-nav__link">
      zookeeper
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Azure Kubernetes Services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Azure Kubernetes Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../aks/" title="Confidential AKS" class="md-nav__link">
      Confidential AKS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aks/flask_demo/" title="Flask Demo" class="md-nav__link">
      Flask Demo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python_images/" title="Python Images" class="md-nav__link">
      Python Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aks_integration/" title="AKS Integration" class="md-nav__link">
      AKS Integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MicrosoftAzureIntegrations/" title="AKS Integration Tutorial" class="md-nav__link">
      AKS Integration Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aks_charts/" title="AKS Applications" class="md-nav__link">
      AKS Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aks_setup/" title="AKS Setup" class="md-nav__link">
      AKS Setup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Client Specific Docs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Client Specific Docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-1" type="checkbox" id="nav-8-1">
    
    <label class="md-nav__link" for="nav-8-1">
      iExec
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-1">
        iExec
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../iexec_sconify_image/" title="iExec Sconify Image" class="md-nav__link">
      iExec Sconify Image
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Configuration & Attestation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Configuration & Attestation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CASOverview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_intro/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_for_development/" title="Starting CAS" class="md-nav__link">
      Starting CAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_config/" title="CAS Configuration" class="md-nav__link">
      CAS Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../public-CAS/" title="Public CAS" class="md-nav__link">
      Public CAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../LASIntro/" title="Starting LAS" class="md-nav__link">
      Starting LAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_blender_example/" title="Posting Sessions" class="md-nav__link">
      Posting Sessions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_cli-intro/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_cli/" title="CLI Reference" class="md-nav__link">
      CLI Reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_session_lang_0_2/" title="Policy Language 0.2" class="md-nav__link">
      Policy Language 0.2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_session_lang_0_3/" title="Policy Language 0.3" class="md-nav__link">
      Policy Language 0.3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../print-arg-env/" title="Secure Arguments" class="md-nav__link">
      Secure Arguments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EncryptedWordCount/" title="Encrypted Code and Input" class="md-nav__link">
      Encrypted Code and Input
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../node-example/" title="Node" class="md-nav__link">
      Node
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../namespace/" title="Namespaces" class="md-nav__link">
      Namespaces
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../scone-use-case-overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secure_remote_execution/" title="Secure Remote Execution" class="md-nav__link">
      Secure Remote Execution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerfileexample/" title="Dockerfile Example" class="md-nav__link">
      Dockerfile Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multistagebuild/" title="Multi-stage build" class="md-nav__link">
      Multi-stage build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../groupcacheUseCase/" title="GO example" class="md-nav__link">
      GO example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../memory_dump/" title="Finding Secrets" class="md-nav__link">
      Finding Secrets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dapps/" title="Trusted DApps" class="md-nav__link">
      Trusted DApps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../flask_demo/" title="Flask Demo" class="md-nav__link">
      Flask Demo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secure_document_management/" title="Secure Document Management" class="md-nav__link">
      Secure Document Management
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Use Cases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Use Cases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../usecases/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secure_document_management/" title="Confidential Document Management" class="md-nav__link">
      Confidential Document Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../federated_machine_learning/" title="Federated Machine Learning" class="md-nav__link">
      Federated Machine Learning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../shared_source_code/" title="Confidential Code Deployment" class="md-nav__link">
      Confidential Code Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../blender/" title="Blender" class="md-nav__link">
      Blender
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pyspark/" title="PySpark" class="md-nav__link">
      PySpark
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflow/" title="TensorFlow" class="md-nav__link">
      TensorFlow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflowlite/" title="TensorFlow Lite" class="md-nav__link">
      TensorFlow Lite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../openvino/" title="OpenVino" class="md-nav__link">
      OpenVino
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vault/" title="Vault" class="md-nav__link">
      Vault
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Execution Modes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Execution Modes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../outline/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../firstcontainer/" title="Simulation Mode" class="md-nav__link">
      Simulation Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hardwaremode/" title="Hardware Mode" class="md-nav__link">
      Hardware Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hostexample/" title="Host Execution" class="md-nav__link">
      Host Execution
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      Installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" title="Installation overview" class="md-nav__link">
      Installation overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerinstall/" title="Installing docker" class="md-nav__link">
      Installing docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sgxinstall/" title="Installing Intel SGX driver" class="md-nav__link">
      Installing Intel SGX driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeinstall/" title="Installing SCONE" class="md-nav__link">
      Installing SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../microcode/" title="Updating CPU microcode" class="md-nav__link">
      Updating CPU microcode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows10/" title="Windows 10" class="md-nav__link">
      Windows 10
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      Language Support
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        Language Support
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../C/" title="C" class="md-nav__link">
      C
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mono/" title="C#" class="md-nav__link">
      C#
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../C++/" title="C++" class="md-nav__link">
      C++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Fortran/" title="Fortran" class="md-nav__link">
      Fortran
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GO/" title="GO" class="md-nav__link">
      GO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Java/" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Running_Java_Applications_in_Scone_with_remote_attestation/" title="Java with remote attestation" class="md-nav__link">
      Java with remote attestation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pypyscone/" title="PyPy" class="md-nav__link">
      PyPy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mono/" title="Mono" class="md-nav__link">
      Mono
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nodejs/" title="Node" class="md-nav__link">
      Node
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../R/" title="R" class="md-nav__link">
      R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Rust/" title="Rust" class="md-nav__link">
      Rust
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15">
    
    <label class="md-nav__link" for="nav-15">
      IDE Integration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-15">
        IDE Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../eclipse/" title="Eclipse" class="md-nav__link">
      Eclipse
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_vscode/" title="Visual Studio Code" class="md-nav__link">
      Visual Studio Code
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16">
    
    <label class="md-nav__link" for="nav-16">
      Command Line Interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-16">
        Command Line Interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_CLI/" title="SCONE CLI" class="md-nav__link">
      SCONE CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_toolchain/" title="SCONE SGX toolchain" class="md-nav__link">
      SCONE SGX toolchain
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Curated_Images/" title="SCONE Curated Images" class="md-nav__link">
      SCONE Curated Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_TUTORIAL/" title="SCONE Static vs Dynamic" class="md-nav__link">
      SCONE Static vs Dynamic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_GENERATE_IMAGE/" title="SCONE Create Image" class="md-nav__link">
      SCONE Create Image
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Dockerfile/" title="SCONE Dockerfile" class="md-nav__link">
      SCONE Dockerfile
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-17" type="checkbox" id="nav-17">
    
    <label class="md-nav__link" for="nav-17">
      Manuals
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-17">
        Manuals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Fileshield/" title="scone fspf" class="md-nav__link">
      scone fspf
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../binary_fs/" title="scone binary fs" class="md-nav__link">
      scone binary fs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_ENV/" title="environment variables" class="md-nav__link">
      environment variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MrEnclave/" title="MrEnclave" class="md-nav__link">
      MrEnclave
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scone_affinity/" title="affinity" class="md-nav__link">
      affinity
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-18" type="checkbox" id="nav-18">
    
    <label class="md-nav__link" for="nav-18">
      Performance
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-18">
        Performance
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../performance/" title="Applications" class="md-nav__link">
      Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../teemon/" title="Monitoring tool" class="md-nav__link">
      Monitoring tool
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-19" type="checkbox" id="nav-19">
    
    <label class="md-nav__link" for="nav-19">
      Background
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-19">
        Background
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../appsecurity/" title="Application-Oriented Security" class="md-nav__link">
      Application-Oriented Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../background/" title="SCONE Background" class="md-nav__link">
      SCONE Background
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SCONE_Publications/" title="Publications" class="md-nav__link">
      Publications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../aboutScone/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-23" type="checkbox" id="nav-23">
    
    <label class="md-nav__link" for="nav-23">
      Releases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-23">
        Releases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../release5.5/" title="SCONE 5.5.0" class="md-nav__link">
      SCONE 5.5.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../release5.4/" title="SCONE 5.4.0" class="md-nav__link">
      SCONE 5.4.0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#before-you-begin" title="Before you begin" class="md-nav__link">
    Before you begin
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-kubernetes-cluster-and-a-separate-namespace" title="A Kubernetes cluster and a separate namespace" class="md-nav__link">
    A Kubernetes cluster and a separate namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-sgx-device-plugin" title="Install SGX device plugin" class="md-nav__link">
    Install SGX device plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-yourself-a-workspace" title="Set yourself a workspace" class="md-nav__link">
    Set yourself a workspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-a-configuration-and-attestation-service-cas" title="Set a Configuration and Attestation Service (CAS)" class="md-nav__link">
    Set a Configuration and Attestation Service (CAS)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hello-world" title="Hello World!" class="md-nav__link">
    Hello World!
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-with-remote-attestation" title="Run with remote attestation" class="md-nav__link">
    Run with remote attestation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-with-certificates-auto-generated-by-cas" title="TLS with certificates auto-generated by CAS" class="md-nav__link">
    TLS with certificates auto-generated by CAS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encrypt-your-source-code" title="Encrypt your source code" class="md-nav__link">
    Encrypt your source code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encrypt-the-source-code-and-filesystem" title="Encrypt the source code and filesystem" class="md-nav__link">
    Encrypt the source code and filesystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-new-image" title="Build the new image" class="md-nav__link">
    Build the new image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-in-kubernetes" title="Run in Kubernetes" class="md-nav__link">
    Run in Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" title="Clean up" class="md-nav__link">
    Clean up
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="scone-on-kubernetes">SCONE on Kubernetes</h1>
<p>This tutorial shows how to deploy confidential applications with the help of SCONE in a  Kubernetes cluster.</p>
<p>The tutorial is organized as follows:</p>
<ol>
<li><a href="#before-you-begin">Before you begin</a></li>
<li><a href="#hello-world">Hello World!</a></li>
<li><a href="#run-with-remote-attestation">Hello World! with remote attestation</a></li>
<li><a href="#tls-with-certificates-auto-generated-by-cas">Hello World! with TLS certificates auto-generated by CAS</a></li>
<li><a href="#encrypt-your-source-code">Encrypt your source code</a></li>
</ol>
<p>An executable version of this code can be cloned as follows:</p>
<div class="highlight"><pre><span></span>git clone https://github.com/scontain/hello-world-scone-on-kubernetes.git
</pre></div>

<div class="admonition info">
<p class="admonition-title">Note that you need to get access to the images<p><a href="mailto:info@scontain.com">Send us an email</a> to get access.</p>
</p>
</div>
<p>You can run this demo by executing:</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> hello-world-scone-on-kubernetes
./run_hello_world.sh
</pre></div>

<h3 id="before-you-begin">Before you begin</h3>
<h5 id="a-kubernetes-cluster-and-a-separate-namespace">A Kubernetes cluster and a separate namespace</h5>
<p>This tutorial assumes that you have access to a Kubernetes cluster (through <code>kubectl</code>), and that you are deploying everything to a separate namespace, called <code>hello-scone</code>. Namespaces are a good way to separate resources, not to mention how it makes the clean-up process a lot easier at the end:</p>
<div class="highlight"><pre><span></span>kubectl create namespace hello-scone
</pre></div>

<p>Don't forget to specify it by adding <code>-n hello-scone</code> to your <code>kubectl</code> commands.</p>
<h5 id="install-sgx-device-plugin">Install SGX device plugin</h5>
<p>SGX applications need access to the Intel SGX driver, a char device located at the host machine. The device name might differ depending on the driver implementation, but the most common ones are <code>/dev/sgx</code> (DCAP), <code>/dev/sgx/enclave</code> (in-tree) and <code>/dev/isgx</code> (IAS/out-of-tree). If you are in a cluster context, you need the right device mounted into the container. In Kubernetes, mounting host devices requires your applications to run in privileged mode.</p>
<p>We provide an SGX device plugin for Kubernetes, which lets you request the SGX driver through the <code>resource.limits</code> field (just like CPU or RAM). The device plugin handles different driver names transparently, and also allows your applications to run unprivileged (which is always good for security).</p>
<p>The SGX device plugin can be easily installed with the help of Helm:</p>
<div class="highlight"><pre><span></span>helm install sgxdevplugin sconeapps/sgxdevplugin
</pre></div>

<p>Please refer to <a href="https://sconedocs.github.io/helm_sgxdevplugin/">Kubernetes SGX plugin documentation</a> for more details and Helm setup instructions.</p>
<p>This tutorial assumes that you have the SGX device plugin running on your cluster.</p>
<blockquote>
<p><strong>NOTE</strong>: If you can't install the SGX device plugin for some reason, you have to mount the Intel SGX driver device manually into your container. To do so, <a href="https://sconedocs.github.io/sgxinstall/#determine-sgx-device">first figure out which driver is installed in your cluster</a>. Then update all the manifests below by removing the <code>resource.limits</code> field, and adding a <code>hostPath</code> and the respective <code>volumeMount</code> definitions. You also have to run the container in privileged mode by adding <code>privileged: true</code> to <code>securityContext</code>. Check a sample manifest in file <code>example-sgx-manual-mount.yamlr</code>.</p>
<p><strong>NOTE</strong>: If you don't have Intel SGX in your cluster, you can run SCONE in simulated mode by setting the environment variable <code>SCONE_MODE=sim</code>. The application will run encrypted in memory, but Intel SGX security guarantees do not apply.</p>
</blockquote>
<h5 id="set-yourself-a-workspace">Set yourself a workspace</h5>
<p>A lot of files are created through this tutorial, and they have to be somewhere. Choose whatever directory you want to run the commands below, but it might be a good idea to create a temporary one:</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="k">$(</span>mktemp -d<span class="k">)</span>
</pre></div>

<p>We use the following base image:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">BASE_IMAGE</span><span class="o">=</span>sconecuratedimages/kubernetes:python-3.7.3-alpine3.10-scone4.2
</pre></div>

<p>Have fun!</p>
<h5 id="set-a-configuration-and-attestation-service-cas">Set a Configuration and Attestation Service (CAS)</h5>
<p>When remote attestation enters the scene, you will need a CAS to provide attestation, configuration and secrets. Export now the address of your CAS. If you don't have your own CAS, use our public one at scone.ml:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">SCONE_CAS_ADDR</span><span class="o">=</span><span class="m">4</span>-2-1.scone-cas.cf
</pre></div>

<p>Now, generate client certificates (needed to submit new sessions to CAS):</p>
<div class="highlight"><pre><span></span>mkdir -p conf
<span class="k">if</span> <span class="o">[[</span> ! -f conf/client.crt <span class="o">||</span> ! -f conf/client-key.key  <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
    openssl req -x509 -newkey rsa:4096 -out conf/client.crt -keyout conf/client-key.key  -days <span class="m">31</span> -nodes -sha256 -subj <span class="s2">&quot;/C=US/ST=Dresden/L=Saxony/O=Scontain/OU=Org/CN=www.scontain.com&quot;</span> -reqexts SAN -extensions SAN -config &lt;<span class="o">(</span>cat /etc/ssl/openssl.cnf <span class="se">\</span>
&lt;<span class="o">(</span><span class="nb">printf</span> <span class="s1">&#39;[SAN]\nsubjectAltName=DNS:www.scontain.com&#39;</span><span class="o">))</span>
<span class="k">fi</span>
</pre></div>

<p>Create a <a href="https://sconedocs.github.io/namespace/">CAS namespace</a> for your sessions.</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">NS</span><span class="o">=</span>HelloWorld-<span class="nv">$RANDOM</span>-<span class="nv">$RANDOM</span>
cat &gt; namespace.yaml <span class="s">&lt;&lt;EOF</span>
<span class="s">name: $NS</span>

<span class="s">access_policy:</span>
<span class="s">  read:</span>
<span class="s">   - CREATOR</span>
<span class="s">  update:</span>
<span class="s">   - CREATOR</span>
<span class="s">EOF</span>
curl -v -k -s --cert conf/client.crt --key conf/client-key.key --data-binary @namespace.yaml -X POST https://<span class="nv">$SCONE_CAS_ADDR</span>:8081/v1/sessions
</pre></div>

<h3 id="hello-world">Hello World!</h3>
<p>Let's start by writing a simple Python webserver: it only returns the message <code>Hello World!</code> and the value of the environment variable <code>GREETING</code>.</p>
<div class="highlight"><pre><span></span>mkdir -p app
cat &gt; app/server.py <span class="s">&lt;&lt; EOF</span>
<span class="s">from http.server import HTTPServer</span>
<span class="s">from http.server import BaseHTTPRequestHandler</span>
<span class="s">import os</span>


<span class="s">class HTTPHelloWorldHandler(BaseHTTPRequestHandler):</span>
<span class="s">    def do_GET(self):</span>
<span class="s">        &quot;&quot;&quot;say &quot;Hello World!&quot; and the value of \`GREETING\` env. variable.&quot;&quot;&quot;</span>
<span class="s">        self.send_response(200)</span>
<span class="s">        self.end_headers()</span>
<span class="s">        self.wfile.write(b&#39;Hello World!\n\$GREETING is: %s\n&#39; % (os.getenv(&#39;GREETING&#39;, &#39;no greeting :(&#39;).encode()))</span>


<span class="s">httpd = HTTPServer((&#39;0.0.0.0&#39;, 8080), HTTPHelloWorldHandler)</span>


<span class="s">httpd.serve_forever()</span>
<span class="s">EOF</span>
</pre></div>

<p>To build this application with SCONE, simply use our Python 3.7 curated image as base. The Python interpreter will run inside of an enclave!</p>
<div class="highlight"><pre><span></span>cat &gt; Dockerfile <span class="s">&lt;&lt; EOF</span>
<span class="s">FROM $BASE_IMAGE</span>
<span class="s">EXPOSE 8080</span>
<span class="s">COPY app /app</span>
<span class="s">CMD [ &quot;python3&quot;, &quot;/app/server.py&quot; ]</span>
<span class="s">EOF</span>
</pre></div>

<p>Set the name of the image. If you already have an image, skip the building process.</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">IMAGE</span><span class="o">=</span>sconecuratedimages/kubernetes:hello-k8s-scone0.1
docker build --pull . -t <span class="nv">$IMAGE</span> <span class="o">&amp;&amp;</span> docker push <span class="nv">$IMAGE</span>
</pre></div>

<p>Deploying the application with Kubernetes is also simple: we just need a deployment and a service exposing it. </p>
<p>Write the Kubernetes manifests:</p>
<div class="highlight"><pre><span></span>cat &gt; app.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: hello-world</span>
<span class="s">spec:</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      run: hello-world</span>
<span class="s">  replicas: 1</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        run: hello-world</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - name: hello-world</span>
<span class="s">        image: $IMAGE</span>
<span class="s">        imagePullPolicy: Always</span>
<span class="s">        ports:</span>
<span class="s">        - containerPort: 8080</span>
<span class="s">        env:</span>
<span class="s">        - name: GREETING</span>
<span class="s">          value: howdy!</span>
<span class="s">        resources:</span>
<span class="s">          limits:</span>
<span class="s">            sgx.k8s.io/sgx: 1</span>
<span class="s">---</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  name: hello-world</span>
<span class="s">  labels:</span>
<span class="s">    run: hello-world</span>
<span class="s">spec:</span>
<span class="s">  ports:</span>
<span class="s">  - port: 8080</span>
<span class="s">    protocol: TCP</span>
<span class="s">  selector:</span>
<span class="s">    run: hello-world</span>
<span class="s">EOF</span>
</pre></div>

<p>Now, submit the manifests to the Kubernetes API, using <code>kubectl</code> command:</p>
<div class="highlight"><pre><span></span>kubectl create -f app.yaml -n hello-scone
</pre></div>

<p>Now that everything is deployed, you can access your Python app running on your cluster. Forward your local <code>8080</code> port to the service port:</p>
<div class="highlight"><pre><span></span>kubectl port-forward svc/hello-world <span class="m">8080</span>:8080 -n hello-scone
</pre></div>

<p>The application will be available at your <a href="http://localhost:8080">http://localhost:8080</a>:</p>
<div class="highlight"><pre><span></span>$ curl localhost:8080
Hello World!
<span class="nv">$GREETING</span> is: howdy!
</pre></div>

<h3 id="run-with-remote-attestation">Run with remote attestation</h3>
<p>SCONE provides a remote attestation feature, so you make sure your application is running unmodified. It's also possible to have secrets and configuration delivered directly to the attested enclave!</p>
<p>The remote attestation is provided by two components: LAS (local attestation service, runs on the cluster) and CAS (a trusted service that runs elsewhere. We provide a public one in 4-2-1.scone-cas.cf).</p>
<p>You can deploy LAS to your cluster with the help of a DaemonSet, deploying one LAS instance per cluster node. As your application has to contact the LAS container running in the same host, we use the default Docker interface (172.17.0.1) as our LAS address.</p>
<div class="highlight"><pre><span></span>cat &gt; las.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: DaemonSet</span>
<span class="s">metadata:</span>
<span class="s">  name: local-attestation</span>
<span class="s">  labels:</span>
<span class="s">    k8s-app: local-attestation</span>
<span class="s">spec:</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      k8s-app: local-attestation</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        k8s-app: local-attestation</span>
<span class="s">    spec:</span>
<span class="s">      hostNetwork: true</span>
<span class="s">      containers:</span>
<span class="s">        - name: local-attestation</span>
<span class="s">          image: sconecuratedimages/kubernetes:las-scone4.2</span>
<span class="s">          resources:</span>
<span class="s">            limits:</span>
<span class="s">              sgx.k8s.io/sgx: 1</span>
<span class="s">          ports:</span>
<span class="s">          - containerPort: 18766</span>
<span class="s">            hostPort: 18766</span>
<span class="s">EOF</span>
</pre></div>

<div class="highlight"><pre><span></span>kubectl create -f las.yaml -n hello-scone
</pre></div>

<p>To setup remote attestation, you will need a session file and the <code>MRENCLAVE</code>, which is a unique signature of your application. Extract <code>MRENCLAVE</code> of your application by running its container with the environment variable <code>SCONE_HASH</code> set to <code>1</code>:</p>
<div class="highlight"><pre><span></span><span class="nv">MRENCLAVE</span><span class="o">=</span><span class="sb">`</span>docker run -i --rm -e <span class="s2">&quot;SCONE_HASH=1&quot;</span> <span class="nv">$IMAGE</span><span class="sb">`</span>
</pre></div>

<p>Then create a session file. Please note that we are also defining a secret <code>GREETING</code>. Only the <code>MRENCLAVES</code> registered in this session file will be allowed to see such secret.</p>
<div class="highlight"><pre><span></span>cat &gt; session.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">name: $NS~hello-k8s-scone</span>
<span class="s">version: &quot;0.2&quot;</span>

<span class="s">services:</span>
<span class="s">   - name: application</span>
<span class="s">     mrenclaves: [$MRENCLAVE]</span>
<span class="s">     command: python3 /app/server.py</span>
<span class="s">     pwd: /</span>
<span class="s">     environment:</span>
<span class="s">        GREETING: hello from SCONE!!!</span>
<span class="s">EOF</span>
</pre></div>

<p>Now, <a href="https://sconedocs.github.io/cas_blender_example/">post the session file</a> to your CAS of choice:</p>
<div class="highlight"><pre><span></span>curl -v -k -s --cert conf/client.crt --key conf/client-key.key --data-binary @session.yaml -X POST https://<span class="nv">$SCONE_CAS_ADDR</span>:8081/v1/sessions
</pre></div>

<p>Once you submit the session file, you just need to inject the CAS address into your Deployment manifest. To showcase that, we're creating a new Deployment:</p>
<div class="highlight"><pre><span></span>cat &gt; attested-app.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: attested-hello-world</span>
<span class="s">spec:</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      run: attested-hello-world</span>
<span class="s">  replicas: 1</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        run: attested-hello-world</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - name: attested-hello-world</span>
<span class="s">        image: $IMAGE</span>
<span class="s">        imagePullPolicy: Always</span>
<span class="s">        ports:</span>
<span class="s">        - containerPort: 8080</span>
<span class="s">        env:</span>
<span class="s">        - name: SCONE_CAS_ADDR</span>
<span class="s">          value: $SCONE_CAS_ADDR</span>
<span class="s">        - name: SCONE_CONFIG_ID</span>
<span class="s">          value: $NS~hello-k8s-scone/application</span>
<span class="s">        - name: SCONE_LAS_ADDR</span>
<span class="s">          value: 172.17.0.1:18766</span>
<span class="s">        resources:</span>
<span class="s">          limits:</span>
<span class="s">            sgx.k8s.io/sgx: 1</span>
<span class="s">---</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  name: attested-hello-world</span>
<span class="s">  labels:</span>
<span class="s">    run: attested-hello-world</span>
<span class="s">spec:</span>
<span class="s">  ports:</span>
<span class="s">  - port: 8080</span>
<span class="s">    protocol: TCP</span>
<span class="s">  selector:</span>
<span class="s">    run: attested-hello-world</span>
<span class="s">EOF</span>
</pre></div>

<p><strong>NOTE</strong>: The environment defined in the Kubernetes manifest won't be considered once your app is attested. The environment will be retrieved from your session file.</p>
<p>Deploy your attested app:</p>
<div class="highlight"><pre><span></span>kubectl create -f attested-app.yaml -n hello-scone
</pre></div>

<p>Once again, forward your local port 8082 to the service port:</p>
<div class="highlight"><pre><span></span>kubectl port-forward svc/attested-hello-world <span class="m">8082</span>:8080 -n hello-scone
</pre></div>

<p>The attested application will be available at your <a href="http://localhost:8082">http://localhost:8082</a>:</p>
<div class="highlight"><pre><span></span>$ curl localhost:8082
Hello World!
<span class="nv">$GREETING</span> is: hello from SCONE!!!
</pre></div>

<h3 id="tls-with-certificates-auto-generated-by-cas">TLS with certificates auto-generated by CAS</h3>
<p>The CAS service can also generate secrets and certificates automatically. Combined with access policies, it means that such auto-generated secrets and certificates will be seen only by certain applications. No human (e.g. a system operator) will ever see them: they only exist inside of SGX enclaves.</p>
<p>To showcase such feature, let's use the same application as last example. But now, we serve the traffic over TLS, and we let CAS generate the server certificates.</p>
<p>Start by rewriting our application to serve with TLS:</p>
<div class="highlight"><pre><span></span>cat &gt; app/server-tls.py <span class="s">&lt;&lt; EOF</span>
<span class="s">from http.server import HTTPServer</span>
<span class="s">from http.server import BaseHTTPRequestHandler</span>
<span class="s">import os</span>
<span class="s">import socket</span>
<span class="s">import ssl</span>


<span class="s">class HTTPHelloWorldHandler(BaseHTTPRequestHandler):</span>
<span class="s">    def do_GET(self):</span>
<span class="s">        &quot;&quot;&quot;say &quot;Hello World!&quot; and the value of \`GREETING\` env. variable.&quot;&quot;&quot;</span>
<span class="s">        self.send_response(200)</span>
<span class="s">        self.end_headers()</span>
<span class="s">        self.wfile.write(b&#39;Hello World!\n\$GREETING is: %s\n&#39; % (os.getenv(&#39;GREETING&#39;, &#39;no greeting :(&#39;).encode()))</span>


<span class="s">httpd = HTTPServer((&#39;0.0.0.0&#39;, 4443), HTTPHelloWorldHandler)</span>


<span class="s">httpd.socket = ssl.wrap_socket(httpd.socket,</span>
<span class="s">                               keyfile=&quot;/app/key.pem&quot;,</span>
<span class="s">                               certfile=&quot;/app/cert.pem&quot;,</span>
<span class="s">                               server_side=True)</span>


<span class="s">httpd.serve_forever()</span>
<span class="s">EOF</span>
</pre></div>

<p>Our updated Dockerfile looks like this:</p>
<div class="highlight"><pre><span></span>cat &gt; Dockerfile <span class="s">&lt;&lt; EOF</span>
<span class="s">FROM $BASE_IMAGE</span>
<span class="s">EXPOSE 4443</span>
<span class="s">COPY app /app</span>
<span class="s">CMD [ &quot;python3&quot; ]</span>
<span class="s">EOF</span>
</pre></div>

<p>Build the updated image:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">IMAGE</span><span class="o">=</span>sconecuratedimages/kubernetes:hello-k8s-scone0.2
docker build --pull . -t <span class="nv">$IMAGE</span> <span class="o">&amp;&amp;</span> docker push <span class="nv">$IMAGE</span>
</pre></div>

<p>The magic is done in the session file. First, extract the <code>MRENCLAVE</code> again:</p>
<div class="highlight"><pre><span></span><span class="nv">MRENCLAVE</span><span class="o">=</span><span class="k">$(</span>docker run -i --rm -e <span class="s2">&quot;SCONE_HASH=1&quot;</span> <span class="nv">$IMAGE</span><span class="k">)</span>
</pre></div>

<p>Now, create a Session file to be submitted to CAS. The certificates are defined in the <code>secrets</code> field, and are injected into the filesystem through <code>images.injection_files</code>:</p>
<div class="highlight"><pre><span></span>cat &gt; session-tls-certs.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">name: $NS~hello-k8s-scone-tls-certs</span>
<span class="s">version: &quot;0.2&quot;</span>

<span class="s">services:</span>
<span class="s">   - name: application</span>
<span class="s">     image_name: application_image</span>
<span class="s">     mrenclaves: [$MRENCLAVE]</span>
<span class="s">     command: python3 /app/server-tls.py</span>
<span class="s">     pwd: /</span>
<span class="s">     environment:</span>
<span class="s">        GREETING: hello from SCONE with TLS and auto-generated certs!!!</span>

<span class="s">images:</span>
<span class="s">   - name: application_image</span>
<span class="s">     injection_files:</span>
<span class="s">       - path:  /app/cert.pem</span>
<span class="s">         content: \$\$SCONE::SERVER_CERT.crt\$\$</span>
<span class="s">       - path: /app/key.pem</span>
<span class="s">         content: \$\$SCONE::SERVER_CERT.key\$\$</span>

<span class="s">secrets:</span>
<span class="s">   - name: SERVER_CERT</span>
<span class="s">     kind: x509</span>
<span class="s">EOF</span>
</pre></div>

<p><a href="https://sconedocs.github.io/cas_blender_example/">Post the session file</a> to your CAS of choice:</p>
<div class="highlight"><pre><span></span>curl -k -s --cert conf/client.crt --key conf/client-key.key --data-binary @session-tls-certs.yaml -X POST https://<span class="nv">$SCONE_CAS_ADDR</span>:8081/session
</pre></div>

<p>The steps to run your app are similar to before: let's create a Kubernetes manifest and submit it.</p>
<div class="highlight"><pre><span></span>cat &gt; attested-app-tls-certs.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: attested-hello-world-tls-certs</span>
<span class="s">spec:</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      run: attested-hello-world-tls-certs</span>
<span class="s">  replicas: 1</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        run: attested-hello-world-tls-certs</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - name: attested-hello-world-tls-certs</span>
<span class="s">        image: $IMAGE</span>
<span class="s">        imagePullPolicy: Always</span>
<span class="s">        ports:</span>
<span class="s">        - containerPort: 4443</span>
<span class="s">        env:</span>
<span class="s">        - name: SCONE_CAS_ADDR</span>
<span class="s">          value: $SCONE_CAS_ADDR</span>
<span class="s">        - name: SCONE_CONFIG_ID</span>
<span class="s">          value: $NS~hello-k8s-scone-tls-certs/application</span>
<span class="s">        - name: SCONE_LAS_ADDR</span>
<span class="s">          value: &quot;172.17.0.1&quot;</span>
<span class="s">        resources:</span>
<span class="s">          limits:</span>
<span class="s">            sgx.k8s.io/sgx: 1</span>
<span class="s">---</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  name: attested-hello-world-tls-certs</span>
<span class="s">  labels:</span>
<span class="s">    run: attested-hello-world-tls-certs</span>
<span class="s">spec:</span>
<span class="s">  ports:</span>
<span class="s">  - port: 4443</span>
<span class="s">    protocol: TCP</span>
<span class="s">  selector:</span>
<span class="s">    run: attested-hello-world-tls-certs</span>
<span class="s">EOF</span>
</pre></div>

<div class="highlight"><pre><span></span>kubectl create -f attested-app-tls-certs.yaml -n hello-scone
</pre></div>

<p>Now it's time to access your app. Again, forward the traffic to its service:</p>
<div class="highlight"><pre><span></span>kubectl port-forward svc/attested-hello-world-tls-certs <span class="m">8083</span>:4443 -n hello-scone
</pre></div>

<p>And send a request:</p>
<div class="highlight"><pre><span></span>$ curl -k https://localhost:8083
Hello World!
<span class="nv">$GREETING</span> is: hello from SCONE with TLS and auto-generated certs!!!
</pre></div>

<h3 id="encrypt-your-source-code">Encrypt your source code</h3>
<p>Moving further, you can run the exact same application, but now the server source code will be encrypted using SCONE's <a href="https://sconedocs.github.io/SCONE_Fileshield/">file protection</a> feature, and only the Python interpreter that you register will be able to read them (after being attested by CAS).</p>
<h5 id="encrypt-the-source-code-and-filesystem">Encrypt the source code and filesystem</h5>
<p>Let's encrypt the source code using SCONE's Fileshield. Run a SCONE CLI container with access to the files:</p>
<div class="highlight"><pre><span></span>docker run -it --rm -e <span class="nv">SCONE_MODE</span><span class="o">=</span>sim -v <span class="nv">$PWD</span>:/tutorial <span class="nv">$BASE_IMAGE</span> sh
</pre></div>

<p>Inside the container, create an encrypted region <code>/app</code> and add all the files in <code>/tutorial/app</code> (the plain files) to it. Lastly, encrypt the key itself.</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> /tutorial
rm -rf app_image <span class="o">&amp;&amp;</span> mkdir -p app_image/app
<span class="nb">cd</span> app_image
scone fspf create fspf.pb
scone fspf addr fspf.pb / --not-protected --kernel /
scone fspf addr fspf.pb /app --encrypted --kernel /app
scone fspf addf fspf.pb /app /tutorial/app /tutorial/app_image/app
scone fspf encrypt fspf.pb &gt; /tutorial/app/keytag
</pre></div>

<p>The contents of <code>/tutorial/app_image/app</code> are now encrypted. Try to <code>cat</code> them from inside the container:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> /tutorial/app_image/app <span class="o">&amp;&amp;</span> ls
server-tls.py
$ cat server-tls.py
$<span class="o">(</span>E@
IdZg3ucmZ.$__!<span class="o">)</span>S<span class="o">(</span> XW<span class="o">{</span>$<span class="p">|</span>H!<span class="p">;</span><span class="m">2</span>&gt;@z4-h3ist7&lt;&gt;H4:<span class="o">(</span><span class="nv">9</span><span class="o">=</span>a<span class="o">)</span>j?pq3<span class="o">}</span>Ha<span class="p">|</span>w-q96o9Evv*$TU/vGT1&lt;C#p<span class="p">|</span>iA_!6Fw@
                   CJ+818
</pre></div>

<h5 id="build-the-new-image">Build the new image</h5>
<p>You can now exit the container. Let's build the server image with our files, now encrypted:</p>
<div class="highlight"><pre><span></span>cat &gt; Dockerfile <span class="s">&lt;&lt; EOF</span>
<span class="s">FROM $BASE_IMAGE</span>
<span class="s">EXPOSE 4443</span>
<span class="s">COPY app_image /</span>
<span class="s">CMD [ &quot;python3&quot; ]</span>
<span class="s">EOF</span>
</pre></div>

<p>Choose the new image name and build it:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">IMAGE</span><span class="o">=</span>sconecuratedimages/kubernetes:hello-k8s-scone-0.3
docker build --pull . -t <span class="nv">$IMAGE</span> <span class="o">&amp;&amp;</span> docker push <span class="nv">$IMAGE</span>
</pre></div>

<h5 id="run-in-kubernetes">Run in Kubernetes</h5>
<p>Time to deploy our server to Kubernetes. Let's setup the attestation first, so we make sure that only our application (identified by its <code>MRENCLAVE</code>) will have access to the secrets to read the encrypted filesystem, as well as our secret greeting.</p>
<p>Extract the <code>MRENCLAVE</code>:</p>
<div class="highlight"><pre><span></span><span class="nv">MRENCLAVE</span><span class="o">=</span><span class="k">$(</span>docker run -i --rm -e <span class="s2">&quot;SCONE_HASH=1&quot;</span> <span class="nv">$IMAGE</span><span class="k">)</span>
</pre></div>

<p>Extract <code>SCONE_FSPF_KEY</code> and <code>SCONE_FSPF_TAG</code>:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">SCONE_FSPF_KEY</span><span class="o">=</span><span class="k">$(</span>cat app/keytag <span class="p">|</span> awk <span class="s1">&#39;{print $11}&#39;</span><span class="k">)</span>
<span class="nb">export</span> <span class="nv">SCONE_FSPF_TAG</span><span class="o">=</span><span class="k">$(</span>cat app/keytag <span class="p">|</span> awk <span class="s1">&#39;{print $9}&#39;</span><span class="k">)</span>
<span class="nb">export</span> <span class="nv">SCONE_FSPF</span><span class="o">=</span>/fspf.pb
</pre></div>

<p>Create a session file:</p>
<div class="highlight"><pre><span></span>cat &gt; session-tls.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">name: $NS~hello-k8s-scone-tls</span>
<span class="s">version: &quot;0.2&quot;</span>

<span class="s">services:</span>
<span class="s">   - name: application</span>
<span class="s">     image_name: application_image</span>
<span class="s">     mrenclaves: [$MRENCLAVE]</span>
<span class="s">     command: python3 /app/server-tls.py</span>
<span class="s">     pwd: /</span>
<span class="s">     environment:</span>
<span class="s">        GREETING: hello from SCONE with encrypted source code and auto-generated certs!!!</span>
<span class="s">     fspf_path: $SCONE_FSPF</span>
<span class="s">     fspf_key: $SCONE_FSPF_KEY</span>
<span class="s">     fspf_tag: $SCONE_FSPF_TAG</span>

<span class="s">images:</span>
<span class="s">   - name: application_image</span>
<span class="s">     injection_files:</span>
<span class="s">       - path:  /app/cert.pem</span>
<span class="s">         content: \$\$SCONE::SERVER_CERT.crt\$\$</span>
<span class="s">       - path: /app/key.pem</span>
<span class="s">         content: \$\$SCONE::SERVER_CERT.key\$\$</span>

<span class="s">secrets:</span>
<span class="s">   - name: SERVER_CERT</span>
<span class="s">     kind: x509</span>
<span class="s">EOF</span>
</pre></div>

<p><a href="https://sconedocs.github.io/cas_blender_example/">Post the session file</a> to your CAS of choice:</p>
<div class="highlight"><pre><span></span>curl -k -s --cert conf/client.crt --key conf/client-key.key --data-binary @session-tls.yaml -X POST https://<span class="nv">$SCONE_CAS_ADDR</span>:8081/session
</pre></div>

<p>Create the manifest and submit it to your Kubernetes cluster:</p>
<div class="highlight"><pre><span></span>cat &gt; attested-app-tls.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: attested-hello-world-tls</span>
<span class="s">spec:</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      run: attested-hello-world-tls</span>
<span class="s">  replicas: 1</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        run: attested-hello-world-tls</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - name: attested-hello-world-tls</span>
<span class="s">        image: $IMAGE</span>
<span class="s">        imagePullPolicy: Always</span>
<span class="s">        ports:</span>
<span class="s">        - containerPort: 4443</span>
<span class="s">        env:</span>
<span class="s">        - name: SCONE_CAS_ADDR</span>
<span class="s">          value: $SCONE_CAS_ADDR</span>
<span class="s">        - name: SCONE_CONFIG_ID</span>
<span class="s">          value: $NS~hello-k8s-scone-tls/application</span>
<span class="s">        - name: SCONE_LAS_ADDR</span>
<span class="s">          value: 172.17.0.1</span>
<span class="s">        resources:</span>
<span class="s">          limits:</span>
<span class="s">            sgx.k8s.io/sgx: 1</span>
<span class="s">---</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  name: attested-hello-world-tls</span>
<span class="s">  labels:</span>
<span class="s">    run: attested-hello-world-tls</span>
<span class="s">spec:</span>
<span class="s">  ports:</span>
<span class="s">  - port: 4443</span>
<span class="s">    protocol: TCP</span>
<span class="s">  selector:</span>
<span class="s">    run: attested-hello-world-tls</span>
<span class="s">EOF</span>
</pre></div>

<div class="highlight"><pre><span></span>kubectl create -f attested-app-tls.yaml -n hello-scone
</pre></div>

<p>Time to access your app. Forward the traffic to its service:</p>
<div class="highlight"><pre><span></span>kubectl port-forward svc/attested-hello-world-tls <span class="m">8084</span>:4443 -n hello-scone
</pre></div>

<p>And send a request:</p>
<div class="highlight"><pre><span></span>$ curl -k https://localhost:8084
Hello World!
<span class="nv">$GREETING</span> is: hello from SCONE with encrypted <span class="nb">source</span> code and auto-generated certs!!!
</pre></div>

<h3 id="clean-up">Clean up</h3>
<p>To clean up all the resources created in this tutorial, simply delete the namespace:</p>
<div class="highlight"><pre><span></span>kubectl delete namespace hello-scone
</pre></div>

<p>Author: Clenimar</p>
<p>&copy; <a href="http://www.scontain.com">scontain.com</a>, 2021. <a href="mailto:info@scontain.com">Questions or Suggestions?</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../helm_vscode/" title="Visual Studio Code" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Visual Studio Code
              </span>
            </div>
          </a>
        
        
          <a href="../sconeapps_database/" title="database" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                database
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright Scontain  2021
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.e72fd936.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js"></script>
      
        <script src="../doc_theme/extra.js"></script>
      
        <script src="../search/main.js"></script>
      
    
    
      
    
  </body>
</html>