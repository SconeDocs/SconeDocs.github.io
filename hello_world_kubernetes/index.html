



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Scone Documentation - Secure Containers">
      
      
        <link rel="canonical" href="https://sconedocs.github.io/hello_world_kubernetes/">
      
      
        <meta name="author" content="Christof Fetzer">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching pages">
      
        <meta name="lang:search.result.one" content="1 matching page">
      
        <meta name="lang:search.result.other" content="# matching page">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/scone-favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.3">
    
    
      
        <title>Hello World Kubernetes - SCONE Confidential Computing</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:300,400,400i,700|">
        <style>body,input{font-family:"PT Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
      <link rel="stylesheet" href="../css/tooltips.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="purple">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#confidential-computing-with-scone" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://sconedocs.github.io" title="SCONE Confidential Computing" class="md-header-nav__button md-logo">
          
            <img src="../img/logo-yellow-square.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                SCONE Confidential Computing
              </span>
              <span class="md-header-nav__topic">
                Hello World Kubernetes
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search this site" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching this site
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://sconedocs.github.io" title="SCONE Confidential Computing" class="md-nav__button md-logo">
      
        <img src="../img/logo-yellow-square.png" width="48" height="48">
      
    </a>
    SCONE Confidential Computing
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href=".." title="Executive summary" class="md-nav__link">
      Executive summary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advantages/" title="Advantages of SCONE" class="md-nav__link">
      Advantages of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../whyscone/" title="SCONE vs Intel SGX SDK" class="md-nav__link">
      SCONE vs Intel SGX SDK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../technical_summary/" title="Technical summary of SCONE" class="md-nav__link">
      Technical summary of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../buildingApps/" title="(No) Cross-Compilation" class="md-nav__link">
      (No) Cross-Compilation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../curated_images/" title="Curated Images" class="md-nav__link">
      Curated Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../community_version/" title="Community Version" class="md-nav__link">
      Community Version
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Kubernetes SCONE CC
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Kubernetes SCONE CC
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../k8s_concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Hello World Kubernetes
      </label>
    
    <a href="./" title="Hello World Kubernetes" class="md-nav__link md-nav__link--active">
      Hello World Kubernetes
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#script" title="Script" class="md-nav__link">
    Script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#before-you-begin" title="Before you begin" class="md-nav__link">
    Before you begin
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-kubernetes-cluster-and-a-separate-namespace" title="A Kubernetes cluster and a separate namespace" class="md-nav__link">
    A Kubernetes cluster and a separate namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-yourself-a-workspace" title="Set yourself a workspace" class="md-nav__link">
    Set yourself a workspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-a-configuration-and-attestation-service-cas" title="Set a Configuration and Attestation Service (CAS)" class="md-nav__link">
    Set a Configuration and Attestation Service (CAS)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hello-world" title="Hello World!" class="md-nav__link">
    Hello World!
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-with-remote-attestation" title="Run with remote attestation" class="md-nav__link">
    Run with remote attestation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-with-certificates-auto-generated-by-cas" title="TLS with certificates auto-generated by CAS" class="md-nav__link">
    TLS with certificates auto-generated by CAS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encrypt-your-source-code" title="Encrypt your source code" class="md-nav__link">
    Encrypt your source code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encrypt-the-source-code-and-filesystem" title="Encrypt the source code and filesystem" class="md-nav__link">
    Encrypt the source code and filesystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-new-image" title="Build the new image" class="md-nav__link">
    Build the new image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-in-kubernetes" title="Run in Kubernetes" class="md-nav__link">
    Run in Kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" title="Clean up" class="md-nav__link">
    Clean up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../scone-use-case-overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secure_remote_execution/" title="Secure Remote Execution" class="md-nav__link">
      Secure Remote Execution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerfileexample/" title="Dockerfile Example" class="md-nav__link">
      Dockerfile Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multistagebuild/" title="Multi-stage build" class="md-nav__link">
      Multi-stage build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../groupcacheUseCase/" title="GO example" class="md-nav__link">
      GO example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../memory_dump/" title="Finding Secrets" class="md-nav__link">
      Finding Secrets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dapps/" title="Trusted DApps" class="md-nav__link">
      Trusted DApps
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Configuration & Attestation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Configuration & Attestation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CASOverview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_intro/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CASIntro/" title="Starting CAS" class="md-nav__link">
      Starting CAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../LASIntro/" title="Starting LAS" class="md-nav__link">
      Starting LAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_blender_example/" title="Posting Sessions" class="md-nav__link">
      Posting Sessions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../print-arg-env/" title="Secure Arguments" class="md-nav__link">
      Secure Arguments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EncryptedWordCount/" title="Encrypted Code and Input" class="md-nav__link">
      Encrypted Code and Input
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Use Cases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Use Cases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../usecases/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../blender/" title="Blender" class="md-nav__link">
      Blender
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pyspark/" title="PySpark" class="md-nav__link">
      PySpark
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflow/" title="TensorFlow" class="md-nav__link">
      TensorFlow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflowlite/" title="TensorFlow Lite" class="md-nav__link">
      TensorFlow Lite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../openvino/" title="OpenVino" class="md-nav__link">
      OpenVino
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vault/" title="Vault" class="md-nav__link">
      Vault
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Execution Modes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Execution Modes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../outline/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../firstcontainer/" title="Simulation Mode" class="md-nav__link">
      Simulation Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hardwaremode/" title="Hardware Mode" class="md-nav__link">
      Hardware Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hostexample/" title="Host Execution" class="md-nav__link">
      Host Execution
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" title="Installation overview" class="md-nav__link">
      Installation overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerinstall/" title="Installing docker" class="md-nav__link">
      Installing docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sgxinstall/" title="Installing Intel SGX driver" class="md-nav__link">
      Installing Intel SGX driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeinstall/" title="Installing SCONE" class="md-nav__link">
      Installing SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../microcode/" title="Updating CPU microcode" class="md-nav__link">
      Updating CPU microcode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../iexec_install/" title="Patched driver & engine" class="md-nav__link">
      Patched driver & engine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows10/" title="Windows 10" class="md-nav__link">
      Windows 10
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Continuous Integration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Continuous Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../scone_semantic_versioning/" title="Scone Semantic Versioning" class="md-nav__link">
      Scone Semantic Versioning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Language Support
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Language Support
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../C/" title="C" class="md-nav__link">
      C
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../C++/" title="C++" class="md-nav__link">
      C++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Fortran/" title="Fortran" class="md-nav__link">
      Fortran
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GO/" title="GO" class="md-nav__link">
      GO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Java/" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Running_Java_Applications_in_Scone_with_remote_attestation/" title="Java with remote attestation" class="md-nav__link">
      Java with remote attestation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pypyscone/" title="PyPy" class="md-nav__link">
      PyPy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nodejs/" title="Node" class="md-nav__link">
      Node
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../R/" title="R" class="md-nav__link">
      R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Rust/" title="Rust" class="md-nav__link">
      Rust
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      IDE Integration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        IDE Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../eclipse/" title="Eclipse" class="md-nav__link">
      Eclipse
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Command Line Interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Command Line Interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_CLI/" title="SCONE CLI" class="md-nav__link">
      SCONE CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_toolchain/" title="SCONE SGX toolchain" class="md-nav__link">
      SCONE SGX toolchain
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Curated_Images/" title="SCONE Curated Images" class="md-nav__link">
      SCONE Curated Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_TUTORIAL/" title="SCONE Static vs Dynamic" class="md-nav__link">
      SCONE Static vs Dynamic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_GENERATE_IMAGE/" title="SCONE Create Image" class="md-nav__link">
      SCONE Create Image
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Dockerfile/" title="SCONE Dockerfile" class="md-nav__link">
      SCONE Dockerfile
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Manuals
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Manuals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Fileshield/" title="scone fspf" class="md-nav__link">
      scone fspf
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_ENV/" title="environment variables" class="md-nav__link">
      environment variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MrEnclave/" title="MrEnclave" class="md-nav__link">
      MrEnclave
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scone_affinity/" title="affinity" class="md-nav__link">
      affinity
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      Performance
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        Performance
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../performance/" title="Applications" class="md-nav__link">
      Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../teemon/" title="Monitoring tool" class="md-nav__link">
      Monitoring tool
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      Background
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        Background
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../appsecurity/" title="Application-Oriented Security" class="md-nav__link">
      Application-Oriented Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../background/" title="SCONE Background" class="md-nav__link">
      SCONE Background
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SCONE_Publications/" title="Publications" class="md-nav__link">
      Publications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../aboutScone/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#script" title="Script" class="md-nav__link">
    Script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#before-you-begin" title="Before you begin" class="md-nav__link">
    Before you begin
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-kubernetes-cluster-and-a-separate-namespace" title="A Kubernetes cluster and a separate namespace" class="md-nav__link">
    A Kubernetes cluster and a separate namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-yourself-a-workspace" title="Set yourself a workspace" class="md-nav__link">
    Set yourself a workspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-a-configuration-and-attestation-service-cas" title="Set a Configuration and Attestation Service (CAS)" class="md-nav__link">
    Set a Configuration and Attestation Service (CAS)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hello-world" title="Hello World!" class="md-nav__link">
    Hello World!
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-with-remote-attestation" title="Run with remote attestation" class="md-nav__link">
    Run with remote attestation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-with-certificates-auto-generated-by-cas" title="TLS with certificates auto-generated by CAS" class="md-nav__link">
    TLS with certificates auto-generated by CAS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encrypt-your-source-code" title="Encrypt your source code" class="md-nav__link">
    Encrypt your source code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encrypt-the-source-code-and-filesystem" title="Encrypt the source code and filesystem" class="md-nav__link">
    Encrypt the source code and filesystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-new-image" title="Build the new image" class="md-nav__link">
    Build the new image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-in-kubernetes" title="Run in Kubernetes" class="md-nav__link">
    Run in Kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" title="Clean up" class="md-nav__link">
    Clean up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="confidential-computing-with-scone">Confidential Computing with SCONE<a class="headerlink" href="#confidential-computing-with-scone" title="Permanent link">&para;</a></h1>
<p>This tutorial shows how to build and deploy containerized CC App (Confidential Compute App) with the help of SCONE. We show how to run this CC App in a <strong>Kubernetes</strong> cluster.</p>
<p>This is a deep-dive to introduce some of the concepts of SCONE using a hands-on example. <strong>Note that the CC App we build is not yet sufficiently secure</strong>: e.g., the Python code of the base image can be manipulated. We will show in the second part of this tutorial how to run this securely and  how to simplify some of the steps.</p>
<p>The tutorial is organized as follows:</p>
<ul>
<li>
<p><a href="#before-you-begin">Before you begin</a> describes the initial setup required to run this example.</p>
</li>
<li>
<p><a href="#hello-world">Hello World!</a>  shows how to build a Python <code>Hello-World!</code> and run this in an enclave in a Kubernetes cluster. This enclaved service does not yet know any secrets.</p>
</li>
<li>
<p><a href="#run-with-remote-attestation">Hello World! with remote attestation</a> provides a secret <code>GREETING</code> to <code>Hello-World</code>. For this, we define a first SCONE policy to run <code>Hello-World!</code>: this policy passes the secret as an environment variable. It does not yet use https since it misses a certificate and a private key.</p>
</li>
<li>
<p><a href="#tls-with-certificates-auto-generated-by-cas">Hello World! with TLS certificates auto-generated by SCONE CAS</a> extends the policy to <strong>inject</strong> a certificate and a private key into the file system of  <code>Hello-World!</code>  So far, our policy only ensures that the expected Python engine runs but not that actually our <code>Hello-World!</code> program runs.</p>
</li>
<li>
<p><a href="#encrypt-your-source-code">Encrypt your source code</a>: we encrypt the <code>Hello-World!</code> program to ensure not only its <strong>confidentiality</strong> but also its <strong>integrity</strong> such that an adversary cannot change our program. SCONE ensures that the filesystem was not modified. Another way to look at this is that the <code>Hello-World!</code> program itself and the location where it is executed, is use to authenticate the program and to get the decryption key and all the secrets like the certificates.</p>
</li>
</ul>
<p>In the second part of this tutorial, we will show</p>
<ul>
<li>how to simplify the setup</li>
<li>how to ensure that all Python libraries are encrypted</li>
<li>how to ensure that this program can only run on the nodes of your Kubernetes cluster</li>
<li>how to provide access control to <code>Hello-World!</code>, i.e., only authorized clients can access the service, and</li>
<li>how to run <code>Hello-World!</code> in release mode</li>
</ul>
<h2 id="script">Script<a class="headerlink" href="#script" title="Permanent link">&para;</a></h2>
<p>An executable version of this tutorial can be cloned as follows:</p>
<div class="highlight"><pre><span></span>git clone https://github.com/scontain/hello-world-scone-on-kubernetes.git
</pre></div>

<p>You can run this demo by executing even if you do not yet have access to the <a href="../community_version/">community version</a>:</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> hello-world-scone-on-kubernetes
./run_hello_world.sh
</pre></div>

<p>The code has some more error handling and also some more details not discussed in this tutorial. Still, it will eventually fail with an error message since it will not be able to push a certain image (<code>IMAGE3</code>): you will not be able to execute an encrypted image of another <em>session</em>.</p>
<p>You need to change definition:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">IMAGE3</span><span class="o">=</span>sconecuratedimages/kubernetes:hello-k8s-scone0.3
</pre></div>

<p>in <code>run_hello_world.sh</code> to point to a container repo that you are permitted to push to.</p>
<h2 id="before-you-begin">Before you begin<a class="headerlink" href="#before-you-begin" title="Permanent link">&para;</a></h2>
<h3 id="a-kubernetes-cluster-and-a-separate-namespace">A Kubernetes cluster and a separate namespace<a class="headerlink" href="#a-kubernetes-cluster-and-a-separate-namespace" title="Permanent link">&para;</a></h3>
<p>This tutorial assumes that you have access to a Kubernetes cluster (through <code>kubectl</code>), and that you are deploying everything to a separate namespace, called <code>hello-scone</code>. Namespaces are a good way to separate resources, not to mention how it makes the clean-up process a lot easier at the end:</p>
<div class="highlight"><pre><span></span>kubectl create namespace hello-scone
</pre></div>

<p>Don't forget to specify it by adding <code>-n hello-scone</code> to your <code>kubectl</code> commands.</p>
<h3 id="set-yourself-a-workspace">Set yourself a workspace<a class="headerlink" href="#set-yourself-a-workspace" title="Permanent link">&para;</a></h3>
<p>A lot of files are created through this tutorial, and they have to be somewhere. Choose whatever directory you want to run the commands below, but it might be a good idea to create a temporary one:</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="k">$(</span>mktemp -d<span class="k">)</span>
</pre></div>

<p>We use the following base image:</p>
<p>export BASE_IMAGE=sconecuratedimages/apps:python-3.7.3-alpine3.10</p>
<p>Have fun!</p>
<h3 id="set-a-configuration-and-attestation-service-cas">Set a Configuration and Attestation Service (CAS)<a class="headerlink" href="#set-a-configuration-and-attestation-service-cas" title="Permanent link">&para;</a></h3>
<p>When remote attestation enters the scene, you will need a CAS to provide attestation, configuration and secrets. Export now the address of your CAS. If you don't have your own CAS, use our public one at scone-cas.cf:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">SCONE_CAS_ADDR</span><span class="o">=</span>scone-cas.cf
</pre></div>

<p>Now, generate client certificates (needed to submit new sessions to CAS):</p>
<div class="highlight"><pre><span></span>mkdir -p conf
<span class="k">if</span> <span class="o">[[</span> ! -f conf/client.crt <span class="o">||</span> ! -f conf/client-key.key  <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
    openssl req -x509 -newkey rsa:4096 -out conf/client.crt -keyout conf/client-key.key  -days <span class="m">31</span> -nodes -sha256 -subj <span class="s2">&quot;/C=US/ST=Dresden/L=Saxony/O=Scontain/OU=Org/CN=www.scontain.com&quot;</span> -reqexts SAN -extensions SAN -config &lt;<span class="o">(</span>cat /etc/ssl/openssl.cnf <span class="se">\</span>
&lt;<span class="o">(</span><span class="nb">printf</span> <span class="s1">&#39;[SAN]\nsubjectAltName=DNS:www.scontain.com&#39;</span><span class="o">))</span>
<span class="k">fi</span>
</pre></div>

<h2 id="hello-world">Hello World!<a class="headerlink" href="#hello-world" title="Permanent link">&para;</a></h2>
<p>Let's start by writing a simple Python webserver: it only returns the message <code>Hello World!</code> and the value of the environment variable <code>GREETING</code>.</p>
<div class="highlight"><pre><span></span>mkdir -p app
cat &gt; app/server.py <span class="s">&lt;&lt; EOF</span>
<span class="s">from http.server import HTTPServer</span>
<span class="s">from http.server import BaseHTTPRequestHandler</span>
<span class="s">import os</span>


<span class="s">class HTTPHelloWorldHandler(BaseHTTPRequestHandler):</span>
<span class="s">    def do_GET(self):</span>
<span class="s">        &quot;&quot;&quot;say &quot;Hello World!&quot; and the value of \`GREETING\` env. variable.&quot;&quot;&quot;</span>
<span class="s">        self.send_response(200)</span>
<span class="s">        self.end_headers()</span>
<span class="s">        self.wfile.write(b&#39;Hello World!\n\$GREETING is: %s\n&#39; % (os.getenv(&#39;GREETING&#39;, &#39;no greeting :(&#39;).encode()))</span>


<span class="s">httpd = HTTPServer((&#39;0.0.0.0&#39;, 8080), HTTPHelloWorldHandler)</span>


<span class="s">httpd.serve_forever()</span>
<span class="s">EOF</span>
</pre></div>

<p>To build this application with SCONE, simply use our Python 3.7 curated image as base. The Python interpreter will run inside of an enclave!</p>
<div class="highlight"><pre><span></span>cat &gt; Dockerfile <span class="s">&lt;&lt; EOF</span>
<span class="s">FROM $BASE_IMAGE</span>
<span class="s">EXPOSE 8080</span>
<span class="s">COPY app /app</span>
<span class="s">CMD [ &quot;python&quot;, &quot;/app/server.py&quot; ]</span>
<span class="s">EOF</span>
</pre></div>

<p>Set the name of the image. If you already have an image, skip the building process.</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">IMAGE</span><span class="o">=</span>sconecuratedimages/kubernetes:hello-k8s-scone0.1
docker build --pull . -t <span class="nv">$IMAGE</span> <span class="o">&amp;&amp;</span> docker push <span class="nv">$IMAGE</span>
</pre></div>

<p>Deploying the application with Kubernetes is also simple: we just need a deployment and a service exposing it. </p>
<p>Write the Kubernetes manifests:</p>
<div class="highlight"><pre><span></span>cat &gt; app.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: hello-world</span>
<span class="s">spec:</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      run: hello-world</span>
<span class="s">  replicas: 1</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        run: hello-world</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - name: hello-world</span>
<span class="s">        image: $IMAGE</span>
<span class="s">        imagePullPolicy: Always</span>
<span class="s">        ports:</span>
<span class="s">        - containerPort: 8080</span>
<span class="s">        env:</span>
<span class="s">        - name: GREETING</span>
<span class="s">          value: howdy!</span>
<span class="s">        volumeMounts:</span>
<span class="s">        - mountPath: /dev/isgx</span>
<span class="s">          name: dev-isgx</span>
<span class="s">        securityContext:</span>
<span class="s">          privileged: true</span>
<span class="s">      volumes:</span>
<span class="s">      - name: dev-isgx</span>
<span class="s">        hostPath:</span>
<span class="s">          path: /dev/isgx</span>
<span class="s">---</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  name: hello-world</span>
<span class="s">  labels:</span>
<span class="s">    run: hello-world</span>
<span class="s">spec:</span>
<span class="s">  ports:</span>
<span class="s">  - port: 8080</span>
<span class="s">    protocol: TCP</span>
<span class="s">  selector:</span>
<span class="s">    run: hello-world</span>
<span class="s">EOF</span>
</pre></div>

<p>Now, submit the manifests to the Kubernetes API, using <code>kubectl</code> command:</p>
<div class="highlight"><pre><span></span>kubectl create -f app.yaml -n hello-scone
</pre></div>

<blockquote>
<p><strong>NOTE</strong>: SGX applications need access to the Intel SGX driver, a char device located at <code>/dev/isgx</code> (in the host). If you are in a cluster context, it means that you need such device mounted into the container, and that's the reasoning behind the addition of the volume <code>dev-isgx</code> to the Kubernetes manifest. If you don't have access, or if you are not sure whether the underlying infrastructure has SGX installed, you can run in simulated mode, by adding <code>SCONE_MODE=sim</code> to the environment. This will emulate an enclave for you by encripting the main memory (Intel SGX security guarantees do not apply here).</p>
<p><strong>NOTE</strong>: You need special privileges to access a host device. Kubernetes does not allow a fine-grained access to such devices (like a Docker --device option does), so you need to run your container in privileged mode (i.e. your container has access to ALL host devices). This is defined in the container spec, as a <code>securityContext</code> policy (<code>privileged: true</code>).</p>
</blockquote>
<p>Now that everything is deployed, you can access your Python app running on your cluster. Forward your local <code>8080</code> port to the service port:</p>
<div class="highlight"><pre><span></span>kubectl port-forward svc/hello-world <span class="m">8080</span>:8080 -n hello-scone
</pre></div>

<p>The application will be available at your <a href="http://localhost:8080">http://localhost:8080</a>:</p>
<div class="highlight"><pre><span></span>$ curl localhost:8080
Hello World! Environment GREETING is: howdy!
</pre></div>

<h2 id="run-with-remote-attestation">Run with remote attestation<a class="headerlink" href="#run-with-remote-attestation" title="Permanent link">&para;</a></h2>
<p>SCONE provides a remote attestation feature, so you make sure your application is running unmodified. It's also possible to have secrets and configuration delivered directly to the attested enclave!</p>
<p>The remote attestation is provided by two components: LAS (local attestation service, runs on the cluster) and CAS (a trusted service that runs elsewhere. We provide a public one in scone-cas.cf).</p>
<p>You can deploy LAS to your cluster with the help of a DaemonSet, deploying one LAS instance per cluster node. As your application has to contact the LAS container running in the same host, we use the default Docker interface (172.17.0.1) as our LAS address.</p>
<div class="highlight"><pre><span></span>cat &gt; las.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: DaemonSet</span>
<span class="s">metadata:</span>
<span class="s">  name: local-attestation</span>
<span class="s">  labels:</span>
<span class="s">    k8s-app: local-attestation</span>
<span class="s">spec:</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      k8s-app: local-attestation</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        k8s-app: local-attestation</span>
<span class="s">    spec:</span>
<span class="s">      hostNetwork: true</span>
<span class="s">      volumes:</span>
<span class="s">      - name: dev-isgx</span>
<span class="s">        hostPath:</span>
<span class="s">          path: /dev/isgx</span>
<span class="s">      containers:</span>
<span class="s">        - name: local-attestation</span>
<span class="s">          image: sconecuratedimages/services:las</span>
<span class="s">          volumeMounts:</span>
<span class="s">          - mountPath: /dev/isgx</span>
<span class="s">            name: dev-isgx</span>
<span class="s">          securityContext:</span>
<span class="s">            privileged: true</span>
<span class="s">          ports:</span>
<span class="s">          - containerPort: 18766</span>
<span class="s">            hostPort: 18766</span>
<span class="s">EOF</span>
</pre></div>

<div class="highlight"><pre><span></span>kubectl create -f las.yaml -n hello-scone
</pre></div>

<p>To setup remote attestation, you will need a session file and the <code>MRENCLAVE</code>, which is a unique signature of your application. Extract <code>MRENCLAVE</code> of your application by running its container with the environment variable <code>SCONE_HASH</code> set to <code>1</code>:</p>
<div class="highlight"><pre><span></span><span class="nv">MRENCLAVE</span><span class="o">=</span><span class="sb">`</span>docker run -i --rm -e <span class="s2">&quot;SCONE_HASH=1&quot;</span> <span class="nv">$IMAGE</span><span class="sb">`</span>
</pre></div>

<p>Then create a session file. Please note that we are also defining a secret <code>GREETING</code>. Only the <code>MRENCLAVES</code> registered in this session file will be allowed to see such secret.</p>
<div class="highlight"><pre><span></span>cat &gt; session.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">name: hello-k8s-scone</span>
<span class="s">version: &quot;0.2&quot;</span>

<span class="s">services:</span>
<span class="s">   - name: application</span>
<span class="s">     image_name: $IMAGE</span>
<span class="s">     mrenclaves: [$MRENCLAVE]</span>
<span class="s">     command: python /app/server.py</span>
<span class="s">     pwd: /</span>
<span class="s">     environment:</span>
<span class="s">        GREETING: hello from SCONE!!!</span>

<span class="s">images:</span>
<span class="s">   - name: $IMAGE</span>
<span class="s">EOF</span>
</pre></div>

<p>Now, <a href="https://sconedocs.github.io/cas_blender_example/">post the session file</a> to your CAS of choice:</p>
<div class="highlight"><pre><span></span>curl -v -k -s --cert conf/client.crt --key conf/client-key.key --data-binary @session.yaml -X POST https://<span class="nv">$SCONE_CAS_ADDR</span>:8081/v1/sessions
</pre></div>

<p>Once you submit the session file, you just need to inject the CAS address into your Deployment manifest. To showcase that, we're creating a new Deployment:</p>
<div class="highlight"><pre><span></span>cat &gt; attested-app.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: attested-hello-world</span>
<span class="s">spec:</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      run: attested-hello-world</span>
<span class="s">  replicas: 1</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        run: attested-hello-world</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - name: attested-hello-world</span>
<span class="s">        image: $IMAGE</span>
<span class="s">        imagePullPolicy: Always</span>
<span class="s">        ports:</span>
<span class="s">        - containerPort: 8080</span>
<span class="s">        env:</span>
<span class="s">        - name: SCONE_CAS_ADDR</span>
<span class="s">          value: $SCONE_CAS_ADDR</span>
<span class="s">        - name: SCONE_CONFIG_ID</span>
<span class="s">          value: hello-k8s-scone/application</span>
<span class="s">        - name: SCONE_LAS_ADDR</span>
<span class="s">          value: 172.17.0.1:18766</span>
<span class="s">        volumeMounts:</span>
<span class="s">        - mountPath: /dev/isgx</span>
<span class="s">          name: dev-isgx</span>
<span class="s">        securityContext:</span>
<span class="s">          privileged: true</span>
<span class="s">      volumes:</span>
<span class="s">      - name: dev-isgx</span>
<span class="s">        hostPath:</span>
<span class="s">          path: /dev/isgx</span>
<span class="s">---</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  name: attested-hello-world</span>
<span class="s">  labels:</span>
<span class="s">    run: attested-hello-world</span>
<span class="s">spec:</span>
<span class="s">  ports:</span>
<span class="s">  - port: 8080</span>
<span class="s">    protocol: TCP</span>
<span class="s">  selector:</span>
<span class="s">    run: attested-hello-world</span>
<span class="s">EOF</span>
</pre></div>

<p><strong>NOTE</strong>: The environment defined in the Kubernetes manifest won't be considered once your app is attested. The environment will be retrieved from your session file.</p>
<p>Deploy your attested app:</p>
<div class="highlight"><pre><span></span>kubectl create -f attested-app.yaml -n hello-scone
</pre></div>

<p>Once again, forward your local port 8081 to the service port:</p>
<div class="highlight"><pre><span></span>kubectl port-forward svc/attested-hello-world <span class="m">8081</span>:8080 -n hello-scone
</pre></div>

<p>The attested application will be available at your <a href="http://localhost:8081">http://localhost:8081</a>:</p>
<div class="highlight"><pre><span></span>$ curl localhost:8081
Hello World! Environment GREETING is: hello from SCONE!!!
</pre></div>

<h2 id="tls-with-certificates-auto-generated-by-cas">TLS with certificates auto-generated by CAS<a class="headerlink" href="#tls-with-certificates-auto-generated-by-cas" title="Permanent link">&para;</a></h2>
<p>The CAS service can also generate secrets and certificates automatically. Combined with access policies, it means that such auto-generated secrets and certificates will be seen only by certain applications. No human (e.g. a system operator) will ever see them: they only exist inside of SGX enclaves.</p>
<p>To showcase such feature, let's use the same application as last example. But now, we serve the traffic over TLS, and we let CAS generate the server certificates.</p>
<p>Start by rewriting our application to serve with TLS:</p>
<div class="highlight"><pre><span></span>cat &gt; app/server-tls.py <span class="s">&lt;&lt; EOF</span>
<span class="s">from http.server import HTTPServer</span>
<span class="s">from http.server import BaseHTTPRequestHandler</span>
<span class="s">import os</span>
<span class="s">import socket</span>
<span class="s">import ssl</span>


<span class="s">class HTTPHelloWorldHandler(BaseHTTPRequestHandler):</span>
<span class="s">    def do_GET(self):</span>
<span class="s">        &quot;&quot;&quot;say &quot;Hello World!&quot; and the value of \`GREETING\` env. variable.&quot;&quot;&quot;</span>
<span class="s">        self.send_response(200)</span>
<span class="s">        self.end_headers()</span>
<span class="s">        self.wfile.write(b&#39;Hello World!\n\$GREETING is: %s\n&#39; % (os.getenv(&#39;GREETING&#39;, &#39;no greeting :(&#39;).encode()))</span>


<span class="s">httpd = HTTPServer((&#39;0.0.0.0&#39;, 4443), HTTPHelloWorldHandler)</span>


<span class="s">httpd.socket = ssl.wrap_socket(httpd.socket,</span>
<span class="s">                               keyfile=&quot;/app/key.pem&quot;,</span>
<span class="s">                               certfile=&quot;/app/cert.pem&quot;,</span>
<span class="s">                               server_side=True)</span>


<span class="s">httpd.serve_forever()</span>
<span class="s">EOF</span>
</pre></div>

<p>Our updated Dockerfile looks like this:</p>
<div class="highlight"><pre><span></span>cat &gt; Dockerfile <span class="s">&lt;&lt; EOF</span>
<span class="s">FROM $BASE_IMAGE</span>
<span class="s">EXPOSE 4443</span>
<span class="s">COPY app /app</span>
<span class="s">CMD [ &quot;/usr/local/bin/python&quot; ]</span>
<span class="s">EOF</span>
</pre></div>

<p>Build the updated image:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">IMAGE</span><span class="o">=</span>sconecuratedimages/kubernetes:hello-k8s-scone0.2
docker build --pull . -t <span class="nv">$IMAGE</span> <span class="o">&amp;&amp;</span> docker push <span class="nv">$IMAGE</span>
</pre></div>

<p>The magic is done in the session file. First, extract the <code>MRENCLAVE</code> again:</p>
<div class="highlight"><pre><span></span><span class="nv">MRENCLAVE</span><span class="o">=</span><span class="k">$(</span>docker run -i --rm --device /dev/isgx -e <span class="s2">&quot;SCONE_HASH=1&quot;</span> <span class="nv">$IMAGE</span><span class="k">)</span>
</pre></div>

<p>Now, create a Session file to be submitted to CAS. The certificates are defined in the <code>secrets</code> field, and are injected into the filesystem through <code>images.injection_files</code>:</p>
<div class="highlight"><pre><span></span>cat &gt; session-tls-certs.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">name: hello-k8s-scone-tls-certs</span>
<span class="s">version: &quot;0.2&quot;</span>

<span class="s">services:</span>
<span class="s">   - name: application</span>
<span class="s">     image_name: $IMAGE</span>
<span class="s">     mrenclaves: [$MRENCLAVE]</span>
<span class="s">     command: python /app/server-tls.py</span>
<span class="s">     pwd: /</span>
<span class="s">     environment:</span>
<span class="s">        GREETING: hello from SCONE with TLS and auto-generated certs!!!</span>

<span class="s">images:</span>
<span class="s">   - name: $IMAGE</span>
<span class="s">     injection_files:</span>
<span class="s">       - path:  /app/cert.pem</span>
<span class="s">         content: \$\$SCONE::SERVER_CERT.crt\$\$</span>
<span class="s">       - path: /app/key.pem</span>
<span class="s">         content: \$\$SCONE::SERVER_CERT.key\$\$</span>

<span class="s">secrets:</span>
<span class="s">   - name: SERVER_CERT</span>
<span class="s">     kind: x509</span>
<span class="s">EOF</span>
</pre></div>

<p><a href="https://sconedocs.github.io/cas_blender_example/">Post the session file</a> to your CAS of choice:</p>
<div class="highlight"><pre><span></span>curl -k -s --cert conf/client.crt --key conf/client-key.key --data-binary @session-tls-certs.yaml -X POST https://<span class="nv">$SCONE_CAS_ADDR</span>:8081/session
</pre></div>

<p>The steps to run your app are similar to before: let's create a Kubernetes manifest and submit it.</p>
<div class="highlight"><pre><span></span>cat &gt; attested-app-tls-certs.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: attested-hello-world-tls-certs</span>
<span class="s">spec:</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      run: attested-hello-world-tls-certs</span>
<span class="s">  replicas: 1</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        run: attested-hello-world-tls-certs</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - name: attested-hello-world-tls-certs</span>
<span class="s">        image: $IMAGE</span>
<span class="s">        imagePullPolicy: Always</span>
<span class="s">        ports:</span>
<span class="s">        - containerPort: 4443</span>
<span class="s">        env:</span>
<span class="s">        - name: SCONE_CAS_ADDR</span>
<span class="s">          value: $SCONE_CAS_ADDR</span>
<span class="s">        - name: SCONE_CONFIG_ID</span>
<span class="s">          value: hello-k8s-scone-tls-certs/application</span>
<span class="s">        - name: SCONE_LAS_ADDR</span>
<span class="s">          value: &quot;172.17.0.1&quot;</span>
<span class="s">        volumeMounts:</span>
<span class="s">        - mountPath: /dev/isgx</span>
<span class="s">          name: dev-isgx</span>
<span class="s">        securityContext:</span>
<span class="s">          privileged: true</span>
<span class="s">      volumes:</span>
<span class="s">      - name: dev-isgx</span>
<span class="s">        hostPath:</span>
<span class="s">          path: /dev/isgx</span>
<span class="s">---</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  name: attested-hello-world-tls-certs</span>
<span class="s">  labels:</span>
<span class="s">    run: attested-hello-world-tls-certs</span>
<span class="s">spec:</span>
<span class="s">  ports:</span>
<span class="s">  - port: 4443</span>
<span class="s">    protocol: TCP</span>
<span class="s">  selector:</span>
<span class="s">    run: attested-hello-world-tls-certs</span>
<span class="s">EOF</span>
</pre></div>

<div class="highlight"><pre><span></span>kubectl create -f attested-app-tls-certs.yaml -n hello-scone
</pre></div>

<p>Now it's time to access your app. Again, forward the traffic to its service:</p>
<div class="highlight"><pre><span></span>kubectl port-forward svc/attested-hello-world-tls-certs <span class="m">8083</span>:4443 -n hello-scone
</pre></div>

<p>And send a request:</p>
<div class="highlight"><pre><span></span>$ curl -k https://localhost:8083
Hello World!
<span class="nv">$GREETING</span> is: hello from SCONE with TLS and auto-generated certs!!!
</pre></div>

<h2 id="encrypt-your-source-code">Encrypt your source code<a class="headerlink" href="#encrypt-your-source-code" title="Permanent link">&para;</a></h2>
<p>Moving further, you can run the exact same application, but now the server source code will be encrypted using SCONE's <a href="https://sconedocs.github.io/SCONE_Fileshield/">file protection</a> feature, and only the Python interpreter that you register will be able to read them (after being attested by CAS).</p>
<h3 id="encrypt-the-source-code-and-filesystem">Encrypt the source code and filesystem<a class="headerlink" href="#encrypt-the-source-code-and-filesystem" title="Permanent link">&para;</a></h3>
<p>Let's encrypt the source code using SCONE's Fileshield. Run a SCONE CLI container with access to the files:</p>
<div class="highlight"><pre><span></span>docker run -it --rm --device /dev/isgx -v <span class="nv">$PWD</span>:/tutorial <span class="nv">$BASE_IMAGE</span> sh
</pre></div>

<p>Inside the container, create an encrypted region <code>/app</code> and add all the files in <code>/tutorial/app</code> (the plain files) to it. Lastly, encrypt the key itself.</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> /tutorial
rm -rf app_image <span class="o">&amp;&amp;</span> mkdir -p app_image/app
<span class="nb">cd</span> app_image
scone fspf create fspf.pb
scone fspf addr fspf.pb / --not-protected --kernel /
scone fspf addr fspf.pb /app --encrypted --kernel /app
scone fspf addf fspf.pb /app /tutorial/app /tutorial/app_image/app
scone fspf encrypt fspf.pb &gt; /tutorial/app/keytag
</pre></div>

<p>The contents of <code>/tutorial/app_image/app</code> are now encrypted. Try to <code>cat</code> them from inside the container:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> /tutorial/app_image/app <span class="o">&amp;&amp;</span> ls
server-tls.py
$ cat server-tls.py
$�ʇ<span class="o">(</span>E@��
�����Id�Z���g3uc��mѪ�Z.$�__�!<span class="o">)</span>ҹS��٠���<span class="o">(</span>�� �X�Wϐ�<span class="o">{</span>$���<span class="p">|</span>�זH��Ǔ��!<span class="p">;</span><span class="m">2</span>����&gt;@z4-�h��3iݾs�t�7�&lt;&gt;H4:����<span class="o">(</span><span class="nv">9</span><span class="o">=</span>�a<span class="o">)</span>�j?��p����q�ߧ3�<span class="o">}</span>��Hظa�<span class="p">|</span>���w-�q��96���o�9̃�Ev�v��*$����TU/���Ӕ��v�G���T�1&lt;ڹ��C#p<span class="p">|</span>i��AƢ˅_!6���F���w�@
                   �C��J���+81�8�
</pre></div>

<h3 id="build-the-new-image">Build the new image<a class="headerlink" href="#build-the-new-image" title="Permanent link">&para;</a></h3>
<p>You can now exit the container. Let's build the server image with our files, now encrypted:</p>
<div class="highlight"><pre><span></span>cat &gt; Dockerfile <span class="s">&lt;&lt; EOF</span>
<span class="s">FROM $BASE_IMAGE</span>
<span class="s">EXPOSE 4443</span>
<span class="s">COPY app_image /</span>
<span class="s">CMD [ &quot;/usr/local/bin/python&quot; ]</span>
<span class="s">EOF</span>
</pre></div>

<p>Choose the new image name and build it:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">IMAGE3</span><span class="o">=</span>sconecuratedimages/kubernetes:hello-k8s-scone0.3
docker build --pull . -t <span class="nv">$IMAGE3</span> <span class="o">&amp;&amp;</span> docker push <span class="nv">$IMAGE3</span>
</pre></div>

<h3 id="run-in-kubernetes">Run in Kubernetes<a class="headerlink" href="#run-in-kubernetes" title="Permanent link">&para;</a></h3>
<p>Time to deploy our server to Kubernetes. Let's setup the attestation first, so we make sure that only our application (identified by its <code>MRENCLAVE</code>) will have access to the secrets to read the encrypted filesystem, as well as our secret greeting.</p>
<p>Extract the <code>MRENCLAVE</code>:</p>
<div class="highlight"><pre><span></span><span class="nv">MRENCLAVE</span><span class="o">=</span><span class="k">$(</span>docker run -i --rm --device /dev/isgx -e <span class="s2">&quot;SCONE_HASH=1&quot;</span> <span class="nv">$IMAGE3</span><span class="k">)</span>
</pre></div>

<p>Extract <code>SCONE_FSPF_KEY</code> and <code>SCONE_FSPF_TAG</code>:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">SCONE_FSPF_KEY</span><span class="o">=</span><span class="k">$(</span>cat app/keytag <span class="p">|</span> awk <span class="s1">&#39;{print $11}&#39;</span><span class="k">)</span>
<span class="nb">export</span> <span class="nv">SCONE_FSPF_TAG</span><span class="o">=</span><span class="k">$(</span>cat app/keytag <span class="p">|</span> awk <span class="s1">&#39;{print $9}&#39;</span><span class="k">)</span>
<span class="nb">export</span> <span class="nv">SCONE_FSPF</span><span class="o">=</span>/fspf.pb
</pre></div>

<p>Create a session file:</p>
<div class="highlight"><pre><span></span>cat &gt; session-tls.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">name: hello-k8s-scone-tls</span>
<span class="s">version: &quot;0.2&quot;</span>

<span class="s">services:</span>
<span class="s">   - name: application</span>
<span class="s">     image_name: $IMAGE3</span>
<span class="s">     mrenclaves: [$MRENCLAVE]</span>
<span class="s">     command: python /app/server-tls.py</span>
<span class="s">     pwd: /</span>
<span class="s">     environment:</span>
<span class="s">        GREETING: hello from SCONE with encrypted source code and auto-generated certs!!!</span>
<span class="s">     fspf_path: $SCONE_FSPF</span>
<span class="s">     fspf_key: $SCONE_FSPF_KEY</span>
<span class="s">     fspf_tag: $SCONE_FSPF_TAG</span>

<span class="s">images:</span>
<span class="s">   - name: $IMAGE3</span>
<span class="s">     injection_files:</span>
<span class="s">       - path:  /app/cert.pem</span>
<span class="s">         content: \$\$SCONE::SERVER_CERT.crt\$\$</span>
<span class="s">       - path: /app/key.pem</span>
<span class="s">         content: \$\$SCONE::SERVER_CERT.key\$\$</span>

<span class="s">secrets:</span>
<span class="s">   - name: SERVER_CERT</span>
<span class="s">     kind: x509</span>
<span class="s">EOF</span>
</pre></div>

<p><a href="https://sconedocs.github.io/cas_blender_example/">Post the session file</a> to your CAS of choice:</p>
<div class="highlight"><pre><span></span>curl -k -s --cert conf/client.crt --key conf/client-key.key --data-binary @session-tls.yaml -X POST https://<span class="nv">$SCONE_CAS_ADDR</span>:8081/session
</pre></div>

<p>Create the manifest and submit it to your Kubernetes cluster:</p>
<div class="highlight"><pre><span></span>cat &gt; attested-app-tls.yaml <span class="s">&lt;&lt; EOF</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: attested-hello-world-tls</span>
<span class="s">spec:</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      run: attested-hello-world-tls</span>
<span class="s">  replicas: 1</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        run: attested-hello-world-tls</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - name: attested-hello-world-tls</span>
<span class="s">        image: $IMAGE3</span>
<span class="s">        imagePullPolicy: Always</span>
<span class="s">        ports:</span>
<span class="s">        - containerPort: 4443</span>
<span class="s">        env:</span>
<span class="s">        - name: SCONE_CAS_ADDR</span>
<span class="s">          value: $SCONE_CAS_ADDR</span>
<span class="s">        - name: SCONE_CONFIG_ID</span>
<span class="s">          value: hello-k8s-scone-tls/application</span>
<span class="s">        - name: SCONE_LAS_ADDR</span>
<span class="s">          value: 172.17.0.1</span>
<span class="s">        volumeMounts:</span>
<span class="s">        - mountPath: /dev/isgx</span>
<span class="s">          name: dev-isgx</span>
<span class="s">        securityContext:</span>
<span class="s">          privileged: true</span>
<span class="s">      volumes:</span>
<span class="s">      - name: dev-isgx</span>
<span class="s">        hostPath:</span>
<span class="s">          path: /dev/isgx</span>
<span class="s">---</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  name: attested-hello-world-tls</span>
<span class="s">  labels:</span>
<span class="s">    run: attested-hello-world-tls</span>
<span class="s">spec:</span>
<span class="s">  ports:</span>
<span class="s">  - port: 4443</span>
<span class="s">    protocol: TCP</span>
<span class="s">  selector:</span>
<span class="s">    run: attested-hello-world-tls</span>
<span class="s">EOF</span>
</pre></div>

<div class="highlight"><pre><span></span>kubectl create -f attested-app-tls.yaml -n hello-scone
</pre></div>

<p>Time to access your app. Forward the traffic to its service:</p>
<div class="highlight"><pre><span></span>kubectl port-forward svc/attested-hello-world-tls <span class="m">8082</span>:4443 -n hello-scone
</pre></div>

<p>And send a request:</p>
<div class="highlight"><pre><span></span>$ curl -k https://localhost:8082
Hello World!
<span class="nv">$GREETING</span> is: hello from SCONE with encrypted <span class="nb">source</span> code and auto-generated certs!!!
</pre></div>

<h3 id="clean-up">Clean up<a class="headerlink" href="#clean-up" title="Permanent link">&para;</a></h3>
<p>To clean up all the resources created in this tutorial, simply delete the namespace:</p>
<div class="highlight"><pre><span></span>kubectl delete namespace hello-scone
</pre></div>

<p>Author: Clenimar</p>
<p>&copy; <a href="http://www.scontain.com">scontain.com</a>, 2020. <a href="mailto:info@scontain.com">Questions or Suggestions?</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../k8s_concepts/" title="Concepts" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Concepts
              </span>
            </div>
          </a>
        
        
          <a href="../scone-use-case-overview/" title="Overview" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Overview
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright Scontain © 2020
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.e72fd936.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../search/main.js"></script>
      
    
    
      
    
  </body>
</html>