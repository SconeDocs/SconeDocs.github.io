
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Scone Documentation - Secure Containers">
      
      
        <meta name="author" content="Christof Fetzer">
      
      
        <link rel="canonical" href="https://sconedocs.github.io/secure_document_management/">
      
      <link rel="icon" href="../img/scone-favicon.png">
      <meta name="generator" content="mkdocs-1.2.1, mkdocs-material-8.2.4">
    
    
      
        <title>Confidential Document Management - Confidential Computing</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"PT Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/custom.css">
    
      <link rel="stylesheet" href="../css/extra.css">
    
      <link rel="stylesheet" href="../css/tooltips.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="purple">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#confidential-document-manager-application" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Confidential Computing" class="md-header__button md-logo" aria-label="Confidential Computing" data-md-component="logo">
      
  <img src="../img/SCONE-logo-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Confidential Computing
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Confidential Document Management
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../news/" class="md-tabs__link">
        News and Overview
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../scone_mesh_tutorial/" class="md-tabs__link">
        Quick Start
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../k8s_concepts/" class="md-tabs__link">
        Kubernetes
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../CASOverview/" class="md-tabs__link">
        Configuration & Attestation
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../helm/" class="md-tabs__link">
        SconeApps
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../operations/" class="md-tabs__link">
        DevOps Workflows
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../aks/" class="md-tabs__link">
        Azure Kubernetes Services
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../usecases/" class="md-tabs__link md-tabs__link--active">
        Use Cases
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../registry/" class="md-tabs__link">
        Sign up
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../iexec_sconify_image/" class="md-tabs__link">
        More
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Confidential Computing" class="md-nav__button md-logo" aria-label="Confidential Computing" data-md-component="logo">
      
  <img src="../img/SCONE-logo-white.png" alt="logo">

    </a>
    Confidential Computing
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          News and Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="News and Overview" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          News and Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../news/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cc-telenovela/" class="md-nav__link">
        CC Soap Opera
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cc-university/" class="md-nav__link">
        CC University
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vm_vs_enclave/" class="md-nav__link">
        Confidential Computing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advantages/" class="md-nav__link">
        Advantages of SCONE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../whyscone/" class="md-nav__link">
        SCONE vs Intel SGX SDK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../technical_summary/" class="md-nav__link">
        Technical summary of SCONE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../buildingApps/" class="md-nav__link">
        (No) Cross-Compilation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../curated_images/" class="md-nav__link">
        Curated Images
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../community_version/" class="md-nav__link">
        Community Version
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Quick Start
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Quick Start" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Quick Start
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          sconectl
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="sconectl" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          sconectl
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scone_mesh_tutorial/" class="md-nav__link">
        Hello World
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconectl/" class="md-nav__link">
        sconectl cli
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install_sconectl/" class="md-nav__link">
        install sconectl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../service.html" class="md-nav__link">
        openAPI description service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mesh.html" class="md-nav__link">
        openAPI description mesh
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Overview" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../workflows/" class="md-nav__link">
        Workflows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconify_hw_k8s/" class="md-nav__link">
        Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lean_deployment/" class="md-nav__link">
        kubectl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconify/" class="md-nav__link">
        Sconify
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconify_filetypes/" class="md-nav__link">
        File Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ee_sconify_image/" class="md-nav__link">
        Sconify Image SE
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../multi-stakeholder-workflow/" class="md-nav__link">
        Multi-Stakeholder Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../example_policy/" class="md-nav__link">
        Policy Update
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../microservices-demo/" class="md-nav__link">
        Boutique Demo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../faq_sconify/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_7" type="checkbox" id="__nav_3_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_7">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hostexample/" class="md-nav__link">
        Host Execution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dockerinstall/" class="md-nav__link">
        Installing docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sgxinstall/" class="md-nav__link">
        Installing Intel SGX driver
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconeinstall/" class="md-nav__link">
        Installing SCONE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../microcode/" class="md-nav__link">
        Updating CPU microcode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../windows10/" class="md-nav__link">
        Windows 10
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_8" type="checkbox" id="__nav_3_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_8">
          Workshop
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Workshop" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_8">
          <span class="md-nav__icon md-icon"></span>
          Workshop
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../workshop/setup/" class="md-nav__link">
        getting access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../workshop/details/" class="md-nav__link">
        background
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../workshop/hands_on_1/" class="md-nav__link">
        hands on 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../workshop/hands_on_2/" class="md-nav__link">
        hands on 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../workshop/next_steps/" class="md-nav__link">
        next steps
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_9" type="checkbox" id="__nav_3_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_9">
          Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorial" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_9">
          <span class="md-nav__icon md-icon"></span>
          Tutorial
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Exercise-Docu/exercises/" class="md-nav__link">
        Assignments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Exercise-Docu/exercise0/" class="md-nav__link">
        Assignment 0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Exercise-Docu/exercise1/" class="md-nav__link">
        Assignment 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Exercise-Docu/exercise2/" class="md-nav__link">
        Assignment 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Exercise-Docu/exercise3/" class="md-nav__link">
        Assignment 3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Exercise-Docu/exercise4/" class="md-nav__link">
        Assignment 4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Exercise-Docu/exercise5/" class="md-nav__link">
        Assignment 5
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Exercise-Docu/section_otp/" class="md-nav__link">
        Section 2 OTP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_10" type="checkbox" id="__nav_3_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_10">
          SCONE Execution Modes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="SCONE Execution Modes" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_10">
          <span class="md-nav__icon md-icon"></span>
          SCONE Execution Modes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../outline/" class="md-nav__link">
        Execution Modes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../firstcontainer/" class="md-nav__link">
        Simulation Mode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hardwaremode/" class="md-nav__link">
        Hardware Mode
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kubernetes" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../k8s_concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          SCONE Operator
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="SCONE Operator" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          SCONE Operator
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1_scone_operator/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2_operator_installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../3_resource_definitions/" class="md-nav__link">
        Custom Resource Definitions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_3">
          Helm Charts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Helm Charts" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Helm Charts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helm_sgxdevplugin/" class="md-nav__link">
        Kubernetes SGX Plugin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helm_cas/" class="md-nav__link">
        CAS Deploy & Attest
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helm_las/" class="md-nav__link">
        LAS Deploy & Platforms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helm_mariadb/" class="md-nav__link">
        MariaDB Deploy & Attest
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helm_teemon/" class="md-nav__link">
        TEEMon Deployment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_4">
          Dashboards
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Dashboards" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Dashboards
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubeapps/" class="md-nav__link">
        Kubeapps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../k8s_dashboard/" class="md-nav__link">
        Kubernetes Dashboard
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" type="checkbox" id="__nav_4_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_5">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hello_world_kubernetes/" class="md-nav__link">
        Hello World Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../azure/scone-pyspark/" class="md-nav__link">
        PySpark on Azure
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Configuration & Attestation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Configuration & Attestation" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Configuration & Attestation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../CASOverview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../CAS_session_lang_0_3/" class="md-nav__link">
        Policy Language 0.3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../CAS_session_lang_0_2/" class="md-nav__link">
        Policy Language 0.2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cas_intro/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../CAS_for_development/" class="md-nav__link">
        Starting CAS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../CAS_config/" class="md-nav__link">
        CAS Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../auditLog/" class="md-nav__link">
        Audit Log
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../public-CAS/" class="md-nav__link">
        Public CAS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../LASIntro/" class="md-nav__link">
        Starting LAS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cas_blender_example/" class="md-nav__link">
        Posting Policies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../CAS_cli-intro/" class="md-nav__link">
        CLI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../envcas/" class="md-nav__link">
        envcas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../print-arg-env/" class="md-nav__link">
        Secure Arguments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../encrypted_vol/" class="md-nav__link">
        Encrypted Volume
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scone-signer-example/" class="md-nav__link">
        Binary Translation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../host_arguments/" class="md-nav__link">
        Host Arguments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../otp_demo/" class="md-nav__link">
        One-time Passwords
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../EncryptedWordCount/" class="md-nav__link">
        Encrypted Code and Input
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../node-example/" class="md-nav__link">
        Node
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../namespace/" class="md-nav__link">
        Namespaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../network_shield/" class="md-nav__link">
        Network Shield
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../CAS_production/" class="md-nav__link">
        CAS production setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cas-backup-controller/" class="md-nav__link">
        CAS Backup Controller for Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cas-backup-controller-quick-start/" class="md-nav__link">
        CAS Backup Controller Quick Start
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          SconeApps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="SconeApps" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          SconeApps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helm/" class="md-nav__link">
        SconeApps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconeapps_database/" class="md-nav__link">
        database
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconeapps_maxscale/" class="md-nav__link">
        maxscale
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconeapps_memcached/" class="md-nav__link">
        memcached
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconeapps_nginx/" class="md-nav__link">
        nginx
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconeapps_openvino/" class="md-nav__link">
        openvino
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconeapps_pytorch/" class="md-nav__link">
        pytorch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconeapps_spark/" class="md-nav__link">
        spark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconeapps_tensorflow/" class="md-nav__link">
        tensorflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconeapps_tensorflowlite/" class="md-nav__link">
        tensorflowlite
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sconeapps_zookeeper/" class="md-nav__link">
        zookeeper
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          DevOps Workflows
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DevOps Workflows" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          DevOps Workflows
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../operations/" class="md-nav__link">
        Workflows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mitigation/" class="md-nav__link">
        Attack mitigation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sadvisories/" class="md-nav__link">
        Security advisories
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../software_updates/" class="md-nav__link">
        Software updates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scone-signer/" class="md-nav__link">
        Signing of enclaves
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../edmm/" class="md-nav__link">
        EDMM support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scone_semantic_versioning/" class="md-nav__link">
        SCONE versioning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../attestation_by_client/" class="md-nav__link">
        Attestation by client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../technotes/" class="md-nav__link">
        Technotes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Azure Kubernetes Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Azure Kubernetes Services" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Azure Kubernetes Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aks/" class="md-nav__link">
        Confidential AKS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../azure/scone-playground/" class="md-nav__link">
        SCONE Playground on Azure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aks/flask_demo/" class="md-nav__link">
        Flask Demo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python_images/" class="md-nav__link">
        Python Images
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aks_integration/" class="md-nav__link">
        AKS Integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../MicrosoftAzureIntegrations/" class="md-nav__link">
        AKS Integration Tutorial
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aks_charts/" class="md-nav__link">
        AKS Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aks_setup/" class="md-nav__link">
        AKS Setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Use Cases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Use Cases" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Use Cases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usecases/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Confidential Document Management
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Confidential Document Management
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#azure-kubernetes-services-aks" class="md-nav__link">
    Azure Kubernetes Services (AKS)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tldr" class="md-nav__link">
    TL;DR
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-fastapi-service" class="md-nav__link">
    Secure FastAPI service
  </a>
  
    <nav class="md-nav" aria-label="Secure FastAPI service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#binary-file-system" class="md-nav__link">
    Binary File system
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-mariadb" class="md-nav__link">
    Secure MariaDB
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-memcached-rate-limiter" class="md-nav__link">
    Secure Memcached Rate Limiter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-nginx-proxy-server" class="md-nav__link">
    Secure NGINX Proxy Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-certificates" class="md-nav__link">
    TLS Certificates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-based-mutual-attestation" class="md-nav__link">
    TLS-Based Mutual Attestation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#binary-fs-for-fastapi" class="md-nav__link">
    Binary FS for FastAPI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-on-a-kubernetes-cluster" class="md-nav__link">
    Execution on a Kubernetes Cluster
  </a>
  
    <nav class="md-nav" aria-label="Execution on a Kubernetes Cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-scone-services" class="md-nav__link">
    Install SCONE Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-application" class="md-nav__link">
    Run the Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-the-application" class="md-nav__link">
    Test the Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-the-application" class="md-nav__link">
    Access the Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean Up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../federated_machine_learning/" class="md-nav__link">
        Federated Machine Learning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../shared_source_code/" class="md-nav__link">
        Confidential Code Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../blender/" class="md-nav__link">
        Blender
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pyspark/" class="md-nav__link">
        PySpark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tensorflow/" class="md-nav__link">
        TensorFlow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tensorflowlite/" class="md-nav__link">
        TensorFlow Lite
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../openvino/" class="md-nav__link">
        OpenVino
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vault/" class="md-nav__link">
        Vault
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scone-use-case-overview/" class="md-nav__link">
        Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../secure_remote_execution/" class="md-nav__link">
        Secure Remote Execution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dockerfileexample/" class="md-nav__link">
        Dockerfile Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../multistagebuild/" class="md-nav__link">
        Multi-stage build
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../groupcacheUseCase/" class="md-nav__link">
        GO example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../memory_dump/" class="md-nav__link">
        Finding Secrets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dapps/" class="md-nav__link">
        Trusted DApps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../flask_demo/" class="md-nav__link">
        Flask Demo
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          Sign up
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Sign up" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Sign up
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../registry/" class="md-nav__link">
        Scontain Registy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11">
          More
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="More" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          More
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11_1" type="checkbox" id="__nav_11_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11_1">
          Client Docu
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Client Docu" data-md-level="2">
        <label class="md-nav__title" for="__nav_11_1">
          <span class="md-nav__icon md-icon"></span>
          Client Docu
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iexec_sconify_image/" class="md-nav__link">
        iExec Sconify Image
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11_2" type="checkbox" id="__nav_11_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11_2">
          Language Support
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Language Support" data-md-level="2">
        <label class="md-nav__title" for="__nav_11_2">
          <span class="md-nav__icon md-icon"></span>
          Language Support
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../C/" class="md-nav__link">
        C
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mono/" class="md-nav__link">
        C#
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../C%2B%2B/" class="md-nav__link">
        C++
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Fortran/" class="md-nav__link">
        Fortran
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../GO/" class="md-nav__link">
        GO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Java/" class="md-nav__link">
        Java
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Running_Java_Applications_in_Scone_with_remote_attestation/" class="md-nav__link">
        Java with remote attestation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Python/" class="md-nav__link">
        Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pypyscone/" class="md-nav__link">
        PyPy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mono/" class="md-nav__link">
        Mono
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Nodejs/" class="md-nav__link">
        Node
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../R/" class="md-nav__link">
        R
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Rust/" class="md-nav__link">
        Rust
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11_3" type="checkbox" id="__nav_11_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11_3">
          IDE Integration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="IDE Integration" data-md-level="2">
        <label class="md-nav__title" for="__nav_11_3">
          <span class="md-nav__icon md-icon"></span>
          IDE Integration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../eclipse/" class="md-nav__link">
        Eclipse
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helm_vscode/" class="md-nav__link">
        Visual Studio Code
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11_4" type="checkbox" id="__nav_11_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11_4">
          Command Line Interface
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Command Line Interface" data-md-level="2">
        <label class="md-nav__title" for="__nav_11_4">
          <span class="md-nav__icon md-icon"></span>
          Command Line Interface
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../CAS_cli/" class="md-nav__link">
        CLI Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../SCONE_Fileshield/" class="md-nav__link">
        scone fspf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../binary_fs/" class="md-nav__link">
        scone binary fs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../SCONE_ENV/" class="md-nav__link">
        environment variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../MrEnclave/" class="md-nav__link">
        MrEnclave
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scone_affinity/" class="md-nav__link">
        affinity
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11_5" type="checkbox" id="__nav_11_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11_5">
          Performance
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Performance" data-md-level="2">
        <label class="md-nav__title" for="__nav_11_5">
          <span class="md-nav__icon md-icon"></span>
          Performance
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../performance/" class="md-nav__link">
        Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../teemon/" class="md-nav__link">
        Monitoring tool
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11_6" type="checkbox" id="__nav_11_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11_6">
          Background
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Background" data-md-level="2">
        <label class="md-nav__title" for="__nav_11_6">
          <span class="md-nav__icon md-icon"></span>
          Background
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../appsecurity/" class="md-nav__link">
        Application-Oriented Security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../background/" class="md-nav__link">
        SCONE Background
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../SCONE_Publications/" class="md-nav__link">
        Publications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aboutScone/" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11_10" type="checkbox" id="__nav_11_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11_10">
          Releases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Releases" data-md-level="2">
        <label class="md-nav__title" for="__nav_11_10">
          <span class="md-nav__icon md-icon"></span>
          Releases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release5.7/" class="md-nav__link">
        SCONE 5.7.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release5.6/" class="md-nav__link">
        SCONE 5.6.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release5.5/" class="md-nav__link">
        SCONE 5.5.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release5.4/" class="md-nav__link">
        SCONE 5.4.0
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#azure-kubernetes-services-aks" class="md-nav__link">
    Azure Kubernetes Services (AKS)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tldr" class="md-nav__link">
    TL;DR
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-fastapi-service" class="md-nav__link">
    Secure FastAPI service
  </a>
  
    <nav class="md-nav" aria-label="Secure FastAPI service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#binary-file-system" class="md-nav__link">
    Binary File system
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-mariadb" class="md-nav__link">
    Secure MariaDB
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-memcached-rate-limiter" class="md-nav__link">
    Secure Memcached Rate Limiter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-nginx-proxy-server" class="md-nav__link">
    Secure NGINX Proxy Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-certificates" class="md-nav__link">
    TLS Certificates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-based-mutual-attestation" class="md-nav__link">
    TLS-Based Mutual Attestation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#binary-fs-for-fastapi" class="md-nav__link">
    Binary FS for FastAPI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-on-a-kubernetes-cluster" class="md-nav__link">
    Execution on a Kubernetes Cluster
  </a>
  
    <nav class="md-nav" aria-label="Execution on a Kubernetes Cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-scone-services" class="md-nav__link">
    Install SCONE Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-application" class="md-nav__link">
    Run the Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-the-application" class="md-nav__link">
    Test the Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-the-application" class="md-nav__link">
    Access the Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean Up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="confidential-document-manager-application">Confidential Document Manager Application</h1>
<video style="width:100%" controls poster="../img/demo-sec-doc-mngmt-v1.7.png">
  <source src="https://se.inf.tu-dresden.de/lectures/CC-Exercises/demo-sec-doc-mngmt-v1.7.mp4" type='video/mp4'>
  A short introduction to confidential computing and SCONE.
</video>

<p>This application demo is a confidential document web application. This service enables users to upload and download documents and ensures that the documents are always encrypted. Users can create accounts. We use a simple password-based authentication. For production, one should add a two-factor authentication. The application  consists of the following components:</p>
<ul>
<li>a <strong>Python FastAPI</strong> service serving as the application's REST API,</li>
<li>a <strong>MariaDB</strong> service stores the documents and user authentication data,</li>
<li>a <strong>memcached</strong> service, serving as a rate limiter for the application, and</li>
<li>an <strong>nginx</strong> instance serves as a proxy server for the application, ensuring termination and forwarding with TLS.</li>
</ul>
<p>All of these components run securely inside of enclaves using the SCONE framework. These services are also integrity protected, and attest each other transparently using TLS in conjunction with a SCONE Configuration and Attestation Service (CAS). Furthermore, the application protects the confidentiality and integrity of all data it receives. We deploy this application using <span data-tooltip="Is a very popular package manager for Kubernetes.">helm</span>.</p>
<p>An overview of how these different components interact with one another is as follows:</p>
<p><center>
<img alt="Overview" src="../img/secure-doc-manager-overview.svg#fullwidth" />
</center></p>
<div class="admonition info">
<p class="admonition-title">Prerequisites</p>
<ul>
<li>A <span data-tooltip="An open source container orchestration platform. More information at
https://kubernetes.io/">Kubernetes</span> cluster</li>
<li><a href="https://sconedocs.github.io/helm/">Helm setup</a> was performed</li>
<li>Either the <a href="https://sconedocs.github.io/sgxinstall/">SCONE SGX Plugin</a> or the Azure SGX Plugin is installed.</li>
</ul>
</div>
<h2 id="azure-kubernetes-services-aks">Azure Kubernetes Services (AKS)</h2>
<p>You can run this demo on AKS. To set up the necessary infrastructure on AKS, you need to start a local attestations service:
(you may have to change the tags according to your AKS Nodes)</p>
<div class="highlight"><pre><span></span><code>helm install las sconeapps/las <span class="se">\</span>
        --set <span class="nv">useSGXDevPlugin</span><span class="o">=</span>azure <span class="se">\</span>
        --set <span class="nv">sgxEpcMem</span><span class="o">=</span><span class="m">8</span> <span class="se">\</span>
        --set <span class="nv">image</span><span class="o">=</span>registry.scontain.com:5050/sconecuratedimages/kubernetes:las <span class="se">\</span>
        --set nodeSelector.agentpool<span class="o">=</span><span class="s2">&quot;confcompool1&quot;</span>
</code></pre></div>
<h2 id="tldr">TL;DR</h2>
<ul>
<li>please, register an account with the <a href="https://gitlab.scontain.com/">SCONE registry</a></li>
<li>ask us for access to SconeApps via email</li>
<li>pull this <a href="https://gitlab.scontain.com/community/secure-doc-management">repository</a></li>
<li>create the corresponding Kubernetes secret for the registry and then <code>$ export IMAGE_PULL_SECRET=&lt;your_secret&gt;</code></li>
<li>set target images that you can push to for <code>MEMCACHED_TARGET_IMAGE</code>, <code>NGINX_TARGET_IMAGE</code> and <code>MARIADB_TARGET_IMAGE</code> (again with <code>$ export ...</code>)</li>
<li>execute <code>$ ./setup-secure-doc-management.sh</code> to upload the policies to SCONE CAS and </li>
<li>issue client requests: <code>kubectl exec --stdin --tty $(kubectl get pods --selector=app.kubernetes.io/name=client-scone -o jsonpath='{.items[*].metadata.name}') -- /bin/bash</code></li>
<li>available commands for the REST API are documented in <code>./secure-doc-management/templates/NOTES.txt</code> (displayed after script has terminated)</li>
</ul>
<h2 id="secure-fastapi-service">Secure FastAPI service</h2>
<p>We implement a simple FastAPI-based service. The Python <a href="https://gitlab.scontain.com/community/secure-doc-management/-/blob/master/fastapi-setup/rest_api.py">code</a> implements a REST API:</p>
<ul>
<li>we create a new account by sending a request to <code>/users/create_account</code> with the flag <code>-u&lt;username&gt;:&lt;password&gt;</code></li>
<li>all subsequent requests containing the <code>-u&lt;username&gt;:&lt;password&gt;</code> flag authenticate this user</li>
<li>we upload documents by sending a <code>POST</code> to <code>/documents/create_document</code> with a <code>json</code> containing the names <code>record_id</code> with the value of the ID of the record, and <code>content</code>, with the value of the documents contents.</li>
<li>we get a document by sending a <code>GET</code> request to <code>/documents/&lt;record_id&gt;</code>, retrieving the document with the corresponding record ID</li>
</ul>
<p>We execute the Python service within an enclave, thus ensuring that even privileged adversaries with root access cannot read the contents of the documents from the Python process.</p>
<h4 id="binary-file-system">Binary File system</h4>
<p>This FastAPI service employs the new SCONE features <code>binary-fs</code>. We thereby bind the file system of the service to the binary. Among other security advantages, the MRENCLAVE of the service reflects this inclusion of the file system. Thus, we can verify that the Python service is indeed running the code we expect it to run. For more information, please refer to <a href="https://sconedocs.github.io/binary_fs/">https://sconedocs.github.io/binary_fs/</a>.</p>
<h2 id="secure-mariadb">Secure MariaDB</h2>
<p>We store the documents and user authentication information in a secure MariaDB, which we also run inside of an enclave. Further, we ensure its memory remains encrypted. As such, the documents and login data users store inside the database remain secure. We further elaborate on the database in <a href="https://sconedocs.github.io/helm/">this section</a>.</p>
<h2 id="secure-memcached-rate-limiter">Secure Memcached Rate Limiter</h2>
<p>To ensure that our MariaDB is not overloaded by excess requests, we limit requests per user using a Memcached service. We thereby ensure that a user can make at most 10 requests per minute. If the user's requests exceed that limit, we do not serve requests to their corresponding IP address for the remainder of the minute. We implement this limiter by storing the user's IP and their number of requests in a key/value pair in the Memcached service in our <a href="https://gitlab.scontain.com/community/secure-doc-management/-/blob/master/fastapi-setup/rest_api.py">Python program</a>: <code>mc_client.set(key=client_ip, value=1, expire=60)</code>. Upon a request, we increment the key/value pair using Memcached's <code>incr</code> command: <code>mc_client.incr(key=client_ip, value=1)</code>. If this value exceeds 10, we do not serve the requests. The key value pair expires after 60 seconds.</p>
<p>As we attribute the IP of a user to Personally Identifiable Information (PII), we have to protect this data. We ensure this protection by running the Memcached inside of an enclave.</p>
<h2 id="secure-nginx-proxy-server">Secure NGINX Proxy Server</h2>
<p>We employ an NGINX to be the main API of the service, and to ensure secure communication over the wire with TLS. The NGINX requires users to send their requests over TLS, as we specify in its <a href="https://gitlab.scontain.com/community/secure-doc-management/-/blob/master/nginx-setup/nginx.conf">configuration</a>. The NGINX then forwards such requests to the FastAPI service, also using TLS. It thereby specifies the correct FastAPI port, thus enabling the user to send the service requests without having to specify the port themselves.</p>
<p>As the NGINX thereby receives the sensitive information of the documents, we run the NGINX proxy server in an enclave as well.</p>
<h2 id="tls-certificates">TLS Certificates</h2>
<p>We must secure the communication between 1) the application's services and between 2) the user and the application. Therefore, we need to issue and provision multiple certificates:</p>
<ul>
<li><strong>MariaDB</strong>: requires server certificates</li>
<li><strong>memcached</strong>: requires server certificates</li>
<li><strong>FastAPI</strong>: requires server certificates and client certificates for the Memcached and MariaDB for client verification</li>
<li><strong>nginx</strong>: requires server certificates, whereby the certification authority (CA) certificate must be accessible to users, and client certificates for the FastAPI for client verification.</li>
</ul>
<p>An overview of how these certificates secure the communication is as follows:</p>
<p><center>
<img alt="Certificates" src="../img/secure-doc-manager-key-distribution.svg#fullwidth" />
</center></p>
<p>We provision these certificates using <a href="https://sconedocs.github.io/CAS_session_lang_0_3/">SCONE policies</a>. We now illustrate the use of the policies for certificate provisioning by inspecting the <a href="https://gitlab.scontain.com/community/secure-doc-management/-/blob/master/policy-setup/nginx_session.yml">NGINX policy</a>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">secrets</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># nginx - fastapi tls</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CLIENT_CERT</span><span class="w"></span>
<span class="w">    </span><span class="nt">import</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">session</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$FASTAPI_SESSION</span><span class="w"></span>
<span class="w">      </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CLIENT_CERT</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CA_CERT</span><span class="w"></span>
<span class="w">    </span><span class="nt">import</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">session</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$FASTAPI_SESSION</span><span class="w"></span>
<span class="w">      </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CA_CERT</span><span class="w"></span>
<span class="w">  </span><span class="c1"># specific for nginx - client tls</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server-key</span><span class="w"> </span><span class="c1"># automatically generate SERVER server certificate</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">private-key</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server</span><span class="w"> </span><span class="c1"># automatically generate SERVER server certificate</span><span class="w"></span>
<span class="w">    </span><span class="nt">private_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server-key</span><span class="w"></span>
<span class="w">    </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_CA_CERT</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x509</span><span class="w"></span>
<span class="w">    </span><span class="nt">dns</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$NGINX_HOST</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secure-doc-management</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_CA_KEY</span><span class="w"> </span><span class="c1"># export session CA certificate as SERVER CA certificate</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">private-key</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_CA_CERT</span><span class="w"> </span><span class="c1"># export session CA certificate as SERVER CA certificate</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x509-ca</span><span class="w"></span>
<span class="w">    </span><span class="nt">common_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_CA</span><span class="w"></span>
<span class="w">    </span><span class="nt">private_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_CA_KEY</span><span class="w"></span>
<span class="w">    </span><span class="nt">export_public</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</code></pre></div>
<p>In the first section, <code># nginx - fastapi tls</code>, the NGINX session imports the client and the server CA certificates from the FastAPI session. It thereby uses the CA certificate to identify the FastAPI service, and identifies itself to the service using the client certificates.</p>
<p>In the second section, <code># (...) nginx - client tls</code>, we issue server certificates for the NGINX. For the NGINX Server CA certificate, we set <code>export_public: true</code>. This settings allows users to extract the CA certificate corresponding to this policy, thus enabling them to verify the NGINX server.</p>
<p>To make the certificates available to the NGINX service, we inject the certificates into the NGINX file system. We specify this injection in the <a href="https://gitlab.scontain.com/community/secure-doc-management/-/blob/master/policy-setup/nginx_session.yml">NGINX policy</a> using the previous SCONE policy secrets as follows:</p>
<div class="highlight"><pre><span></span><code><span class="nt">images</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_image</span><span class="w"></span>
<span class="w">    </span><span class="nt">injection_files</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="c1"># nginx - fastapi tls</span><span class="w"></span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/fastapi-ca.crt</span><span class="w"></span>
<span class="w">         </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$$SCONE::FASTAPI_CA_CERT.chain$$</span><span class="w"></span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/fastapi-client.crt</span><span class="w"></span>
<span class="w">         </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$$SCONE::FASTAPI_CLIENT_CERT.crt$$</span><span class="w"></span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/fastapi-client.key</span><span class="w"></span>
<span class="w">         </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$$SCONE::FASTAPI_CLIENT_CERT.key$$</span><span class="w"></span>
<span class="w">       </span><span class="c1"># specific for nginx - client tls</span><span class="w"></span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/server.crt</span><span class="w"></span>
<span class="w">         </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$$SCONE::server.crt$$</span><span class="w"></span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/server.key</span><span class="w"></span>
<span class="w">         </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$$SCONE::server.key$$</span><span class="w"></span>
</code></pre></div>
<p>The NGINX can then access these injected files as normal files, e.g., in its configuration:
<div class="highlight"><pre><span></span><code>events {}
http {
    server {
        listen 443 ssl;
        server_name             secure-doc-management-nginx-scone;
        ssl_certificate         /etc/nginx/server.crt;
        ssl_certificate_key     /etc/nginx/server.key;

        location / {
            proxy_pass                      https://secure-doc-management-fastapi-scone:8000;
            proxy_ssl_certificate           /etc/nginx/fastapi-client.crt;
            proxy_ssl_certificate_key       /etc/nginx/fastapi-client.key;
            proxy_ssl_trusted_certificate   /etc/nginx/fastapi-ca.crt;
            proxy_ssl_verify                on;
            proxy_ssl_session_reuse         on;
        }
    }
}
</code></pre></div></p>
<h2 id="tls-based-mutual-attestation">TLS-Based Mutual Attestation</h2>
<p>As we observed in the previous section, we encrypt the communication between the NGINX and the FastAPI using TLS, enabled by SCONE policies. The NGINX and FastAPI policies thereby export the necessary certificates to each other by referencing each other in their policies. They thereby <em>attest</em> each other. They achieve this attestation by verifying the policies that they reference in their own policy. Furthermore, they check that the corresponding service satisfies all requirements specified in the service's policy.</p>
<p>We can easily enforce mutual attestation using TLS client authentication. We illustrate this attestation with the <a href="https://gitlab.scontain.com/community/secure-doc-management/-/blob/master/policy-setup/fastapi_session.yml">FastAPI's policy</a>, which ensures TLS-based attestation between itself and the NGINX service. This FastAPI policy generates a FastAPI CA certificate (<code>FASTAPI_CA_CERT</code>) and a FastAPI server certificate (<code>fastapi</code>) as well as a corresponding FastAPI client certificate (<code>FASTAPI_CLIENT_CERT</code>) and client key (<code>FASTAPI_CLIENT_KEY</code>). The policy exports this certificate and private key to the NGINX policy.</p>
<div class="highlight"><pre><span></span><code><span class="nt">secrets</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain"># specific for fastapi - nginx tls</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- name</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fastapi-key</span><span class="w"> </span><span class="c1"># automatically generate FASTAPI server certificate</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">private-key</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fastapi</span><span class="w"> </span><span class="c1"># automatically generate FASTAPI server certificate</span><span class="w"></span>
<span class="w">    </span><span class="nt">private_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fastapi-key</span><span class="w"></span>
<span class="w">    </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CA_CERT</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x509</span><span class="w"></span>
<span class="w">    </span><span class="nt">dns</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$FASTAPI_HOST</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CLIENT_KEY</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">private-key</span><span class="w"></span>
<span class="w">    </span><span class="nt">export</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">session</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$NGINX_SESSION</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CLIENT_CERT</span><span class="w"> </span><span class="c1"># automatically generate client certificate</span><span class="w"></span>
<span class="w">    </span><span class="nt">private_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CLIENT_KEY</span><span class="w"></span>
<span class="w">    </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CA_CERT</span><span class="w"></span>
<span class="w">    </span><span class="nt">common_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CLIENT_CERT</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x509</span><span class="w"></span>
<span class="w">    </span><span class="nt">export</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">session</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$NGINX_SESSION</span><span class="w"> </span><span class="c1"># export client cert/key to upload session</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CA_KEY</span><span class="w"> </span><span class="c1"># export session CA certificate as FASTAPI CA certificate</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">private-key</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CA_CERT</span><span class="w"> </span><span class="c1"># export session CA certificate as FASTAPI CA certificate</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x509-ca</span><span class="w"></span>
<span class="w">    </span><span class="nt">common_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CA</span><span class="w"></span>
<span class="w">    </span><span class="nt">private_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CA_KEY</span><span class="w"></span>
<span class="w">    </span><span class="nt">export</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">session</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$NGINX_SESSION</span><span class="w"> </span><span class="c1"># export the session CA certificate to upload session</span><span class="w"></span>
</code></pre></div>
<p>We thereby replace <code>$NGINX_SESSION</code> with the policy name of the NGINX. For increased security, we can also specify the corresponding <a href="https://sconedocs.github.io/CAS_session_lang_0_3/#session-description-hash">session hash</a>. In this scenario, the policies are on the same <a href="https://sconedocs.github.io/helm_cas/">SCONE CAS</a>. In more complex cases, the policies can be stored on different <a href="https://sconedocs.github.io/helm_cas/">SCONE CAS</a>.</p>
<p>The NGINX can then import the FastAPI CA certificate, client certificate and private key, as we saw before:</p>
<div class="highlight"><pre><span></span><code><span class="nt">secrets</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># nginx - fastapi tls</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CLIENT_CERT</span><span class="w"></span>
<span class="w">    </span><span class="nt">import</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">session</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$FASTAPI_SESSION</span><span class="w"></span>
<span class="w">      </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CLIENT_CERT</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CA_CERT</span><span class="w"></span>
<span class="w">    </span><span class="nt">import</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">session</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$FASTAPI_SESSION</span><span class="w"></span>
<span class="w">      </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FASTAPI_CA_CERT</span><span class="w"></span>
<span class="w">  </span><span class="c1"># specific for nginx - client tls</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server-key</span><span class="w"> </span><span class="c1"># automatically generate SERVER server certificate</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">private-key</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server</span><span class="w"> </span><span class="c1"># automatically generate SERVER server certificate</span><span class="w"></span>
<span class="w">    </span><span class="nt">private_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server-key</span><span class="w"></span>
<span class="w">    </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_CA_CERT</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x509</span><span class="w"></span>
<span class="w">    </span><span class="nt">dns</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$NGINX_HOST</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secure-doc-management</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_CA_KEY</span><span class="w"> </span><span class="c1"># export session CA certificate as SERVER CA certificate</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">private-key</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_CA_CERT</span><span class="w"> </span><span class="c1"># export session CA certificate as SERVER CA certificate</span><span class="w"></span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x509-ca</span><span class="w"></span>
<span class="w">    </span><span class="nt">common_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_CA</span><span class="w"></span>
<span class="w">    </span><span class="nt">private_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_CA_KEY</span><span class="w"></span>
<span class="w">    </span><span class="nt">export_public</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</code></pre></div>
<p><code>$FASTAPI_SESSION</code> is the exporting policy of the FastAPI. The NGINX can then use these exported secrets, as we also saw before:</p>
<div class="highlight"><pre><span></span><code><span class="nt">images</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_image</span><span class="w"></span>
<span class="w">    </span><span class="nt">injection_files</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="c1"># nginx - fastapi tls</span><span class="w"></span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/fastapi-ca.crt</span><span class="w"></span>
<span class="w">         </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$$SCONE::FASTAPI_CA_CERT.chain$$</span><span class="w"></span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/fastapi-client.crt</span><span class="w"></span>
<span class="w">         </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$$SCONE::FASTAPI_CLIENT_CERT.crt$$</span><span class="w"></span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/fastapi-client.key</span><span class="w"></span>
<span class="w">         </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$$SCONE::FASTAPI_CLIENT_CERT.key$$</span><span class="w"></span>
</code></pre></div>
<p>To ensure that the SCONE CAS supplying these policies is authentic, we typically attest the SCONE CAS before uploading any policies using the <a href="https://sconedocs.github.io/aks/flask_demo/helm_cas/#attesting-scone-cas">SCONE CAS CLI</a>.</p>
<h2 id="binary-fs-for-fastapi">Binary FS for FastAPI</h2>
<p>As we mentioned before, we secure our FastAPI server using the <code>binary-fs</code>. We use the tool while building the initial Docker image. We seperate this process in three stages. In the first stage, we apply the <code>binaryfs</code> command to create a file system <code>.c</code> file. In the second stage, we compile the <code>.c</code> file into an <code>.so</code> file using the <code>scone gcc</code>. In the third stage, we link the generated <code>.so</code> file into the binary using <code>patchelf</code>. We apply these stages in the Dockerfile as follows:</p>
<div class="highlight"><pre><span></span><code><span class="c"># First stage: apply the binary-fs</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">sconecuratedimages/apps:python-3.7.3-alpine3.10</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">binary-fs</span>

<span class="k">COPY</span><span class="w"> </span>rest_api.py /.
<span class="k">COPY</span><span class="w"> </span>requirements.txt requirements.txt
<span class="k">RUN</span><span class="w"> </span>pip3 install -r requirements.txt


<span class="c"># here we apply the binary-fs command to create the file system .c file</span>
<span class="k">RUN</span><span class="w"> </span>rm /usr/lib/python3.7/config-3.7m-x86_64-linux-gnu/libpython3.7m.a <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nv">SCONE_MODE</span><span class="o">=</span>auto scone binaryfs / /binary-fs.c -v <span class="se">\</span>
        --include <span class="s1">&#39;/usr/lib/python3.7/*&#39;</span> <span class="se">\</span>
        --include /lib/libssl.so.1.1 <span class="se">\</span>
        --include /lib/libcrypto.so.1.1 <span class="se">\</span>
        --include <span class="s1">&#39;/lib/libz.so.1*&#39;</span> <span class="se">\</span>
        --include <span class="s1">&#39;/usr/lib/libbz2.so.1*&#39;</span> <span class="se">\</span>
        --include <span class="s1">&#39;/usr/lib/libsqlite3.so.0*&#39;</span> <span class="se">\</span>
        --include <span class="s1">&#39;/usr/lib/libev.so.4*&#39;</span> <span class="se">\</span>
        --include <span class="s1">&#39;/usr/lib/libffi.so.6*&#39;</span> <span class="se">\</span>
        --include <span class="s1">&#39;/usr/lib/libexpat.so.1*&#39;</span> <span class="se">\</span>
        --include /rest_api.py


<span class="c"># Second stage: compile the binary fs</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">registry.scontain.com:5050/sconecuratedimages/crosscompilers:alpine-scone5</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s">crosscompiler</span>

<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>binary-fs /binary-fs.c /.

<span class="k">RUN</span><span class="w"> </span>scone gcc /binary-fs.c -O0 -shared -o /libbinary-fs.so


<span class="c"># Third stage: patch the binary-fs into the enclave executable</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">registry.scontain.com:5050/sconecuratedimages/apps:python-3.7.3-alpine3.10</span>

<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>crosscompiler /libbinary-fs.so /.

<span class="k">RUN</span><span class="w"> </span>apk add --no-cache patchelf <span class="o">&amp;&amp;</span> <span class="se">\</span>
    patchelf --add-needed libbinary-fs.so <span class="sb">`</span>which python3<span class="sb">`</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    apk del patchelf


<span class="k">ENV</span><span class="w"> </span><span class="nv">SCONE_HEAP</span><span class="o">=</span>512M
<span class="k">ENV</span><span class="w"> </span><span class="nv">SCONE_LOG</span><span class="o">=</span>debug
<span class="k">ENV</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;/&quot;</span>


<span class="k">CMD</span><span class="w"> </span>sh -c <span class="s2">&quot;python3 /rest_api.py&quot;</span>
</code></pre></div>
<p>The binary also requires certain <code>/etc/</code> files for networking within the cluster, e.g., <code>/etc/resolv.conf</code>. Currently, we simply inject these files into the confidential service using the FastAPI's <a href="https://gitlab.scontain.com/community/secure-doc-management/-/blob/master/policy-setup/fastapi_session.yml">policy</a>.</p>
<p>The source code of this example is available on our repository- ask us for permission, and then continue with the following commands:</p>
<div class="highlight"><pre><span></span><code>git clone https://gitlab.scontain.com/community/secure-doc-management.git
<span class="nb">cd</span> secure-doc-management
</code></pre></div>
<h2 id="execution-on-a-kubernetes-cluster">Execution on a Kubernetes Cluster</h2>
<p>We intend this example to be run on a Kubernetes cluster.</p>
<h3 id="install-scone-services">Install SCONE Services</h3>
<p>Get access to <code>SconeApps</code> (see <a href="https://sconedocs.github.io/helm/">https://sconedocs.github.io/helm/</a>):</p>
<div class="highlight"><pre><span></span><code>helm repo add sconeapps https://<span class="si">${</span><span class="nv">GH_TOKEN</span><span class="si">}</span>@raw.githubusercontent.com/scontain/SconeApps/master/
helm repo update
</code></pre></div>
<p>Give SconeApps access to the private docker images (see <a href="../helm/">SconeApps</a>):</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">SCONE_HUB_USERNAME</span><span class="o">=</span>...
<span class="nb">export</span> <span class="nv">SCONE_HUB_ACCESS_TOKEN</span><span class="o">=</span>...
<span class="nb">export</span> <span class="nv">SCONE_HUB_EMAIL</span><span class="o">=</span>...

kubectl create secret docker-registry sconeapps --docker-server<span class="o">=</span>registry.scontain.com:5050 --docker-username<span class="o">=</span><span class="nv">$SCONE_HUB_USERNAME</span> --docker-password<span class="o">=</span><span class="nv">$SCONE_HUB_ACCESS_TOKEN</span> --docker-email<span class="o">=</span><span class="nv">$SCONE_HUB_EMAIL</span>
</code></pre></div>
<p>Start Local Attestation Service (LAS) on Azure (we use a remote CAS in this case):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># nodeSelector may have to be adjusted according to your nodes</span>
helm install las sconeapps/las <span class="se">\</span>
        --set <span class="nv">useSGXDevPlugin</span><span class="o">=</span>azure <span class="se">\</span>
        --set <span class="nv">sgxEpcMem</span><span class="o">=</span><span class="m">8</span> <span class="se">\</span>
        --set <span class="nv">image</span><span class="o">=</span>registry.scontain.com:5050/sconecuratedimages/kubernetes:las-scone5 <span class="se">\</span>
        --set nodeSelector.agentpool<span class="o">=</span><span class="s2">&quot;confcompool1&quot;</span>
</code></pre></div>
<p>To setup on a vanilla Kubernetes cluster:</p>
<div class="highlight"><pre><span></span><code>helm install las sconeapps/las --set service.hostPort<span class="o">=</span><span class="nb">true</span>
helm install sgxdevplugin sconeapps/sgxdevplugin
</code></pre></div>
<h3 id="run-the-application">Run the Application</h3>
<p>Start by by specifying Docker image repositories to which you may push:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">MARIADB_TARGET_IMAGE</span><span class="o">=</span>your/repo:mariadb-protected
<span class="nb">export</span> <span class="nv">MEMCACHED_TARGET_IMAGE</span><span class="o">=</span>your/repo:memcached-tls-protected
<span class="nb">export</span> <span class="nv">NGINX_TARGET_IMAGE</span><span class="o">=</span>your/repo:nginx-proxy-server-protected
</code></pre></div>
<p>Then use the Helm chart in <code>./secure-doc-management</code> to deploy the application to a Kubernetes cluster. We strongly recommend using the script:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">NAMESPACE</span><span class="o">=</span>&lt;your_kubernetes_namespace&gt; <span class="c1"># e.g. default</span>
./setup-secure-doc-management.sh

<span class="c1"># without Azure:</span>
<span class="c1"># export USE_AZURE=false; ./setup-secure-doc-management.sh</span>
</code></pre></div>
<!-- *NOTE:* Setting `service.type=LoadBalancer` will allow the application to get traffic from the internet (through a managed LoadBalancer). -->

<!-- TODO setup load balancer -->

<h3 id="test-the-application">Test the Application</h3>
<p>After all resources are <code>Running</code>, you can test the API via Helm:</p>
<div class="highlight"><pre><span></span><code>helm <span class="nb">test</span> secure-doc-management
</code></pre></div>
<p>Helm will run a pod with a couple of pre-set queries to check if the API is working properly.</p>
<h3 id="access-the-application">Access the Application</h3>
<p>For ease of use, we access the application within the cluster through a client pod, which the helm charts also deploys.</p>
<div class="highlight"><pre><span></span><code>kubectl <span class="nb">exec</span> --stdin --tty <span class="k">$(</span>kubectl get pods --selector<span class="o">=</span>app.kubernetes.io/name<span class="o">=</span>client-scone -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[*].metadata.name}&#39;</span><span class="k">)</span> -- /bin/bash
</code></pre></div>
<p>The IP of the host is stored under <code>$NGINX_HOST</code> in the pod. The pod has also retrieved the certificate of the application beforehand, in <code>/tmp/nginx-ca.crt</code>. The exact commands to establish the secure communication with the application are:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span> <span class="s2">&quot;Attest SCONE CAS&quot;</span>
scone cas attest --accept-configuration-needed --accept-group-out-of-date --only_for_testing-debug --only_for_testing-ignore-signer <span class="nv">$SCONE_CAS_ADDR</span> <span class="nv">$CAS_MRENCLAVE</span>

<span class="nb">echo</span> <span class="s2">&quot;Get SCONE CAS CACERT&quot;</span>
scone cas show-certificate <span class="nv">$SCONE_CAS_ADDR</span> &gt; /tmp/scone-ca.crt

<span class="nb">echo</span> <span class="s2">&quot;Get nginx public CACERT from CAS REST API&quot;</span>
<span class="nb">echo</span> -e <span class="k">$(</span>curl --cacert /tmp/scone-ca.crt https://<span class="nv">$SCONE_CAS_ADDR</span>:8081/v1/values/session<span class="o">=</span><span class="nv">$NGINX_CONFIG_ID</span>,secret<span class="o">=</span>SERVER_CA_CERT <span class="p">|</span> jq <span class="s1">&#39;.value&#39;</span><span class="k">)</span> <span class="p">|</span> head -c -2 <span class="p">|</span> tail -c +2 &gt; /tmp/nginx-ca.crt
</code></pre></div>
<p>Now, from within the pod, you can perform queries such as:</p>
<div class="highlight"><pre><span></span><code>curl --cacert /tmp/nginx-ca.crt -ubobross:password123 -X GET https://<span class="nv">$NGINX_HOST</span>/users/create_account
curl --cacert /tmp/nginx-ca.crt -ubobross:password123 -X POST -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;record_id&quot;:&quot;31&quot;,&quot;content&quot;:&quot;Ever make mistakes in life? Lets make them birds. Yeah, theyre birds now.&quot;}&#39;</span> https://<span class="nv">$NGINX_HOST</span>/documents/create_document
curl --cacert /tmp/nginx-ca.crt -ubobross:password123 -X GET https://secure-doc-management-nginx-scone/documents/31
</code></pre></div>
<h3 id="clean-up">Clean Up</h3>
<p>To uninstall the charts we installed during this demo, execute:</p>
<div class="highlight"><pre><span></span><code>helm uninstall las
helm uninstall secure-doc-management
<span class="c1"># if you are not using Azure:</span>
<span class="c1"># helm uninstall sgxdevplugin</span>
</code></pre></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../usecases/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Introduction" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Introduction
            </div>
          </div>
        </a>
      
      
        
        <a href="../federated_machine_learning/" class="md-footer__link md-footer__link--next" aria-label="Next: Federated Machine Learning" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Federated Machine Learning
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright Scontain &copy; 2018-2022
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.5413a266.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js"></script>
      
        <script src="../css/extra.js"></script>
      
        <script src="../search/main.js"></script>
      
    
  </body>
</html>