



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Scone Documentation - Secure Containers">
      
      
        <link rel="canonical" href="https://sconedocs.github.io/SCONE_EE2EE/">
      
      
        <meta name="author" content="Christof Fetzer">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching pages">
      
        <meta name="lang:search.result.one" content="1 matching page">
      
        <meta name="lang:search.result.other" content="# matching page">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/scone-favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.3">
    
    
      
        <title>Example: End-to-End Encryption - SCONE</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:300,400,400i,700|">
        <style>body,input{font-family:"PT Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="purple">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#example-end-to-end-encryption" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://sconedocs.github.io" title="SCONE" class="md-header-nav__button md-logo">
          
            <img src="../img/logo-yellow-square.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                SCONE
              </span>
              <span class="md-header-nav__topic">
                Example: End-to-End Encryption
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search this site" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching this site
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://sconedocs.github.io" title="SCONE" class="md-nav__button md-logo">
      
        <img src="../img/logo-yellow-square.png" width="48" height="48">
      
    </a>
    SCONE
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href=".." title="Executive summary" class="md-nav__link">
      Executive summary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advantages/" title="Advantages of SCONE" class="md-nav__link">
      Advantages of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../technical_summary/" title="Technical summary of SCONE" class="md-nav__link">
      Technical summary of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../buildingApps/" title="(No) Cross-Compilation" class="md-nav__link">
      (No) Cross-Compilation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../curated_images/" title="Curated Images" class="md-nav__link">
      Curated Images
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../scone-use-case-overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secure_remote_execution/" title="Secure Remote Execution" class="md-nav__link">
      Secure Remote Execution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerfileexample/" title="Dockerfile Example" class="md-nav__link">
      Dockerfile Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multistagebuild/" title="Multi-stage build" class="md-nav__link">
      Multi-stage build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../groupcacheUseCase/" title="GO example" class="md-nav__link">
      GO example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../memory_dump/" title="Finding Secrets" class="md-nav__link">
      Finding Secrets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dapps/" title="Trusted DApps" class="md-nav__link">
      Trusted DApps
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Configuration & Attestation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Configuration & Attestation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CASOverview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_intro/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CASIntro/" title="Starting CAS" class="md-nav__link">
      Starting CAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../LASIntro/" title="Starting LAS" class="md-nav__link">
      Starting LAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_blender_example/" title="Posting Sessions" class="md-nav__link">
      Posting Sessions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../print-arg-env/" title="Secure Arguments" class="md-nav__link">
      Secure Arguments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EncryptedWordCount/" title="Encrypted Code and Input" class="md-nav__link">
      Encrypted Code and Input
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Use Cases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Use Cases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../usecases/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../blender/" title="Blender" class="md-nav__link">
      Blender
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pyspark/" title="PySpark" class="md-nav__link">
      PySpark
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflow/" title="TensorFlow" class="md-nav__link">
      TensorFlow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflowlite/" title="TensorFlow Lite" class="md-nav__link">
      TensorFlow Lite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vault/" title="Vault" class="md-nav__link">
      Vault
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Execution Modes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Execution Modes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../outline/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../firstcontainer/" title="Simulation Mode" class="md-nav__link">
      Simulation Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hardwaremode/" title="Hardware Mode" class="md-nav__link">
      Hardware Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hostexample/" title="Host Execution" class="md-nav__link">
      Host Execution
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" title="Installation overview" class="md-nav__link">
      Installation overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerinstall/" title="Installing docker" class="md-nav__link">
      Installing docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sgxinstall/" title="Installing Intel SGX driver" class="md-nav__link">
      Installing Intel SGX driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeinstall/" title="Installing SCONE" class="md-nav__link">
      Installing SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../microcode/" title="Updating CPU microcode" class="md-nav__link">
      Updating CPU microcode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../iexec_install/" title="Patched driver & engine" class="md-nav__link">
      Patched driver & engine
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Language Support
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Language Support
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../C/" title="C" class="md-nav__link">
      C
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../C++/" title="C++" class="md-nav__link">
      C++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Fortran/" title="Fortran" class="md-nav__link">
      Fortran
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GO/" title="GO" class="md-nav__link">
      GO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Java/" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pypyscone/" title="PyPy" class="md-nav__link">
      PyPy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nodejs/" title="Node" class="md-nav__link">
      Node
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../R/" title="R" class="md-nav__link">
      R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Rust/" title="Rust" class="md-nav__link">
      Rust
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      IDE Integration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        IDE Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../eclipse/" title="Eclipse" class="md-nav__link">
      Eclipse
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Command Line Interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Command Line Interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_CLI/" title="SCONE CLI" class="md-nav__link">
      SCONE CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_toolchain/" title="SCONE SGX toolchain" class="md-nav__link">
      SCONE SGX toolchain
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Curated_Images/" title="SCONE Curated Images" class="md-nav__link">
      SCONE Curated Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_TUTORIAL/" title="SCONE Static vs Dynamic" class="md-nav__link">
      SCONE Static vs Dynamic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_GENERATE_IMAGE/" title="SCONE Create Image" class="md-nav__link">
      SCONE Create Image
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Dockerfile/" title="SCONE Dockerfile" class="md-nav__link">
      SCONE Dockerfile
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Manuals
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Manuals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Fileshield/" title="scone fspf" class="md-nav__link">
      scone fspf
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_ENV/" title="environment variables" class="md-nav__link">
      environment variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MrEnclave/" title="MrEnclave" class="md-nav__link">
      MrEnclave
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fork/" title="fork" class="md-nav__link">
      fork
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../performance/" title="Performance" class="md-nav__link">
      Performance
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Background
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Background
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../appsecurity/" title="Application-Oriented Security" class="md-nav__link">
      Application-Oriented Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../background/" title="SCONE Background" class="md-nav__link">
      SCONE Background
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SCONE_Publications/" title="Publications" class="md-nav__link">
      Publications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../aboutScone/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#file-encryption" title="File Encryption" class="md-nav__link">
    File Encryption
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="example-end-to-end-encryption">Example: End-to-End Encryption<a class="headerlink" href="#example-end-to-end-encryption" title="Permanent link">&para;</a></h1>
<p>We show how to encrypt an application end-to-end, i.e., all the data in the file system is encrypted, all data in main memory is encrypted and all data on the wire is encrypted.</p>
<p>In what follows, we only interact with one swarm. Hence, we set environment variable <strong>SCONE_MANAGER</strong> to point to the manager node of the swarm. Say, in our case the manage is called <strong>faye</strong>:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">export</span> <span class="nv">SCONE_MANAGER</span><span class="o">=</span>faye
</pre></div>

<p>We have prepared an nginx image that contains this website as encrypted files and nginx is running inside of an enclave reading the encrypted files
from the file system and decrypting these files inside the enclave.</p>
<p>Let's assume that we have the newest image in our local swarm registry:</p>
<div class="codehilite"><pre><span></span>$ scone service pull sconecuratedimages/sconetainer:fss
...
fss: digest: sha256:2e76b4a0b090cc75c2e56594e20c7ec36bc1abd13e36e2f00d36e2f67b13c1d5 size: <span class="m">1783</span>
new tag: localhost:5000/sconetainer:fss
</pre></div>

<p>We will start this service as a stack. Hence, we define a simple stack/compose file:</p>
<div class="codehilite"><pre><span></span>$ cat &gt; compose.yml <span class="s">&lt;&lt; EOF</span>
<span class="s">version: &quot;3.1.scone&quot;</span>
<span class="s">services:</span>
<span class="s">    nginx:</span>
<span class="s">        image: 127.0.0.1:5000/sconetainer:fss</span>
<span class="s">        command: nginx -p /nginx -c nginx.conf</span>
<span class="s">        mrenclave: 1516e3d41590cf3842282c6f037535af64336138a6b5eff7e8754e97b4c64ecb</span>
<span class="s">        fspf_path: /nginx/fspf.pb</span>
<span class="s">        fspf_key: 970f4925bb7b221461f3d1a3f17450aa42844539de24f5acc1b45b8c140f9467</span>
<span class="s">        fspf_tag: 5930bffbd9ea2f1317e6872b032334db</span>
<span class="s">        working_dir: /</span>
<span class="s">        ports:</span>
<span class="s">          - 8190:8080</span>
<span class="s">          - 8192:8082</span>
<span class="s">EOF</span>
</pre></div>

<p>We explain in section <a href="../MrEnclave/">MrEnclave</a> how to determine mrenclave.</p>
<p>For now, this file contains some metadata related to the encrypted files:</p>
<ul>
<li><strong>fspf_path</strong> the path of the <em>file system protection file</em></li>
<li><strong>fspf_key</strong> the key used to encrypt the <em>file system protection file</em></li>
<li><strong>fspf_tag</strong> the tag (i.e., MAC) of the <em>file system protection file</em></li>
</ul>
<p>We provide a low level for encrypting files with the help of <a href="../SCONE_Fileshield/">scone fspf</a>. (We will soon release a higher level support that will simplify the encryption of files). </p>
<p>In this swarm, we have a CAS (Configuration and Attestation Service running): the CAS helps
us to to pass some secrets like the <strong>fspf_key</strong> to an enclave and protecting both
the confidentiality as well as the integrity of this secret.</p>
<p>Clients can identify the CAS via its certificate. In this example,
we explicitly specify the certificate of the CAS:</p>
<div class="codehilite"><pre><span></span>$ cat &gt; ca.pem <span class="s">&lt;&lt; EOF</span>
<span class="s">-----BEGIN CERTIFICATE-----</span>
<span class="s">MIICFzCCAb2gAwIBAgIJAOawWIYrvd1oMAoGCCqGSM49BAMCMGgxCzAJBgNVBAYT</span>
<span class="s">AkRFMQ8wDQYDVQQIDAZTYXhvbnkxEDAOBgNVBAcMB0RyZXNkZW4xFDASBgNVBAoM</span>
<span class="s">C3Njb250YWluIFVHMSAwHgYJKoZIhvcNAQkBFhFpbmZvQHNjb250YWluLmNvbTAe</span>
<span class="s">Fw0xODA0MDYxMDIyMzdaFw0yODA0MDMxMDIyMzdaMGgxCzAJBgNVBAYTAkRFMQ8w</span>
<span class="s">DQYDVQQIDAZTYXhvbnkxEDAOBgNVBAcMB0RyZXNkZW4xFDASBgNVBAoMC3Njb250</span>
<span class="s">YWluIFVHMSAwHgYJKoZIhvcNAQkBFhFpbmZvQHNjb250YWluLmNvbTBZMBMGByqG</span>
<span class="s">SM49AgEGCCqGSM49AwEHA0IABD9u85bK+nFdbnQVgZuR/rA9BmNmow3v4v5srS3M</span>
<span class="s">YGpVmRqpNbb/QYQ9iJN854N42L9T6mGyI402tKPYyfwz3k+jUDBOMB0GA1UdDgQW</span>
<span class="s">BBRhGJGv9MWohiZD3AySHz/otlxbyDAfBgNVHSMEGDAWgBRhGJGv9MWohiZD3AyS</span>
<span class="s">Hz/otlxbyDAMBgNVHRMEBTADAQH/MAoGCCqGSM49BAMCA0gAMEUCIQCWkKHgeDgn</span>
<span class="s">4PrHfmfjYYerxyFyGmWOKjO5UcijrPqI9wIgUyhZ2OwuyzsjTEC6ofR4fzlnrUQJ</span>
<span class="s">XlkFOKY2/HqOPVE=</span>
<span class="s">-----END CERTIFICATE-----</span>
<span class="s">EOF</span>
</pre></div>

<p>and now log into the CAS:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">export</span> <span class="nv">IP</span><span class="o">=</span>x.y.z.u
$ mkdir -p ~/.config
$ rm -f ~/.config/scone_cmd.conf
$ scone cas login -c ca.pem christof cas --host <span class="nv">$IP</span>:8081:18765
</pre></div>

<p>We split our stack file into two parts: public part sent to the docker engine and a secret part that is directly sent to the CAS:</p>
<div class="codehilite"><pre><span></span>$ scone cas split compose.yml  --stack <span class="m">283299</span>
</pre></div>

<p>For now, the stack ID is a randomly chose unique ID. If you want to modify this stack later, you need to use the same stack ID.  </p>
<p>Show public part that is sent to <strong>docker stack</strong> (which is the original stack file name appended with "docker.yml"):</p>
<div class="codehilite"><pre><span></span>$ cat compose.yml.docker.yml
---
services: 
  nginx: 
    command: nginx
    environment: 
      SCONE_CAS_ADDR: <span class="s2">&quot;x.y.z.u:18765&quot;</span>
      SCONE_CONFIG_ID: christof/283299/nginx
      SCONE_LAS_ADDR: <span class="s2">&quot;172.17.0.1:18766&quot;</span>
    image: <span class="s2">&quot;127.0.0.1:5000/sconetainer:fss&quot;</span>
    ports: 
      - <span class="s2">&quot;8190:8080&quot;</span>
      - <span class="s2">&quot;8192:8082&quot;</span>
version: <span class="s2">&quot;3.1&quot;</span>
</pre></div>

<p>Note: in the above example we assume that the host on which nginx is running is available at address  <strong>172.17.0.1</strong>. Hence, the <strong>LAS</strong> is available at  address <strong>"172.17.0.1:18766</strong>. In case you run a non-standard configuration, you might need to change  <strong>SCONE_LAS_ADDR</strong> to the ip address and port where the LAS  is available. The LAS must run on the same host for the attestation to work.</p>
<p>We can now deploy the service with the help of docker/scone stack:</p>
<div class="codehilite"><pre><span></span>$ scone stack deploy --compose-file compose.yml  nginx
Creating network nginx_default
Creating service nginx_nginx
</pre></div>

<p>Show running stack:</p>
<div class="codehilite"><pre><span></span>$ scone stack ls
NAME        SERVICES
nginx       <span class="m">1</span>
</pre></div>

<p>We can get some more information about this stack:</p>
<div class="codehilite"><pre><span></span>$ scone stack ps nginx
ID                  NAME                IMAGE                            NODE                DESIRED STATE       CURRENT STATE             ERROR                       PORTS
h08r5hmeu9bt        nginx_nginx.1       <span class="m">127</span>.0.0.1:5000/sconetainer:fss   dorothy             Running             Starting <span class="m">19</span> seconds ago       
</pre></div>

<h2 id="file-encryption">File Encryption<a class="headerlink" href="#file-encryption" title="Permanent link">&para;</a></h2>
<p>Let's check that the files inside of nginx container are indeed encrypted. To do so, we ssh to node  <strong>dorothy</strong> and execute the following commands:</p>
<div class="codehilite"><pre><span></span>&gt; sudo docker ps
CONTAINER ID        IMAGE                                    COMMAND                  CREATED             STATUS              PORTS                      NAMES
b01ab65e1579        <span class="m">127</span>.0.0.1:5000/sconetainer:fss           <span class="s2">&quot;nginx&quot;</span>                  <span class="m">6</span> minutes ago       Up <span class="m">6</span> minutes        <span class="m">8080</span>/tcp, <span class="m">8082</span>/tcp         nginx_nginx.1.0wh80346mpmm5f3l1rc8dipix
...
</pre></div>

<p>Let's look inside the container:</p>
<div class="codehilite"><pre><span></span>&gt; sudo docker <span class="nb">exec</span> -it b01ab65e1579 sh
$ ls
bin             media           proc            srv
dev             mnt             root            sys
etc             nginx           run             tmp
home            nginx-etc       sbin            usr
lib             opt             scone-test.key  var
</pre></div>

<p>The nginx configuration file as well as the html files should be encrypted. Let's verify this:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> nginx
$ ls
certificate.pem  key.pem          nginx.conf       www_root
fspf.pb          mime.types       nginx.pid
$ head -c <span class="m">80</span> nginx.conf
<span class="o">]</span>P?ɟ<span class="s2">&quot;4???zS????Ƶ?kjƘ?Ec?!S^!??????8j-?e;?t&#39;?2?L????????y??˲?ߋ   </span>
</pre></div>

<p>Ok, the nginx configuration file seems to be encrypted. Now, look at the html files too:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> www_root
$ ls 
4K                               SCONE_TUTORIAL
GO                               aboutScone
Python                           appsecurity
...
$ head -c <span class="m">80</span> index.html 
????V?ͪ?rhk?<span class="s2">&quot;k????</span><span class="nv">$?</span><span class="s2">    .???k?Ь?y&lt;??٠n?+????P2?G;o_&#39;.i?);?I??xFg[???[f?</span>
</pre></div>

<p>&copy; <a href="http://www.scontain.com">scontain.com</a>, December 2017. <a href="mailto:info@scontain.com">Questions or Suggestions?</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright Scontain © 2019
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.e72fd936.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../search/main.js"></script>
      
    
    
      
    
  </body>
</html>