



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Scone Documentation - Secure Containers">
      
      
        <link rel="canonical" href="https://sconedocs.github.io/SCONE_Fileshield/">
      
      
        <meta name="author" content="Christof Fetzer">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching pages">
      
        <meta name="lang:search.result.one" content="1 matching page">
      
        <meta name="lang:search.result.other" content="# matching page">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/scone-favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.3">
    
    
      
        <title>scone fspf - SCONE Confidential Computing</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:300,400,400i,700|">
        <style>body,input{font-family:"PT Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
      <link rel="stylesheet" href="../css/tooltips.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="purple">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#scone-file-protection" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://sconedocs.github.io" title="SCONE Confidential Computing" class="md-header-nav__button md-logo">
          
            <img src="../img/logo-yellow-square.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                SCONE Confidential Computing
              </span>
              <span class="md-header-nav__topic">
                scone fspf
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search this site" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching this site
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://sconedocs.github.io" title="SCONE Confidential Computing" class="md-nav__button md-logo">
      
        <img src="../img/logo-yellow-square.png" width="48" height="48">
      
    </a>
    SCONE Confidential Computing
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href=".." title="Executive summary" class="md-nav__link">
      Executive summary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advantages/" title="Advantages of SCONE" class="md-nav__link">
      Advantages of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../whyscone/" title="SCONE vs Intel SGX SDK" class="md-nav__link">
      SCONE vs Intel SGX SDK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../technical_summary/" title="Technical summary of SCONE" class="md-nav__link">
      Technical summary of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../buildingApps/" title="(No) Cross-Compilation" class="md-nav__link">
      (No) Cross-Compilation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../curated_images/" title="Curated Images" class="md-nav__link">
      Curated Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../community_version/" title="Community Version" class="md-nav__link">
      Community Version
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Kubernetes SCONE CC
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Kubernetes SCONE CC
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../k8s_concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm/" title="Deploying Helm" class="md-nav__link">
      Deploying Helm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_sgxdevplugin/" title="Kubernetes SGX Plugin" class="md-nav__link">
      Kubernetes SGX Plugin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kubeapps/" title="Kubeapps" class="md-nav__link">
      Kubeapps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../k8s_dashboard/" title="Kubernetes Dashboard" class="md-nav__link">
      Kubernetes Dashboard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_cas/" title="CAS Deploy & Attest" class="md-nav__link">
      CAS Deploy & Attest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_las/" title="LAS Deploy & Platforms" class="md-nav__link">
      LAS Deploy & Platforms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_mariadb/" title="MariaDB Deploy & Attest" class="md-nav__link">
      MariaDB Deploy & Attest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_teemon/" title="TEEMon Deployment" class="md-nav__link">
      TEEMon Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_vscode/" title="Visual Studio Code" class="md-nav__link">
      Visual Studio Code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hello_world_kubernetes/" title="Hello World Kubernetes" class="md-nav__link">
      Hello World Kubernetes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../scone-use-case-overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secure_remote_execution/" title="Secure Remote Execution" class="md-nav__link">
      Secure Remote Execution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerfileexample/" title="Dockerfile Example" class="md-nav__link">
      Dockerfile Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multistagebuild/" title="Multi-stage build" class="md-nav__link">
      Multi-stage build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../groupcacheUseCase/" title="GO example" class="md-nav__link">
      GO example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../memory_dump/" title="Finding Secrets" class="md-nav__link">
      Finding Secrets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dapps/" title="Trusted DApps" class="md-nav__link">
      Trusted DApps
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Configuration & Attestation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Configuration & Attestation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CASOverview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_intro/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_for_development/" title="Starting CAS" class="md-nav__link">
      Starting CAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../LASIntro/" title="Starting LAS" class="md-nav__link">
      Starting LAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_blender_example/" title="Posting Sessions" class="md-nav__link">
      Posting Sessions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_cli-intro/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_cli/" title="CLI Details" class="md-nav__link">
      CLI Details
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CAS_session_lang_0_2/" title="Policy Language 0.2" class="md-nav__link">
      Policy Language 0.2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../print-arg-env/" title="Secure Arguments" class="md-nav__link">
      Secure Arguments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EncryptedWordCount/" title="Encrypted Code and Input" class="md-nav__link">
      Encrypted Code and Input
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Use Cases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Use Cases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../usecases/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../blender/" title="Blender" class="md-nav__link">
      Blender
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pyspark/" title="PySpark" class="md-nav__link">
      PySpark
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflow/" title="TensorFlow" class="md-nav__link">
      TensorFlow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflowlite/" title="TensorFlow Lite" class="md-nav__link">
      TensorFlow Lite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../openvino/" title="OpenVino" class="md-nav__link">
      OpenVino
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vault/" title="Vault" class="md-nav__link">
      Vault
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Execution Modes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Execution Modes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../outline/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../firstcontainer/" title="Simulation Mode" class="md-nav__link">
      Simulation Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hardwaremode/" title="Hardware Mode" class="md-nav__link">
      Hardware Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hostexample/" title="Host Execution" class="md-nav__link">
      Host Execution
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" title="Installation overview" class="md-nav__link">
      Installation overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerinstall/" title="Installing docker" class="md-nav__link">
      Installing docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sgxinstall/" title="Installing Intel SGX driver" class="md-nav__link">
      Installing Intel SGX driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeinstall/" title="Installing SCONE" class="md-nav__link">
      Installing SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../microcode/" title="Updating CPU microcode" class="md-nav__link">
      Updating CPU microcode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows10/" title="Windows 10" class="md-nav__link">
      Windows 10
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Continuous Integration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Continuous Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../scone_semantic_versioning/" title="Scone Semantic Versioning" class="md-nav__link">
      Scone Semantic Versioning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Language Support
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Language Support
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../C/" title="C" class="md-nav__link">
      C
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mono/" title="C#" class="md-nav__link">
      C#
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../C++/" title="C++" class="md-nav__link">
      C++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Fortran/" title="Fortran" class="md-nav__link">
      Fortran
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GO/" title="GO" class="md-nav__link">
      GO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Java/" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Running_Java_Applications_in_Scone_with_remote_attestation/" title="Java with remote attestation" class="md-nav__link">
      Java with remote attestation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pypyscone/" title="PyPy" class="md-nav__link">
      PyPy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mono/" title="Mono" class="md-nav__link">
      Mono
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nodejs/" title="Node" class="md-nav__link">
      Node
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../R/" title="R" class="md-nav__link">
      R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Rust/" title="Rust" class="md-nav__link">
      Rust
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      IDE Integration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        IDE Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../eclipse/" title="Eclipse" class="md-nav__link">
      Eclipse
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helm_vscode/" title="Visual Studio Code" class="md-nav__link">
      Visual Studio Code
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Command Line Interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Command Line Interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_CLI/" title="SCONE CLI" class="md-nav__link">
      SCONE CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_toolchain/" title="SCONE SGX toolchain" class="md-nav__link">
      SCONE SGX toolchain
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Curated_Images/" title="SCONE Curated Images" class="md-nav__link">
      SCONE Curated Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_TUTORIAL/" title="SCONE Static vs Dynamic" class="md-nav__link">
      SCONE Static vs Dynamic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_GENERATE_IMAGE/" title="SCONE Create Image" class="md-nav__link">
      SCONE Create Image
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Dockerfile/" title="SCONE Dockerfile" class="md-nav__link">
      SCONE Dockerfile
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12" checked>
    
    <label class="md-nav__link" for="nav-12">
      Manuals
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Manuals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        scone fspf
      </label>
    
    <a href="./" title="scone fspf" class="md-nav__link md-nav__link--active">
      scone fspf
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concepts" title="Concepts" class="md-nav__link">
    Concepts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" title="Example" class="md-nav__link">
    Example
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-system-protection-file" title="File System Protection File" class="md-nav__link">
    File System Protection File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python" title="Python" class="md-nav__link">
    Python
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protecting-the-root-region" title="Protecting the Root Region" class="md-nav__link">
    Protecting the Root Region
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-files-from-an-existing-container-image" title="Adding files from an existing container image" class="md-nav__link">
    Adding files from an existing container image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#checking-the-file-system-shield" title="Checking the File System Shield" class="md-nav__link">
    Checking the File System Shield
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extended-example" title="Extended Example" class="md-nav__link">
    Extended Example
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_ENV/" title="environment variables" class="md-nav__link">
      environment variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MrEnclave/" title="MrEnclave" class="md-nav__link">
      MrEnclave
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scone_affinity/" title="affinity" class="md-nav__link">
      affinity
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      Performance
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        Performance
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../performance/" title="Applications" class="md-nav__link">
      Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../teemon/" title="Monitoring tool" class="md-nav__link">
      Monitoring tool
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      Background
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        Background
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../appsecurity/" title="Application-Oriented Security" class="md-nav__link">
      Application-Oriented Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../background/" title="SCONE Background" class="md-nav__link">
      SCONE Background
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SCONE_Publications/" title="Publications" class="md-nav__link">
      Publications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../aboutScone/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concepts" title="Concepts" class="md-nav__link">
    Concepts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" title="Example" class="md-nav__link">
    Example
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-system-protection-file" title="File System Protection File" class="md-nav__link">
    File System Protection File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python" title="Python" class="md-nav__link">
    Python
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protecting-the-root-region" title="Protecting the Root Region" class="md-nav__link">
    Protecting the Root Region
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-files-from-an-existing-container-image" title="Adding files from an existing container image" class="md-nav__link">
    Adding files from an existing container image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#checking-the-file-system-shield" title="Checking the File System Shield" class="md-nav__link">
    Checking the File System Shield
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extended-example" title="Extended Example" class="md-nav__link">
    Extended Example
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="scone-file-protection">SCONE File Protection</h1>
<p>This section describes the low-level SCONE file encryption interface to encrypt the root filesystem of an image. In many cases, one might want to use a <a href="../CAS_session_lang_0_2/#volumes">SCONE volume</a> instead:</p>
<ul>
<li>a SCONE volume is typically mapped on a Kubernetes volume with access modes ReadWriteOnce or ReadOnlyMany</li>
<li>a SCONE volume is automatically encrypted, i.e., no need to perform the <code>fspf</code> operations described in this section</li>
<li>a SCONE volume - as a Kubernetes volume - exists only once and SCONE CAS tracks its confidentiality and integrity including freshness.</li>
</ul>
<h2 id="concepts">Concepts</h2>
<p>SCONE supports the transparent encryption and/or authentication of files of the root file system of a container / image. By <strong>transparent</strong>, we mean that there are no application code changes needed to support this. The underlying idea of SCONE file protection is that a user specifies that each file is <strong>either</strong>:</p>
<ul>
<li>
<p><strong>authenticated</strong>, i.e., SCONE checks that the content was not modified by some unauthorized entity,</p>
</li>
<li>
<p><strong>encrypted</strong>, i.e., the confidentiality is protected by encryption. Encrypted files are always authenticated, or</p>
</li>
<li>
<p><strong>not-protected</strong>, i.e. SCONE reads and write  the files without any extra protection mechanisms. For example, you might use <em>not-protected</em> if your application already encrypts its files or if you need direct access to devices.</p>
</li>
</ul>
<p>Marking all files individually as either <em>authenticated</em>, <em>encrypted</em>, or <em>not-protected</em> would not be very practical. Hence, we support to partition the filesystem into <strong>regions</strong>: regions do not overlap and each file belongs to exactly one region.</p>
<p>A region is defined by a path. For example, region <strong>/</strong> is the root region and you could, for example, specify that all files in region <strong>/</strong> must be authenticated. You can define a second region, for example,  region <strong>/data/db</strong> and that this region is encrypted.</p>
<p>Each file belongs to exactly one region: it belongs to the region that has the longest common path prefix with this file. For example, file <em>/etc/db.conf</em> would belong, in this case, to region <em>/</em> and file <em>/data/db/table.db</em> would belong to region <em>/data/db</em>.</p>
<p>SCONE supports <strong>ephemeral</strong> regions: files are stored in main memory outside of the enclave. Since the main memory is not protected, we recommend that an ephemeral regions is either authenticated or encrypted.  When a program starts, all its ephemeral regions are empty. The only way to add files to an ephemeral region is by the application writing to this region. <strong>All files in an ephemeral region are lost when the application exits.</strong></p>
<p>All files that need to be persistent should be stored in a non-ephemeral region instead. We refer to this as a <strong>kernel</strong>  region. For each region, you need to specify if the region is either <strong>ephemeral</strong> or <strong>kernel</strong>.</p>
<p>Each region belongs to one of the following six classes:
   <center>{<strong>ephemeral</strong> | <strong>kernel</strong>} X {<strong>not-protected</strong> | <strong>authenticated</strong> | <strong>encrypted</strong> }</center></p>
<h2 id="example">Example</h2>
<p>Sometimes, we might only need to protect the files that are passed to a container via some volume. In this case, it would be sufficient that the volume is either authenticated or encrypted.</p>
<p>Let us demonstrate this via a simple example in which we pass an encrypted volume to a container. We create this encrypted volume in our local filesystem (in directory <strong>volume</strong>) and we will later mount this in the container as <strong>/data</strong>. The original (non-encrypted) files are stored in directory <strong>data-original</strong>.</p>
<div class="highlight"><pre><span></span>&gt; mkdir -p volume
&gt; mkdir -p data-original
</pre></div>

<p>Let's write some files in the <em>data-original</em> directory:</p>
<div class="highlight"><pre><span></span>cat &gt; data-original/hello.txt <span class="s">&lt;&lt; EOF</span>
<span class="s">Hello World</span>
<span class="s">EOF</span>
cat &gt; data-original/world.py <span class="s">&lt;&lt; EOF</span>
<span class="s">f = open(&#39;/data/hello.txt&#39;, &#39;r&#39;)</span>
<span class="s">print str(f.read())</span>
<span class="s">EOF</span>
</pre></div>

<p>Let's check that <strong>volume</strong> is empty and we print the hash values of the two files in <strong>data-original</strong>:</p>
<div class="highlight"><pre><span></span>&gt; ls volume
&gt; shasum data-original/*
648a6a6ffffdaa0badb23b8baf90b6168dd16b3a  data-original/hello.txt
deda99d44e880ea8f2250f45c5c20c15d568d84c  data-original/world.py
</pre></div>

<p>Now, we start the SCONE crosscompiler in a container to create the encrypted volume:</p>
<div class="highlight"><pre><span></span>&gt; docker run -it -v <span class="s2">&quot;</span><span class="nv">$PWD</span><span class="s2">/volume:/data&quot;</span> -v <span class="s2">&quot;</span><span class="nv">$PWD</span><span class="s2">/data-original:/data-original&quot;</span> sconecuratedimages/crosscompilers
</pre></div>

<h3 id="file-system-protection-file">File System Protection File</h3>
<p>All the metadata required for checking the consistency of the files is stored in a <em>file system protection file</em>, or, short <em>fspf</em>. SCONE supports multiple *fspf*s. </p>
<p>Let's start with a simple example with a single <em>fspf</em>. The <em>fspf</em> file is created via command <strong>scone fspf create</strong> and let us name this file <strong>fspf.pb</strong>. We execute the following commands
inside the container (as indicated by the $ prompt):</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> /data
$ scone fspf create fspf.pb
Created empty file system protection file in fspf.pb. AES-GCM tag: 0e3da7ad62f5bc7c7bb08c67b16f2423
</pre></div>

<p>We can now split the file system in <em>regions</em>, a region is a subtree. You can add regions to a <em>fspf</em> with the help of command <strong>scone fspf addr</strong>.</p>
<p>Each region has exactly one of the following properties:</p>
<ul>
<li><strong>authenticated</strong>: the integrity of files is checked, i.e., any unauthorized modification of this file is detected and results in a reading error inside of the enclave. Specify command line option <strong>--authenticated</strong>.</li>
<li><strong>encrypted</strong>: the confidentiality and integrity of files is protected, i.e., encrypted always implies that the files are also authenticated. Specify command line option <strong>--encrypted</strong>.</li>
<li><strong>not-protected</strong>: files are neither authenticated nor encrypted. Specify command line option <strong>--not-protected</strong>.</li>
</ul>
<p>File system changes of containers are typically ephemeral in the sense that file updates are lost when a container terminates. When specifying option <strong>--ephemeral</strong>, files in this region are not written to disk, the are written to an in memory file system instead. </p>
<p>Say for now, that by default we do not protect files and we want to read files and write  back  changed files to the file system. To do so, we define that the root tree is  <strong>--kernel</strong> as well as  <strong>--not-protected</strong>:</p>
<div class="highlight"><pre><span></span>$ scone fspf addr fspf.pb / --kernel / --not-protected
Added region / to file system protection file fspf.pb new AES-GCM tag: dd961af10b5aaa5cb1044c35a3f42c84
</pre></div>

<p>Let us add another region <strong>/data</strong> that should be encrypted and persisted. To encrypt the files,  we specify option <strong>--encrypted</strong>.
We specify option <strong>--kernel</strong> followed by a path (here, also <strong>/data</strong>) to request that files in this region are written to the kernel file system into directory <strong>/data</strong>.</p>
<div class="highlight"><pre><span></span>$ scone fspf addr fspf.pb /data --encrypted --kernel /data
Added region /data to file system protection file fspf.pb new AES-GCM tag: 8481369d3ffdd9b6aeb30d044bf5c1c7
</pre></div>

<p>The encryption key for a file is chosen at random and stored in <em>fspf.pb</em>. We use the Intel random number generator <em>RdRand</em> to generate the key. The default key length of a region is 32 bytes. Alternatives are key length of 16 and 24 bytes. These can be selected via option  <strong>--key-length 16</strong> and <strong>--key-length 24</strong> when creating a region with command <strong>scone fspf addr</strong>.</p>
<p>Now, that we defined the regions, i.e., <strong>/</strong> and <strong>/data</strong>, we can add files to region <strong>/data</strong>.
Let's just add all files in <strong>/data-original</strong>, encrypt these and write the encrypted files to <strong>/data</strong>.
Note, the first <strong>/data</strong> argument specifies the protection region that determines the protection policy.
The second, specifies where the encrypted files will be stored.
That is, the command iterates over and reads the existing files in <strong>/data-original</strong> and encrypts them.
The encrypted file content is written into the directory <strong>/data</strong> while the protection metadata of the individual files is added to the <strong>fsfp.pb</strong> file.</p>
<div class="highlight"><pre><span></span>$ scone fspf addf fspf.pb /data /data-original /data
Added files to file system protection file fspf.pb new AES-GCM tag: 39a268166e628cf76e3fca80aa2d4f63
</pre></div>

<p><strong>Note</strong> that if the <strong>/data</strong> region would have been only authenticated and not encrypted, the tool does not need to write out any (encrypted) files.
It will only add the file names and the checksums (tags) of the files located in <strong>/data-original</strong> to the <strong>fspf.pb</strong> file.
Thus, you could drop the last argument in this case.</p>
<p>Coming back to the above example, we can now compare the hash values of the original files and the encrypted files:</p>
<div class="highlight"><pre><span></span>$ shasum /data/*
87fd97468024e3d2864516ff5840e15d9615340d  /data/fspf.pb
31732914910f4a08b9832c442074b0932915476c  /data/hello.txt
8d07f3f576785c373a5e70e8dbcfa8ee06ca6d0c  /data/world.py
$ shasum /data-original/*
648a6a6ffffdaa0badb23b8baf90b6168dd16b3a  /data-original/hello.txt
deda99d44e880ea8f2250f45c5c20c15d568d84c  /data-original/world.py
</pre></div>

<p>The fspf itself is not yet encrypted. We encrypt this file via command
<strong>scone fspf encrypt fspf.pb</strong></p>
<p><div class="highlight"><pre><span></span>$ scone fspf encrypt fspf.pb &gt; /data-original/keytag
</pre></div>
We store the random encryption key as well as the tag of file <strong>fspf.pb</strong> in file  <strong>/data-original/keytag</strong>.</p>
<p>We introduce a very simple program that reads the two files:</p>
<div class="highlight"><pre><span></span>$ cat &gt; example.c <span class="s">&lt;&lt; EOF</span>
<span class="s">#include &lt;stdio.h&gt;</span>
<span class="s">#include &lt;stdlib.h&gt;</span>

<span class="s">void printfile(const char* fn) {</span>
<span class="s">    FILE *fp = fopen(fn, &quot;r&quot;);</span>
<span class="s">    char c;</span>
<span class="s">    while((c=fgetc(fp))!=EOF</span><span class="o">){</span>
        printf<span class="o">(</span><span class="s2">&quot;%c&quot;</span>,c<span class="o">)</span><span class="p">;</span>
    <span class="o">}</span>
    fclose<span class="o">(</span>fp<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>

int main<span class="o">()</span> <span class="o">{</span>
    printfile<span class="o">(</span><span class="s2">&quot;/data/hello.txt&quot;</span><span class="o">)</span><span class="p">;</span>
    printfile<span class="o">(</span><span class="s2">&quot;/data/world.py&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
EOF
</pre></div>

<p>Let's crosscompile this program:</p>
<div class="highlight"><pre><span></span>scone gcc example.c -o example
</pre></div>

<p>Executing this program results in an output like this:</p>
<div class="highlight"><pre><span></span>$./example
R??C?
    q?z??E??<span class="p">|</span>Ю?<span class="o">}</span>ü ?o
<span class="nv">$?</span>?!rga??·*<span class="sb">`</span>?????????Gw?
</pre></div>

<p>We need to activate the file system shield via environment variables by setting the location of the file system protection file (in <strong>SCONE_FSPF</strong>), the encryption key of the file (in <strong>SCONE_FSPF_KEY</strong>) and the tag of the fspf (in <strong>SCONE_FSPF_TAG</strong>). 
We can extract the encryption key as well as the tag of <strong>fspf.pb</strong> from file <strong>/data-original/keytag</strong>:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">SCONE_FSPF_KEY</span><span class="o">=</span><span class="k">$(</span>cat /data-original/keytag <span class="p">|</span> awk <span class="s1">&#39;{print $11}&#39;</span><span class="k">)</span>
$ <span class="nb">export</span> <span class="nv">SCONE_FSPF_TAG</span><span class="o">=</span><span class="k">$(</span>cat /data-original/keytag <span class="p">|</span> awk <span class="s1">&#39;{print $9}&#39;</span><span class="k">)</span>
$ <span class="nb">export</span> <span class="nv">SCONE_FSPF</span><span class="o">=</span>/data/fspf.pb
</pre></div>

<p>We can now execute this program again:</p>
<div class="highlight"><pre><span></span>$ ./example
Hello World
<span class="nv">f</span> <span class="o">=</span> open<span class="o">(</span><span class="s1">&#39;/data/hello.txt&#39;</span>, <span class="s1">&#39;r&#39;</span><span class="o">)</span>
print str<span class="o">(</span>f.read<span class="o">())</span>
</pre></div>

<p>Variables <strong>SCONE_FSPF_KEY</strong>, <strong>SCONE_FSPF_TAG</strong> and <strong>SCONE_FSPF</strong> should only be set manually for debugging since they cannot securely be passed in this way to programs running inside enclaves. To securely pass environment variables, please use <a href="../cas_intro/">CAS</a>.</p>
<h2 id="python">Python</h2>
<p>Let's try a similar approach for Python. 
In the above example, we encrypted a Python program. Let's try to execute this encrypted program that accesses an encrypted file:</p>
<div class="highlight"><pre><span></span>docker run -it -v <span class="s2">&quot;</span><span class="nv">$PWD</span><span class="s2">/volume:/data&quot;</span> sconecuratedimages/apps:python-2.7-alpine3.6 bash
</pre></div>

<p>The files <em>/data/world.py</em> and  <em>/data/hello.txt</em> are encrypted:</p>
<div class="highlight"><pre><span></span>$ cat /data/world.py
?<span class="o">=</span>??J??0?6+?Q?nKd?*N,??.?G???????R?cO?t?y??&gt;f?
</pre></div>

<p>Let's activate the file shield:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">SCONE_FSPF_KEY</span><span class="o">=</span>... extract from data-original/keytag ...
$ <span class="nb">export</span> <span class="nv">SCONE_FSPF_TAG</span><span class="o">=</span>... extract from data-original/keytag ...
$ <span class="nb">export</span> <span class="nv">SCONE_FSPF</span><span class="o">=</span>/data/fspf.pb
</pre></div>

<p>We can now run the encrypted <strong>world.py</strong> program with the  the Python interpreter:</p>
<div class="highlight"><pre><span></span><span class="nv">SCONE_HEAP</span><span class="o">=</span><span class="m">100000000</span> <span class="nv">SCONE_ALPINE</span><span class="o">=</span><span class="m">1</span> <span class="nv">SCONE_VERSION</span><span class="o">=</span><span class="m">1</span> /usr/local/bin/python /data/world.py
<span class="nb">export</span> <span class="nv">SCONE_QUEUES</span><span class="o">=</span><span class="m">1</span>
...
Hello World
</pre></div>

<h2 id="protecting-the-root-region">Protecting the Root Region</h2>
<p>Note that in the above example, Python will not be permitted to load dynamic libraries  outside of the protected directory <strong>/data</strong>: a dynamic library must reside in either an authenticated or an encrypted region.  To deal with this, we must define one or more authenticated or encrypted file regions that contain the dynamic libraries.  </p>
<p>Let us show how to authenticate all files in region <strong>/</strong></p>
<div class="highlight"><pre><span></span>$ scone fspf addr fspf.pb / --kernel / --authenticated
</pre></div>

<p>We need to add all files that our application might access. Often, these files in the root region might be defined in some container image. Let's see how we can add these files to our region <strong>/</strong>.</p>
<h3 id="adding-files-from-an-existing-container-image">Adding files from an existing container image</h3>
<p>We show how to add a subset of the files of container image <strong>sconecuratedimages/apps:python-2.7-alpine3.6</strong> to our root region.
To do so, we ensure that we have the newest images:</p>
<div class="highlight"><pre><span></span>&gt; docker pull sconecuratedimages/apps:python-2.7-alpine3.6
&gt; docker pull sconecuratedimages/crosscompilers
</pre></div>

<p>How can we add all files in a container to the <em>fspf</em>? One way to do so requires to run Docker inside of a Docker container. To be able to do so, we need to permit our outermost docker container to have access to  <em>/var/run/docker.sock</em>:</p>
<div class="highlight"><pre><span></span>&gt; docker run -it -v /var/run/docker.sock:/var/run/docker.sock -v <span class="s2">&quot;</span><span class="nv">$PWD</span><span class="s2">/volume:/data&quot;</span> -v <span class="s2">&quot;</span><span class="nv">$PWD</span><span class="s2">/data-original:/data-original&quot;</span> sconecuratedimages/crosscompilers
</pre></div>

<p>Let us ensure that Docker is installed in this container:</p>
<div class="highlight"><pre><span></span>apt-get update
apt-get install -y docker.io
</pre></div>

<p>Now, we want to add all files of some target container. In our example,
this is an instance of image <em>sconecuratedimages/apps:python-2.7-alpine3.6</em>.
We ensure that we pulled the latest image before we start the container:</p>
<div class="highlight"><pre><span></span><span class="nv">CONTAINER_ID</span><span class="o">=</span><span class="sb">`</span>docker run -d sconecuratedimages/apps:python-2.7-alpine3.6 <span class="nb">printf</span> OK<span class="sb">`</span> 
</pre></div>

<p>We can now copy all files from this container into a new directory <strong>rootvol</strong>:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span>
$ mkdir -p rootvol
$ docker cp <span class="nv">$CONTAINER_ID</span>:/ ./rootvol
</pre></div>

<p>Now that we have a copy of the files, we should not forget to garbage collect this container:</p>
<div class="highlight"><pre><span></span>docker rm <span class="nv">$CONTAINER_ID</span>
</pre></div>

<p>Let's remove some directories that we do not want our program to access, like for example, <strong>/dev</strong>:</p>
<div class="highlight"><pre><span></span>$ rm -rf rootvol/dev rootvol/proc rootvol/bin rootvol/media rootvol/mnt rootvol/usr/share/X11 rootvol/usr/share/terminfo rootvol/optrootvol/usr/include/c++/ rootvol/usr/lib/tcl8.6 rootvol/usr/lib/gcc rootvol/opt rootvol/sys rootvol/usr/include/c++
</pre></div>

<p>Now, we create a root <em>fspf</em>:</p>
<div class="highlight"><pre><span></span>$ scone fspf create fspf.pb
$ scone fspf addr fspf.pb / --kernel / --authenticated
$ scone fspf addf fspf.pb / ./rootvol /
$ scone fspf encrypt fspf.pb &gt; keytag
</pre></div>

<p>We can now create a new container image with this file system protection file
using this Dockerfile</p>
<div class="highlight"><pre><span></span>$ cat &gt; Dockerfile <span class="s">&lt;&lt; EOF</span>
<span class="s">FROM sconecuratedimages/apps:python-2.7-alpine3.6</span>
<span class="s">COPY fspf.pb /</span>
<span class="s">EOF</span>
$ docker build -t sconecuratedimages/apps:python-2.7-alpine3.6-authenticated .
</pre></div>

<p>We can run a container as follows:
<div class="highlight"><pre><span></span>$ docker run -it sconecuratedimages/apps:python-2.7-alpine3.6-authenticated sh
</pre></div></p>
<p>Let us activate the file shield:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">SCONE_FSPF_KEY</span><span class="o">=</span>... extract from data-original/keytag ...
$ <span class="nb">export</span> <span class="nv">SCONE_FSPF_TAG</span><span class="o">=</span>... extract from data-original/keytag ...
$ <span class="nb">export</span> <span class="nv">SCONE_FSPF</span><span class="o">=</span>/fspf.pb
</pre></div>

<p>Let's run python with authenticated file system:</p>
<div class="highlight"><pre><span></span><span class="nv">SCONE_HEAP</span><span class="o">=</span><span class="m">1000000000</span> <span class="nv">SCONE_ALLOW_DLOPEN</span><span class="o">=</span><span class="m">2</span>  <span class="nv">SCONE_ALPINE</span><span class="o">=</span><span class="m">1</span> <span class="nv">SCONE_VERSION</span><span class="o">=</span><span class="m">1</span> /usr/local/bin/python
</pre></div>

<h2 id="checking-the-file-system-shield">Checking the File System Shield</h2>
<p>Let's us check the file shield by creating a new python program (<em>helloworld-manual.py</em>) in
side of a python container:</p>
<div class="highlight"><pre><span></span>&gt; docker run -i sconecuratedimages/apps:python-2.7-alpine3.6-authenticated sh
$ cat &gt; helloworld-manual.py <span class="s">&lt;&lt; EOF</span>
<span class="s">print &quot;Hello World&quot;</span>
<span class="s">EOF</span>
</pre></div>

<p>When we switch on the file shield, the execution of this program inside the enclave will fail: since this file was not part of the original file system, the file system shield will prevent accessing this file.</p>
<div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">SCONE_FSPF_KEY</span><span class="o">=</span>... extract from data-original/keytag ...
$ <span class="nb">export</span> <span class="nv">SCONE_FSPF_TAG</span><span class="o">=</span>... extract from data-original/keytag ...
$ <span class="nb">export</span> <span class="nv">SCONE_FSPF</span><span class="o">=</span>/fspf.pb
$ <span class="nv">SCONE_HEAP</span><span class="o">=</span><span class="m">1000000000</span> <span class="nv">SCONE_ALLOW_DLOPEN</span><span class="o">=</span><span class="m">2</span>  <span class="nv">SCONE_ALPINE</span><span class="o">=</span><span class="m">1</span> <span class="nv">SCONE_VERSION</span><span class="o">=</span><span class="m">1</span> /usr/local/bin/python helloworld-manual.py
<span class="o">(</span>fails<span class="o">)</span>
</pre></div>

<p>We can, however, add a new file via programs that have access to the key of the <em>fspf</em>. We can, for example, write a python program to add a new python program to the file system.</p>
<p>By default, we disable that the root fspf is updated. We can enable updates by setting environment variable <strong>SCONE_FSPF_MUTABLE=1</strong>. We plan to permit updates of the root fspf by default in the near future (i.e., we will remove variable <strong>SCONE_FSPF_MUTABLE=1</strong>).</p>
<div class="highlight"><pre><span></span>$ <span class="nv">SCONE_HEAP</span><span class="o">=</span><span class="m">1000000000</span> <span class="nv">SCONE_FSPF_MUTABLE</span><span class="o">=</span><span class="m">1</span> <span class="nv">SCONE_ALLOW_DLOPEN</span><span class="o">=</span><span class="m">2</span>  <span class="nv">SCONE_ALPINE</span><span class="o">=</span><span class="m">1</span> <span class="nv">SCONE_VERSION</span><span class="o">=</span><span class="m">1</span> /usr/local/bin/python  <span class="s">&lt;&lt; PYTHON</span>
<span class="s">f = open(&#39;helloworld.py&#39;, &#39;w&#39;)</span>
<span class="s">f.write(&#39;print &quot;Hello World&quot;\n&#39;)</span>
<span class="s">f.close()</span>
<span class="s">PYTHON</span><span class="sb">```</span>
</pre></div>

<p>The tag of the file system protection file is now changed. We can determine the new TAG with the help of command <strong>scone fspf show</strong>:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">SCONE_FSPF_TAG</span><span class="o">=</span><span class="k">$(</span>scone fspf show --tag /fspf.pb<span class="k">)</span>
</pre></div>

<p>Now, we can run the new <strong>helloworld.py</strong>:</p>
<div class="highlight"><pre><span></span>$ <span class="nv">SCONE_HEAP</span><span class="o">=</span><span class="m">1000000000</span> <span class="nv">SCONE_ALLOW_DLOPEN</span><span class="o">=</span><span class="m">2</span>  <span class="nv">SCONE_ALPINE</span><span class="o">=</span><span class="m">1</span> <span class="nv">SCONE_VERSION</span><span class="o">=</span><span class="m">1</span> /usr/local/bin/python helloworld.py
...
Hello World
</pre></div>

<h2 id="extended-example">Extended Example</h2>
<p>To learn how to use multiple file system protection files, 
please have a look at the following screencast.</p>
<script id="asciicast-285843" src="https://asciinema.org/a/285843.js" async></script>

<p>Below is the script that is executed in the screencast:</p>
<div class="highlight"><pre><span></span>docker run -it -v <span class="nv">$PWD</span>:/mnt sconecuratedimages/crosscompilers

mkdir -p /example
mkdir -p /mnt/authenticated/
mkdir -p /mnt/encrypted/
<span class="nb">cd</span> /example
mkdir -p .original

scone fspf create fspf.pb

<span class="c1"># add protection regions</span>
scone fspf addr fspf.pb / -e --ephemeral
scone fspf addr fspf.pb /mnt/authenticated -a --kernel /mnt/authenticated
scone fspf addr fspf.pb /mnt/encrypted -e --kernel /mnt/encrypted

<span class="c1"># add files</span>

<span class="c1"># enclave program should expect the files (directories) found by the client in ./original in /mnt/authenticated</span>
scone fspf addf fspf.pb /mnt/authenticated ./original

<span class="c1"># enclave program should expect the files (directories) found by the client in ./original in encrypted form in /mnt/encrypted</span>
<span class="c1"># the client will write the encrypted files to ./mnt/encrypted</span>
scone fspf addf fspf.pb /mnt/encrypted ./original ./mnt/encrypted
<span class="nv">KEYTAG</span><span class="o">=</span><span class="sb">`</span>scone fspf encrypt fspf.pb<span class="sb">`</span>
<span class="nb">export</span> <span class="nv">SCONE_FSPF_KEY</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$KEYTAG</span> <span class="p">|</span> awk <span class="s1">&#39;{print $11}&#39;</span><span class="sb">`</span>
<span class="nb">export</span> <span class="nv">SCONE_FSPF_TAG</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$KEYTAG</span> <span class="p">|</span> awk <span class="s1">&#39;{print $9}&#39;</span><span class="sb">`</span>

<span class="nb">echo</span> <span class="s2">&quot;SCONE_FSPF_KEY=</span><span class="si">${</span><span class="nv">SCONE_FSPF_KEY</span><span class="si">}</span><span class="s2"> ; SCONE_FSPF_TAG=</span><span class="si">${</span><span class="nv">SCONE_FSPF_TAG</span><span class="si">}</span><span class="s2">&quot;</span>
cat &gt; example.c <span class="s">&lt;&lt; EOF</span>
<span class="s">#include &lt;stdio.h&gt;</span>

<span class="s">int main() {</span>
<span class="s">    FILE *fp = fopen(&quot;/mnt/authenticated/hello&quot;, &quot;w&quot;);</span>
<span class="s">    fprintf(fp, &quot;hello world\n&quot;);</span>
<span class="s">    fclose(fp);</span>

<span class="s">    fp = fopen(&quot;/mnt/encrypted/hello&quot;, &quot;w&quot;);</span>
<span class="s">    fprintf(fp, &quot;hello world\n&quot;);</span>
<span class="s">    fclose(fp);</span>
<span class="s">}</span>
<span class="s">EOF</span>

scone gcc example.c -o sgxex
cat &gt; /etc/sgx-musl.conf <span class="s">&lt;&lt; EOF</span>
<span class="s">Q 4</span>
<span class="s">e -1 0 0</span>
<span class="s">s -1 0 0</span>
<span class="s">e -1 1 0</span>
<span class="s">s -1 1 0</span>
<span class="s">e -1 2 0</span>
<span class="s">s -1 2 0</span>
<span class="s">e -1 3 0</span>
<span class="s">s -1 3 0</span>
<span class="s">EOF</span>
<span class="nv">SCONE_FSPF</span><span class="o">=</span>fspf.pb ./sgxex
cat /mnt/authenticated/hello
cat /mnt/encrypted/hello
cat &gt; cat.c <span class="s">&lt;&lt; EOF</span>
<span class="s">#include &lt;stdio.h&gt;</span>

<span class="s">int main() {</span>
<span class="s">    char buf[80];</span>
<span class="s">    FILE *fp = fopen(&quot;/mnt/authenticated/hello&quot;, &quot;r&quot;);</span>
<span class="s">    fgets(buf, sizeof(buf), fp);</span>
<span class="s">    fclose(fp);</span>
<span class="s">    printf(&quot;read: &#39;%s&#39;\n&quot;, buf);</span>

<span class="s">    fp = fopen(&quot;/mnt/encrypted/hello&quot;, &quot;r&quot;);</span>
<span class="s">    fgets(buf, sizeof(buf), fp);</span>
<span class="s">    fclose(fp);</span>
<span class="s">    printf(&quot;read: &#39;%s&#39;\n&quot;, buf);</span>
<span class="s">}</span>
<span class="s">EOF</span>

scone gcc cat.c -o native_cat
./native_cat
scone gcc cat.c -o sgxcat
<span class="nv">SCONE_FSPF</span><span class="o">=</span>fspf.pb ./sgxcat
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../SCONE_Dockerfile/" title="SCONE Dockerfile" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                SCONE Dockerfile
              </span>
            </div>
          </a>
        
        
          <a href="../SCONE_ENV/" title="environment variables" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                environment variables
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright Scontain © 2020
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.e72fd936.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../search/main.js"></script>
      
    
    
      
    
  </body>
</html>