



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Scone Documentation - Secure Containers">
      
      
        <link rel="canonical" href="https://sconedocs.github.io/network-shield/">
      
      
        <meta name="author" content="Christof Fetzer">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/scone-favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Network Shield - SCONE</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#network-shield" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://sconedocs.github.io" title="SCONE" class="md-header-nav__button md-logo">
          
            <img src="../img/logo-yellow-square.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              SCONE
            </span>
            <span class="md-header-nav__topic">
              
                Network Shield
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://sconedocs.github.io" title="SCONE" class="md-nav__button md-logo">
      
        <img src="../img/logo-yellow-square.png" width="48" height="48">
      
    </a>
    SCONE
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href=".." title="Executive summary" class="md-nav__link">
      Executive summary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advantages/" title="Advantages of SCONE" class="md-nav__link">
      Advantages of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../technical_summary/" title="Technical summary of SCONE" class="md-nav__link">
      Technical summary of SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../buildingApps/" title="(No) Cross-Compilation" class="md-nav__link">
      (No) Cross-Compilation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../curated_images/" title="Curated Images" class="md-nav__link">
      Curated Images
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../scone-use-case-overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secure_remote_execution/" title="Secure Remote Execution" class="md-nav__link">
      Secure Remote Execution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerfileexample/" title="Dockerfile Example" class="md-nav__link">
      Dockerfile Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multistagebuild/" title="Multi-stage build" class="md-nav__link">
      Multi-stage build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../groupcacheUseCase/" title="GO example" class="md-nav__link">
      GO example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../memory_dump/" title="Finding Secrets" class="md-nav__link">
      Finding Secrets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dapps/" title="Trusted DApps" class="md-nav__link">
      Trusted DApps
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Configuration & Attestation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Configuration & Attestation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CASOverview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_intro/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CASIntro/" title="Starting CAS" class="md-nav__link">
      Starting CAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../LASIntro/" title="Starting LAS" class="md-nav__link">
      Starting LAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cas_blender_example/" title="Posting Sessions" class="md-nav__link">
      Posting Sessions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../print-arg-env/" title="Secure Arguments" class="md-nav__link">
      Secure Arguments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EncryptedWordCount/" title="Encrypted Code and Input" class="md-nav__link">
      Encrypted Code and Input
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Use Cases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Use Cases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../usecases/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../blender/" title="Blender" class="md-nav__link">
      Blender
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pyspark/" title="PySpark" class="md-nav__link">
      PySpark
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflow/" title="TensorFlow" class="md-nav__link">
      TensorFlow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflowlite/" title="TensorFlow Lite" class="md-nav__link">
      TensorFlow Lite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vault/" title="Vault" class="md-nav__link">
      Vault
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Execution Modes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Execution Modes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../outline/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../firstcontainer/" title="Simulation Mode" class="md-nav__link">
      Simulation Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hardwaremode/" title="Hardware Mode" class="md-nav__link">
      Hardware Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hostexample/" title="Host Execution" class="md-nav__link">
      Host Execution
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" title="Installation overview" class="md-nav__link">
      Installation overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerinstall/" title="Installing docker" class="md-nav__link">
      Installing docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sgxinstall/" title="Installing Intel SGX driver" class="md-nav__link">
      Installing Intel SGX driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeinstall/" title="Installing SCONE" class="md-nav__link">
      Installing SCONE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../microcode/" title="Updating CPU microcode" class="md-nav__link">
      Updating CPU microcode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../iexec_install/" title="Patched driver & engine" class="md-nav__link">
      Patched driver & engine
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Language Support
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Language Support
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../C/" title="C" class="md-nav__link">
      C
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../C++/" title="C++" class="md-nav__link">
      C++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Fortran/" title="Fortran" class="md-nav__link">
      Fortran
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GO/" title="GO" class="md-nav__link">
      GO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Java/" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pypyscone/" title="PyPy" class="md-nav__link">
      PyPy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nodejs/" title="Node" class="md-nav__link">
      Node
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../R/" title="R" class="md-nav__link">
      R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Rust/" title="Rust" class="md-nav__link">
      Rust
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      IDE Integration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        IDE Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../eclipse/" title="Eclipse" class="md-nav__link">
      Eclipse
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Command Line Interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Command Line Interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_CLI/" title="SCONE CLI" class="md-nav__link">
      SCONE CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_toolchain/" title="SCONE SGX toolchain" class="md-nav__link">
      SCONE SGX toolchain
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Curated_Images/" title="SCONE Curated Images" class="md-nav__link">
      SCONE Curated Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_TUTORIAL/" title="SCONE Static vs Dynamic" class="md-nav__link">
      SCONE Static vs Dynamic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_GENERATE_IMAGE/" title="SCONE Create Image" class="md-nav__link">
      SCONE Create Image
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Dockerfile/" title="SCONE Dockerfile" class="md-nav__link">
      SCONE Dockerfile
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Manuals
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Manuals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Fileshield/" title="scone fspf" class="md-nav__link">
      scone fspf
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_ENV/" title="environment variables" class="md-nav__link">
      environment variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MrEnclave/" title="MrEnclave" class="md-nav__link">
      MrEnclave
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fork/" title="fork" class="md-nav__link">
      fork
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../performance/" title="Performance" class="md-nav__link">
      Performance
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Background
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Background
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../appsecurity/" title="Application-Oriented Security" class="md-nav__link">
      Application-Oriented Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../background/" title="SCONE Background" class="md-nav__link">
      SCONE Background
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SCONE_Publications/" title="Publications" class="md-nav__link">
      Publications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../aboutScone/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problems-addressed" class="md-nav__link">
    Problems Addressed
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-access-control" class="md-nav__link">
    Example: Access Control
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-tls-over-tls" class="md-nav__link">
    Example: TLS-over-TLS
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="network-shield">Network Shield<a class="headerlink" href="#network-shield" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Enclaves may need to communicate with each other. In case this communication is not encrypted, men in the middle (MitM) can eavesdrop on, alter or forge messages. Note that, in the context of enclaves, a third party, network operator, system administrator, and even the operating system may be considered MitM. Even if the application itself encrypts its traffic, there are no guarantees that the remote end resides inside of an enclave. The network shield solves both of these problems.</p>
<p>Key characteristics of the network shield include:</p>
<ul>
<li><strong>Confidentiality</strong> and <strong>integrity</strong> of network communication: Encryption and message authentication (through TLS) prevent eavesdropping or message forgery.</li>
<li><strong>Authentication of remote entities</strong>: The network shield ensures only communication with previously authorized remote peers is allowed, and those peers also run in a protected enclave.</li>
<li><strong>Fully transparent</strong>: The user application does not have to be changed in any way in order to make use of the network protection. Only the shield itself needs to be configured.</li>
<li><strong>Security by default</strong>: The network shield is always enabled by default, it has to be explicitly disabled (if required). Using unrecognized methods, flags or connections will be prevented.</li>
</ul>
<h2 id="problems-addressed">Problems Addressed<a class="headerlink" href="#problems-addressed" title="Permanent link">&para;</a></h2>
<p>SCONE provides a <strong>network shield</strong> that automatically wraps TCP connections in TLS. The objectives of the network shield are as follows:</p>
<ul>
<li>
<p><strong>Encryption of communication</strong>: Some services - like some versions of <code class="codehilite"><span class="n">memcached</span></code> -  that were designed at a time when communication within a data center was considered secure, might not support TLS protection of TCP connections.</p>
</li>
<li>
<p><strong>Access control</strong>: The <strong>network shield</strong> can also be used for automatic access control, i.e., we can limit what clients can connect to a service. To do so, the <strong>network shield</strong> automatically generates TLS certificates that a specific to a <strong>session</strong> (i.e., an instance of a security policy).</p>
</li>
<li>
<p><strong>TLS over TLS</strong>: in some data centers, TLS has to be terminated within the load balancers to enforce central access control to services running within a data center. The issue is that the communication within the data center is unprotected. With the help network shield one can implement TLS-over-TLS for outgoing connections as well as terminating the additional TLS connection for incoming connections.</p>
</li>
</ul>
<h2 id="example-access-control">Example: Access Control<a class="headerlink" href="#example-access-control" title="Permanent link">&para;</a></h2>
<p>Let's look at an example in which transparently protect all connections between the <code class="codehilite"><span class="n">nginx</span><span class="o">-</span><span class="n">server</span></code> and the <code class="codehilite"><span class="n">nginx</span><span class="o">-</span><span class="n">proxy</span></code>. In this case, we only permit connections from the <code class="codehilite"><span class="n">nginx</span><span class="o">-</span><span class="n">proxy</span></code>, i.e., only clients that have a valid <code class="codehilite"><span class="n">nginx</span><span class="o">-</span><span class="n">proxy</span></code> certificate are permitted to connect to the   <code class="codehilite"><span class="n">nginx</span><span class="o">-</span><span class="n">server</span></code>.</p>
<div class="codehilite"><pre><span></span><span class="nv">version</span>: <span class="s1">&#39;</span><span class="s">1.0beta</span><span class="s1">&#39;</span>
<span class="nv">alias</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">benchmark</span>

<span class="nv">services</span>:
  <span class="o">-</span> <span class="nv">name</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">server</span>
    <span class="nv">command</span>: [<span class="s2">&quot;</span><span class="s">nginx</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">-p</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">/nginx</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">-c</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">http_server.conf</span><span class="s2">&quot;</span>]
    <span class="nv">pwd</span>: <span class="o">/</span>
    <span class="nv">attestation</span>:
      <span class="nv">disabled</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="nv">testing</span><span class="o">-</span><span class="nv">purposes</span>: <span class="nv">true</span>
    <span class="nv">network</span>:
      <span class="nv">hostname</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">server</span>
      <span class="nv">incoming</span>:
        <span class="nv">ports</span>:
          <span class="o">-</span> <span class="nv">port</span>: <span class="mi">10000</span>
            <span class="nv">authorized</span><span class="o">-</span><span class="nv">clients</span>:
              <span class="nv">services</span>:
                <span class="o">-</span> <span class="nv">name</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">proxy</span>
  <span class="o">-</span> <span class="nv">name</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">proxy</span>
    <span class="nv">command</span>: [<span class="s2">&quot;</span><span class="s">nginx</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">-p</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">/nginx</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">-c</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">http_proxy.conf</span><span class="s2">&quot;</span>]
    <span class="nv">pwd</span>: <span class="o">/</span>
    <span class="nv">attestation</span>:
      <span class="nv">disabled</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="nv">testing</span><span class="o">-</span><span class="nv">purposes</span>: <span class="nv">true</span>
    <span class="nv">network</span>:
      <span class="nv">hostname</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">proxy</span>
      <span class="nv">outgoing</span>:
        <span class="nv">authorized</span><span class="o">-</span><span class="nv">servers</span>:
          <span class="nv">services</span>:
            <span class="o">-</span> <span class="nv">name</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">server</span>
              <span class="nv">port</span>: <span class="mi">10000</span>
      <span class="nv">incoming</span>:
        <span class="nv">ports</span>:
          <span class="o">-</span> <span class="nv">port</span>: <span class="mi">10001</span>
            <span class="nv">unprotected</span>: <span class="nv">true</span>
</pre></div>

<p>The http configuration of the server looks as follows:</p>
<div class="codehilite"><pre><span></span><span class="n">events</span> <span class="err">{</span>
    <span class="n">worker_connections</span> <span class="mi">512</span><span class="p">;</span>
    <span class="n">use</span> <span class="k">select</span><span class="p">;</span>
<span class="err">}</span>

<span class="n">error_log</span> <span class="n">stderr</span> <span class="n">info</span><span class="p">;</span>
<span class="n">pid</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">nginx_server</span><span class="p">.</span><span class="n">pid</span><span class="p">;</span>
<span class="n">master_process</span> <span class="k">off</span><span class="p">;</span>
<span class="n">daemon</span> <span class="k">off</span><span class="p">;</span>

<span class="n">http</span> <span class="err">{</span>
  <span class="n">server</span> <span class="err">{</span>
    <span class="n">root</span> <span class="p">.</span><span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="p">;</span>
    <span class="k">listen</span> <span class="mi">10000</span><span class="p">;</span>
    <span class="n">access_log</span> <span class="k">off</span><span class="p">;</span>
    <span class="n">open_file_cache</span> <span class="k">max</span><span class="o">=</span><span class="mi">1000</span> <span class="n">inactive</span><span class="o">=</span><span class="mi">120</span><span class="n">s</span><span class="p">;</span>

    <span class="k">location</span> <span class="o">/</span> <span class="err">{</span>
        <span class="n">tcp_nodelay</span>       <span class="k">on</span><span class="p">;</span>
        <span class="n">keepalive_requests</span> <span class="mi">2000000000</span><span class="p">;</span>
        <span class="n">keepalive_timeout</span> <span class="mi">300</span><span class="n">s</span><span class="p">;</span>
    <span class="err">}</span>
  <span class="err">}</span>
<span class="err">}</span>
</pre></div>

<h2 id="example-tls-over-tls">Example: TLS-over-TLS<a class="headerlink" href="#example-tls-over-tls" title="Permanent link">&para;</a></h2>
<p>We can wrap the TLS connection of <code class="codehilite"><span class="n">nginx</span></code> server that already uses <code class="codehilite"><span class="n">https</span></code>:</p>
<div class="codehilite"><pre><span></span><span class="nv">version</span>: <span class="s1">&#39;</span><span class="s">1.0beta</span><span class="s1">&#39;</span>
<span class="nv">alias</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">benchmark</span>

<span class="nv">services</span>:
  <span class="o">-</span> <span class="nv">name</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">server</span>
    <span class="nv">command</span>: [<span class="s2">&quot;</span><span class="s">nginx</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">-p</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">/nginx</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">-c</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">https_server.conf</span><span class="s2">&quot;</span>]
    <span class="nv">pwd</span>: <span class="o">/</span>
    <span class="nv">attestation</span>:
      <span class="nv">disabled</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="nv">testing</span><span class="o">-</span><span class="nv">purposes</span>: <span class="nv">true</span>
    <span class="nv">network</span>:
      <span class="nv">hostname</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">server</span>
      <span class="nv">incoming</span>:
        <span class="nv">ports</span>:
          <span class="o">-</span> <span class="nv">port</span>: <span class="mi">10000</span>
            <span class="nv">authorized</span><span class="o">-</span><span class="nv">clients</span>:
              <span class="nv">services</span>:
                <span class="o">-</span> <span class="nv">name</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">proxy</span>
  <span class="o">-</span> <span class="nv">name</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">proxy</span>
    <span class="nv">command</span>: [<span class="s2">&quot;</span><span class="s">nginx</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">-p</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">/nginx</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">-c</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">https_proxy.conf</span><span class="s2">&quot;</span>]
    <span class="nv">pwd</span>: <span class="o">/</span>
    <span class="nv">attestation</span>:
      <span class="nv">disabled</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="nv">testing</span><span class="o">-</span><span class="nv">purposes</span>: <span class="nv">true</span>
    <span class="nv">network</span>:
      <span class="nv">hostname</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">proxy</span>
      <span class="nv">outgoing</span>:
        <span class="nv">authorized</span><span class="o">-</span><span class="nv">servers</span>:
          <span class="nv">services</span>:
            <span class="o">-</span> <span class="nv">name</span>: <span class="nv">nginx</span><span class="o">-</span><span class="nv">server</span>
              <span class="nv">port</span>: <span class="mi">10000</span>
      <span class="nv">incoming</span>:
        <span class="nv">ports</span>:
          <span class="o">-</span> <span class="nv">port</span>: <span class="mi">10001</span>
            <span class="nv">unprotected</span>: <span class="nv">true</span>
</pre></div>

<p>The nginx configuration looks as follows:</p>
<div class="codehilite"><pre><span></span><span class="nv">events</span> {
    <span class="nv">worker_connections</span> <span class="mi">512</span><span class="c1">;</span>
}

<span class="nv">error_log</span> <span class="nv">stderr</span> <span class="nv">warn</span><span class="c1">;</span>
<span class="nv">pid</span> <span class="o">/</span><span class="nv">tmp</span><span class="o">/</span><span class="nv">nginx_server</span>.<span class="nv">pid</span><span class="c1">;</span>
<span class="nv">master_process</span> <span class="nv">off</span><span class="c1">;</span>
<span class="nv">daemon</span> <span class="nv">off</span><span class="c1">;</span>

<span class="nv">http</span> {
  <span class="nv">server</span> {
    <span class="nv">root</span> .<span class="o">/</span><span class="nv">content</span><span class="o">/</span><span class="c1">;</span>
    <span class="nv">listen</span> <span class="mi">10000</span> <span class="nv">ssl</span><span class="c1">;</span>
    <span class="nv">access_log</span> <span class="nv">off</span><span class="c1">;</span>
    <span class="nv">open_file_cache</span> <span class="nv">max</span><span class="o">=</span><span class="mi">1000</span> <span class="nv">inactive</span><span class="o">=</span><span class="mi">120</span><span class="nv">s</span><span class="c1">;</span>

    <span class="nv">location</span> <span class="o">/</span> {
        <span class="nv">tcp_nodelay</span>       <span class="nv">on</span><span class="c1">;</span>
        <span class="nv">keepalive_requests</span> <span class="mi">2000000000</span><span class="c1">;</span>
        <span class="nv">keepalive_timeout</span> <span class="mi">300</span><span class="nv">s</span><span class="c1">;</span>
    }

    <span class="nv">ssl_protocols</span> <span class="nv">TLSv1</span>.<span class="mi">2</span><span class="c1">;</span>
    <span class="nv">ssl_ciphers</span> <span class="s2">&quot;</span><span class="s">ECDHE-ECDSA-AES256-GCM-SHA384</span><span class="s2">&quot;</span><span class="c1">;</span>
    <span class="nv">ssl_ecdh_curve</span> <span class="s2">&quot;</span><span class="s">secp384r1:prime256v1</span><span class="s2">&quot;</span><span class="c1">; # Note that the curve of the certificate, prime256v1 in this case, MUST be listed here, otherwise the connection fails. ECDHE still chooses the first curve if possible.</span>
    <span class="nv">ssl_prefer_server_ciphers</span> <span class="nv">on</span><span class="c1">;</span>
    <span class="nv">ssl_session_tickets</span> <span class="nv">off</span><span class="c1">;</span>
    <span class="nv">ssl_session_cache</span> <span class="nv">off</span><span class="c1">;</span>

    <span class="nv">ssl_certificate_key</span> .<span class="o">/</span><span class="nv">pki</span><span class="o">/</span><span class="nv">srv</span>.<span class="nv">pem</span>.<span class="nv">key</span><span class="c1">;</span>
    <span class="nv">ssl_certificate</span> .<span class="o">/</span><span class="nv">pki</span><span class="o">/</span><span class="nv">srv</span>.<span class="nv">bundle</span>.<span class="nv">pem</span>.<span class="nv">crt</span><span class="c1">;</span>
  }
}
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright Scontain © 2019
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>